<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>课程订阅信息 - LightCourseCRM</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-green: #2ecc71;
            --light-green: #98FB98;
            --dark-green: #27ae60;
            --hover-green: #229954;
            --bg-green: #F0FFF0;
            
            /* 字体层级变量 */
            --font-size-xl: 20px;      /* 大标题 */
            --font-size-lg: 16px;      /* 小节标题 */
            --font-size-base: 14px;    /* 基础字体 */
            --font-size-md: 14px;      /* 表单标签/正文 */
            --font-size-sm: 12px;      /* 辅助说明 */
            
            --font-weight-bold: 700;     /* 粗体 */
            --font-weight-semibold: 600; /* 半粗体 */
            --font-weight-medium: 500;   /* 中等字重 */
            --font-weight-regular: 400;  /* 常规字重 */
            
            /* 颜色变量 */
            --text-primary: #2c3e50;   /* 主要文本 */
            --text-secondary: #495057; /* 次要文本 */
            --text-muted: #6c757d;     /* 静音文本 */
            --text-hint: #909399;      /* 提示文本 */
            
            /* 蓝色主题变量 */
            --primary-blue: #007bff;
            --primary-blue-dark: #0056b3;
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
        }
        
        body {
            font-family: "Noto Sans SC", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: white;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .header {
            background: white;
            color: var(--text-primary);
            padding: 15px 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            border-bottom: 1px solid #f1f3f5;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            margin: 0;
            color: var(--primary-green);
            text-shadow: none;
        }
        
        .breadcrumb {
            font-size: 14px;
            margin-top: 5px;
            color: var(--primary-green);
            opacity: 0.8;
        }
        
        .main-layout {
            display: flex;
            margin-top: 80px;
            min-height: calc(100vh - 80px);
        }
        
        .student-layout {
            display: flex;
            min-height: calc(100vh - 160px);
        }
        
        .student-sidebar {
            width: 220px;
            background: white;
            border-right: 1px solid #ddd;
            padding: 20px;
        }
        
        .student-content {
            flex: 1;
        }
        
        .sidebar-section {
            margin-bottom: 30px;
        }
        
        .sidebar-title {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 6px;
        }
        
        .sidebar-title:hover {
            background: #f8f9fa;
            color: #007bff;
            padding-left: 8px;
        }
        
        .sidebar-title.active {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            border-radius: 6px;
            padding-left: 8px;
            box-shadow: 0 2px 8px rgba(0, 123, 255, 0.3);
        }
        
        .function-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px 0;
        }
        
        .function-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .home-subscribe-btn {
            background: #1e90ff;
            color: white;
        }
        
        .home-subscribe-btn:hover {
            background: #0066cc;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(30, 144, 255, 0.4);
        }
        
        .product-subscribe-btn {
            background: #ffa500;
            color: white;
        }
        
        .product-subscribe-btn:hover {
            background: #e6940a;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(255, 165, 0, 0.4);
        }
        
        .batch-subscribe-btn {
            background: var(--primary-green);
            color: white;
        }
        
        .batch-subscribe-btn:hover:not(:disabled) {
            background: var(--hover-green);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(46, 204, 113, 0.4);
        }
        
        .batch-subscribe-btn:disabled {
            background: #cccccc;
            color: #666666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        /* 批量订阅下拉菜单样式 */
        .batch-subscribe-dropdown {
            position: relative;
            display: inline-block;
        }
        
        .dropdown-arrow {
            margin-left: 8px;
            font-size: 12px;
            transition: transform 0.3s ease;
        }
        
        .batch-subscribe-dropdown:hover .dropdown-arrow {
            transform: rotate(180deg);
        }
        
        .dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            background: white;
            border: 1px solid #e1e5e9;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            z-index: 1000;
            min-width: 200px;
        }
        
        .batch-subscribe-dropdown:hover .dropdown-menu:not(.disabled) {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .dropdown-menu.disabled {
            opacity: 0;
            visibility: hidden;
        }
        
        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 8px;
            width: 100%;
            padding: 12px 16px;
            border: none;
            background: white;
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            border-radius: 0;
        }
        
        .dropdown-item:first-child {
            border-radius: 6px 6px 0 0;
        }
        
        .dropdown-item:last-child {
            border-radius: 0 0 6px 6px;
        }
        
        .dropdown-item:hover {
            background: #f8f9fa;
            color: var(--primary-green);
        }
        
        .dropdown-item .btn-icon {
            font-size: 16px;
        }
        
        /* 单门课程订阅方式选择模态框样式 */
        .course-info-display {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
        }
        
        .info-row-horizontal {
            display: flex;
            gap: 20px;
        }
        
        /* 不可编辑字段样式 */
        .info-value.readonly-field {
            background-color: #f8f9fa !important;
            color: #6c757d !important;
            cursor: not-allowed !important;
            padding: 8px 12px !important;
            border-radius: 4px;
            border: 1px solid #e9ecef;
            user-select: none;
            font-weight: 500 !important;
            font-size: 14px;
        }
        
        .info-value.readonly-field:hover {
            background-color: #e9ecef !important;
            border-color: #dee2e6;
        }
        
        .info-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .info-item .info-label {
            font-size: 13px;
            font-weight: 500;
            color: #6c757d;
        }
        
        .info-item .info-value {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            padding: 10px 12px;
            background: white;
            border-radius: 4px;
            border: 1px solid #e9ecef;
        }
        
        .subscription-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .option-card {
            border: 2px solid #e9ecef;
            border-radius: 6px;
            padding: 12px 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .option-card:hover {
            border-color: var(--primary-green);
            background: #f0fff0;
        }
        
        .option-card.selected {
            border-color: var(--primary-green);
            background: #f0fff0;
        }
        
        .option-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 6px;
        }
        
        .option-title {
            font-size: 15px;
            font-weight: 600;
            color: #333;
            cursor: pointer;
            margin: 0;
        }
        
        .option-description {
            font-size: 13px;
            color: #6c757d;
            margin: 0;
            line-height: 1.4;
            padding-left: 28px;
        }
        
        .subscription-options input[type="radio"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .function-btn .btn-icon {
            font-size: 16px;
        }
        
        .course-checkbox {
            cursor: pointer;
            transform: scale(1.2);
        }
        
        .student-table td[rowspan] {
            border-right: 2px solid #ddd;
            background-color: #f9f9f9;
        }
        
        /* 模态框样式 */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 8px;
            width: 95%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid #e9ecef;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }
        
        .modal-header h3 {
            margin: 0;
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-bold);
            color: var(--text-primary);
        }
        
        /* 课程订阅模态框绿色主题样式 */
        .modal-header.product-course {
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--dark-green) 100%);
            color: white;
        }
        
        .modal-header.product-course h3 {
            color: white;
        }
        
        .modal-header.product-course .modal-close {
            color: white;
            opacity: 0.8;
        }
        
        .modal-header.product-course .modal-close:hover {
            opacity: 1;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: rgba(255, 255, 255, 0.8);
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.2s ease;
        }
        
        .modal-close:hover {
            color: white;
        }
        
        .modal-body {
            padding: 24px;
        }
        
        /* 顶部信息区样式 */
        .info-header {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 24px;
            border: 1px solid #e3e6ea;
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
        }
        
        .info-item {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .info-label {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .info-value {
            font-size: var(--font-size-md);
            font-weight: var(--font-weight-regular);
            color: var(--text-primary);
            padding: 10px 14px;
            background: white;
            border-radius: 6px;
            border: 1px solid #e3e6ea;
            min-height: 20px;
            line-height: 1.5;
        }
        
        /* 表单区域样式 */
        .form-section {
            margin-top: 16px;
        }
        
        .section-title {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-bold);
            color: var(--text-primary);
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e9ecef;
        }
        
        .form-grid {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .form-field {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 20px;
            padding: 12px 16px;
            background: #fafbfc;
            border-radius: 12px;
            border: 1px solid #e9ecef;
        }
        
        .field-left {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .field-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            margin-bottom: 4px;
        }
        
        .field-title-group {
            display: flex;
            align-items: baseline;
            gap: 12px;
        }
        
        .field-label {
            font-size: var(--font-size-md);
            font-weight: var(--font-weight-bold);
            color: var(--text-primary);
            margin: 0;
        }
        
        .field-hint {
            font-size: var(--font-size-sm);
            color: var(--text-hint);
            margin: 0;
            line-height: 1.4;
        }
        
        .field-control {
            min-width: 240px;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .field-right {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 0;
        }
        
        /* 表单控件样式 */
        .form-input, .form-select {
            padding: 10px 12px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: var(--font-size-md);
            font-weight: var(--font-weight-regular);
            color: var(--text-primary);
            transition: all 0.2s ease;
            background: white;
            line-height: 1.4;
        }
        
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }
        
        .form-input:hover, .form-select:hover {
            border-color: #007bff;
        }
        
        /* 日期范围输入 */
        .date-range-wrapper {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .date-input {
            flex: 1;
        }
        
        .date-separator {
            color: #6c757d;
            font-weight: 500;
            padding: 0 2px;
            font-size: var(--font-size-sm);
        }
        
        /* 组合输入框 */
        .combo-input {
            display: flex;
            align-items: center;
            gap: 4px;
            background: #f8f9fa;
            padding: 2px;
            border-radius: 6px;
            border: 2px solid #e9ecef;
            transition: border-color 0.2s ease;
        }
        
        .combo-input:focus-within {
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }
        
        .combo-label, .combo-unit {
            color: var(--text-secondary);
            font-weight: var(--font-weight-medium);
            font-size: var(--font-size-md);
            white-space: nowrap;
            padding: 0 8px;
        }
        
        .combo-select, .combo-number {
            border: none;
            background: white;
            padding: 8px 10px;
            border-radius: 4px;
            font-size: var(--font-size-md);
            font-weight: var(--font-weight-regular);
            color: var(--text-primary);
            min-width: 80px;
        }
        
        .combo-select:focus, .combo-number:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
        }
        
        /* 开关样式 */
        .switch-wrapper {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .switch-label {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            color: var(--text-secondary);
            user-select: none;
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 48px;
            height: 26px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .3s;
            border-radius: 26px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .3s;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        input:checked + .slider {
            background-color: var(--primary-green);
        }
        
        input:checked + .slider:before {
            transform: translateX(22px);
        }
        
        .slider:hover {
            box-shadow: 0 0 8px rgba(46, 204, 113, 0.3);
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .info-header {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .form-grid {
                gap: 16px;
            }
            
            .date-range-wrapper {
                flex-direction: column;
                gap: 8px;
            }
            
            .date-separator {
                display: none;
            }
            
            .combo-input {
                flex-wrap: wrap;
                gap: 6px;
            }
            
            .modal-footer {
                flex-direction: column-reverse;
                gap: 12px;
            }
            
            .btn {
                width: 100%;
            }
        }
        
        @media (min-width: 769px) {
            .form-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 24px 20px;
            }
            
            .form-field:nth-child(2) {
                grid-column: 1 / -1;
            }
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            padding: 20px 24px;
            border-top: 1px solid #e9ecef;
            background-color: #f8f9fa;
        }
        
        /* 通用按钮样式 */
        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-size: var(--font-size-md);
            font-weight: var(--font-weight-medium);
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 110px;
            line-height: 1.5;
        }
        
        .btn-cancel:hover {
            background: #e9ecef;
            color: var(--text-primary);
            border-color: #dee2e6;
        }
        
        /* 保存按钮 */
        .btn-save {
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--hover-green) 100%);
            color: white;
            font-weight: var(--font-weight-medium);
            box-shadow: 0 2px 4px rgba(50, 205, 50, 0.2);
        }
        
        .btn-save:hover {
            background: linear-gradient(135deg, var(--hover-green) 0%, var(--dark-green) 100%);
            box-shadow: 0 4px 8px rgba(50, 205, 50, 0.3);
            transform: translateY(-1px);
        }
        
        .btn-save:active {
            transform: translateY(0);
        }
        
        /* 批量设置样式 */
        .batch-info-header {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            border: 1px solid #e3e6ea;
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 16px;
        }
        
        /* 课程列表样式 */
        .course-list-item {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .course-list-container {
            background: white;
            border: 1px solid #e3e6ea;
            border-radius: 6px;
            padding: 0;
            min-height: 40px;
            max-height: 120px;
            overflow: hidden;
        }
        
        /* 选择模态框中的课程列表样式 */
        .course-list-container .course-list-scroll.readonly-field {
            background-color: #f8f9fa !important;
            cursor: not-allowed !important;
            max-height: 100px;
        }
        
        .course-list-container .course-count-title {
            background: #f8f9fa;
            padding: 8px 12px;
            font-size: 13px;
            font-weight: 500;
            color: #6c757d;
            border-bottom: 1px solid #e9ecef;
        }
        
        .course-list-scroll {
            max-height: 120px;
            overflow-y: auto;
            padding: 8px 12px;
        }
        
        .course-item-row {
            padding: 4px 0;
            border-bottom: 1px solid #f1f3f5;
            font-size: var(--font-size-sm);
            color: var(--text-primary);
            line-height: 1.4;
        }
        
        .course-item-row:last-child {
            border-bottom: none;
        }
        
        /* 选择模态框中的只读课程行样式 */
        .readonly-field .course-item-row {
            color: #6c757d;
            padding: 6px 12px;
            font-size: 13px;
        }
        
        .course-count-title {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            color: var(--text-secondary);
            margin-bottom: 4px;
        }
        
        /* 滚动条样式 */
        .course-list-scroll::-webkit-scrollbar {
            width: 4px;
        }
        
        .course-list-scroll::-webkit-scrollbar-track {
            background: #f1f3f5;
            border-radius: 2px;
        }
        
        .course-list-scroll::-webkit-scrollbar-thumb {
            background: #c1c7cd;
            border-radius: 2px;
        }
        
        .course-list-scroll::-webkit-scrollbar-thumb:hover {
            background: #a8b2ba;
        }
        
        /* 学生跟进表格样式 */
        .student-follow-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .student-follow-table th {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 12px 8px;
            text-align: left;
            font-weight: var(--font-weight-semibold);
            color: var(--text-primary);
            border-bottom: 2px solid #dee2e6;
            font-size: var(--font-size-sm);
            white-space: nowrap;
        }
        
        .student-follow-table td {
            padding: 10px 8px;
            border-bottom: 1px solid #f1f3f5;
            font-size: var(--font-size-sm);
            color: var(--text-primary);
            vertical-align: middle;
        }
        
        .student-row:hover {
            background-color: #f8f9fa;
        }
        
        .student-row:nth-child(even) {
            background-color: #fdfdfd;
        }
        
        .student-row:nth-child(even):hover {
            background-color: #f8f9fa;
        }
        
        /* 表格列宽设置 */
        .checkbox-col { width: 40px; text-align: center; }
        .student-name-col { width: 100px; }
        .school-col { width: 120px; }
        .entry-time-col { width: 140px; }
        .next-follow-col { width: 140px; }
        .status-col { width: 90px; }
        .wechat-col { width: 100px; }
        .report-col { width: 80px; text-align: center; }
        .subscription-col { width: 180px; }
        .action-col { width: 120px; text-align: center; }
        
        /* 状态标签样式 */
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: var(--font-weight-medium);
            white-space: nowrap;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .status-following {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .status-completed {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        /* 操作按钮样式 */
        .btn-edit, .btn-follow, .btn-delete {
            background: none;
            border: none;
            padding: 4px 6px;
            margin: 0 2px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }
        
        .btn-edit:hover {
            background: #e3f2fd;
        }
        
        .btn-follow:hover {
            background: #f3e5f5;
        }
        
        .btn-delete:hover {
            background: #ffebee;
        }
        
        .btn-link {
            background: none;
            border: none;
            color: var(--primary-blue);
            text-decoration: underline;
            cursor: pointer;
            font-size: var(--font-size-sm);
            padding: 2px 4px;
        }
        
        .btn-link:hover {
            color: var(--primary-blue-dark);
        }
        
        /* 学生姓名高亮 */
        .student-name {
            font-weight: var(--font-weight-medium);
            color: var(--text-primary);
        }
        
        /* 课程订阅信息样式 */
        .subscription-info {
            max-width: 180px;
            word-wrap: break-word;
            line-height: 1.4;
        }
        
        /* 学生选课分析页面样式 */
        .page-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            z-index: 1000;
            overflow-y: auto;
        }
        
        /* 学生档案表单样式 */
        .student-profile-form {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .profile-form-field {
            margin-bottom: 24px;
        }
        
        .profile-form-field label {
            display: block;
            font-size: var(--font-size-md);
            font-weight: var(--font-weight-medium);
            color: var(--text-primary);
            margin-bottom: 8px;
        }
        
        .profile-form-field input[type="text"],
        .profile-form-field select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: var(--font-size-md);
            color: var(--text-primary);
            background: white;
            transition: all 0.2s ease;
            box-sizing: border-box;
        }
        
        .profile-form-field input[type="text"]:focus,
        .profile-form-field select:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }
        
        .profile-form-field input[type="text"]:disabled {
            background-color: #f8f9fa;
            color: #6c757d;
            cursor: not-allowed;
            border-color: #e9ecef;
        }
        
        .profile-radio-group {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }
        
        .profile-radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .profile-radio-option input[type="radio"] {
            width: 16px;
            height: 16px;
            margin: 0;
        }
        
        .profile-radio-option label {
            font-size: var(--font-size-md);
            color: var(--text-primary);
            margin: 0;
            cursor: pointer;
        }
        
        .profile-checkbox-group {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }
        
        .profile-checkbox-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .profile-checkbox-option input[type="checkbox"] {
            width: 16px;
            height: 16px;
            margin: 0;
        }
        
        .profile-checkbox-option label {
            font-size: var(--font-size-md);
            color: var(--text-primary);
            margin: 0;
            cursor: pointer;
        }
        
        .file-upload-area {
            border: 2px dashed #e9ecef;
            border-radius: 8px;
            padding: 40px 20px;
            text-align: center;
            background: #f8f9fa;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .file-upload-area:hover {
            border-color: var(--primary-blue);
            background: #f0f7ff;
        }
        
        .file-upload-area.dragover {
            border-color: var(--primary-blue);
            background: #e6f3ff;
        }
        
        .file-upload-icon {
            font-size: 48px;
            color: #6c757d;
            margin-bottom: 16px;
        }
        
        .file-upload-text {
            font-size: var(--font-size-md);
            color: var(--text-secondary);
            margin-bottom: 8px;
        }
        
        .file-upload-hint {
            font-size: var(--font-size-sm);
            color: var(--text-muted);
        }
        
        .uploaded-files {
            margin-top: 16px;
        }
        
        .uploaded-file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            margin-bottom: 8px;
        }
        
        .uploaded-file-name {
            font-size: var(--font-size-sm);
            color: var(--text-primary);
        }
        
        .uploaded-file-remove {
            background: none;
            border: none;
            color: #dc3545;
            cursor: pointer;
            font-size: 16px;
            padding: 4px;
        }
        
        .uploaded-file-remove:hover {
            color: #c82333;
        }
        
        .profile-submit-btn {
            width: 100%;
            padding: 14px 24px;
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--hover-green) 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: var(--font-size-md);
            font-weight: var(--font-weight-medium);
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 32px;
        }
        
        .profile-submit-btn:hover {
            background: linear-gradient(135deg, var(--hover-green) 0%, var(--dark-green) 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(46, 204, 113, 0.3);
        }
        
        /* 自主选课Excel表格样式 */
        .autonomous-course-container {
            padding: 20px;
            max-width: 100%;
            overflow-x: auto;
        }
        
        .course-table-excel {
            width: 100%;
            border-collapse: collapse;
            background: white;
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            font-size: 13px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-radius: 6px;
            overflow: hidden;
        }
        
        .course-table-excel th {
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--dark-green) 100%);
            color: white;
            padding: 12px 10px;
            text-align: center;
            font-weight: 600;
            font-size: 12px;
            border-right: 1px solid rgba(255, 255, 255, 0.2);
            white-space: nowrap;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .course-table-excel th:last-child {
            border-right: none;
        }
        
        .course-table-excel td {
            padding: 10px;
            border-bottom: 1px solid #e1e5e9;
            border-right: 1px solid #e1e5e9;
            text-align: center;
            vertical-align: middle;
            background: white;
        }
        
        .course-table-excel td:last-child {
            border-right: none;
        }
        
        .course-table-excel tbody tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .course-table-excel tbody tr:hover {
            background-color: #e3f2fd;
        }
        
        /* 课程代码列样式 */
        .course-code-cell {
            font-family: "Consolas", "Monaco", monospace;
            font-weight: 600;
            color: #2c3e50;
            background-color: #f0f3f7 !important;
            text-align: left;
            padding-left: 12px;
        }
        
        /* 课程名称列样式 */
        .course-name-cell {
            text-align: left;
            padding-left: 12px;
            max-width: 200px;
            line-height: 1.4;
        }
        
        /* 通识类别样式 */
        .general-category-cell {
            font-weight: 500;
            color: #7b68ee;
        }
        
        /* 复选框列样式 */
        .checkbox-cell {
            width: 40px;
            text-align: center;
            background-color: #f8f9fa !important;
        }
        
        .course-checkbox {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }
        
        /* 课程对应数量样式 */
        .correspondence-cell {
            font-weight: 600;
        }
        
        .correspondence-available {
            color: #28a745;
        }
        
        .correspondence-none {
            color: #dc3545;
        }
        
        /* 课程类型标签 */
        .course-type-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .type-lecture {
            background-color: #e3f2fd;
            color: #1565c0;
        }
        
        .type-studio {
            background-color: #f3e5f5;
            color: #7b1fa2;
        }
        
        .type-lab {
            background-color: #e8f5e8;
            color: #2e7d32;
        }
        
        /* 可售课程单元样式 */
        .available-units-cell {
            font-weight: 600;
        }
        
        .units-available {
            color: #28a745;
        }
        
        .units-none {
            color: #dc3545;
        }
        
        /* 表格响应式 */
        @media (max-width: 768px) {
            .autonomous-course-container {
                padding: 10px;
            }
            
            .course-table-excel {
                font-size: 12px;
            }
            
            .course-table-excel th,
            .course-table-excel td {
                padding: 8px 6px;
            }
            
            .course-name-cell {
                max-width: 150px;
            }
        }
        
        /* 学生已选课程表格样式 */
        .selected-courses-container {
            padding: 20px;
            max-width: 100%;
            overflow-x: auto;
        }
        
        .selected-courses-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            font-size: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-radius: 6px;
            overflow: hidden;
        }
        
        .selected-courses-table th {
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--dark-green) 100%);
            color: white;
            padding: 12px 8px;
            text-align: center;
            font-weight: 600;
            font-size: 11px;
            border-right: 1px solid rgba(255, 255, 255, 0.2);
            white-space: nowrap;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .selected-courses-table th:last-child {
            border-right: none;
        }
        
        .selected-courses-table td {
            padding: 10px 8px;
            border-bottom: 1px solid #e1e5e9;
            border-right: 1px solid #e1e5e9;
            text-align: center;
            vertical-align: middle;
            background: white;
            font-size: 11px;
        }
        
        .selected-courses-table td:last-child {
            border-right: none;
        }
        
        .selected-courses-table tbody tr:nth-child(even) {
            background-color: white;
        }
        
        .selected-courses-table tbody tr:hover {
            background-color: #f8f9fa;
        }
        
        /* 本校课程列样式 */
        .home-course-cell {
            font-family: "Consolas", "Monaco", monospace;
            font-weight: 600;
            color: #2c3e50;
            background-color: white !important;
        }
        
        /* 课程满足类别样式 */
        .course-category-badge {
            display: inline-block;
            padding: 3px 6px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 600;
        }
        
        .category-required {
            background-color: #dc3545;
            color: white;
        }
        
        .category-elective {
            background-color: #007bff;
            color: white;
        }
        
        .category-general {
            background-color: #28a745;
            color: white;
        }
        
        .category-free {
            background-color: #6c757d;
            color: white;
        }
        
        /* 当前状态样式 */
        .status-potential {
            color: #fd7e14;
            font-weight: 600;
        }
        
        .status-serving {
            color: #20c997;
            font-weight: 600;
        }
        
        /* 审核状态样式 */
        .audit-status-text {
            font-size: 11px;
            font-weight: 600;
        }
        
        .audit-not-submitted {
            color: #6c757d;
        }
        
        .audit-ai-passed {
            color: #28a745;
        }
        
        .audit-ai-rejected {
            color: #dc3545;
        }
        
        /* 产品课程信息样式 */
        .product-course-cell {
            text-align: left;
            line-height: 1.4;
        }
        
        .product-course-code {
            font-family: "Consolas", "Monaco", monospace;
            font-weight: 600;
            color: #495057;
            display: block;
        }
        
        .product-course-name {
            color: #6c757d;
            font-size: 10px;
            margin-top: 2px;
            display: block;
        }
        
        /* 产品学校样式 */
        .product-school-cell {
            font-weight: 500;
            color: #495057;
            font-size: 10px;
        }
        
        /* 日期、价格等信息样式 */
        .date-cell, .price-cell, .code-cell, .duration-cell {
            font-weight: 500;
            font-size: 11px;
        }
        
        .price-cell {
            color: #e83e8c;
            font-weight: 600;
        }
        
        /* 合并单元格边框样式 */
        .merged-cell {
            border-right: 2px solid #4a90e2;
            background-color: white !important;
        }
        
        /* 课程订阅中心样式 */
        .subscription-center-container {
            padding: 20px;
            max-width: 100%;
            overflow-x: auto;
        }
        
        .subscription-center-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            font-family: "Noto Sans SC", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            font-size: 13px;
            line-height: 1.5;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .subscription-center-table th {
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--dark-green) 100%);
            color: white;
            padding: 15px 12px;
            text-align: center;
            vertical-align: middle;
            font-weight: 600;
            font-size: 12px;
            letter-spacing: 0.3px;
            border-right: 1px solid rgba(255, 255, 255, 0.2);
            white-space: nowrap;
            position: sticky;
            top: 0;
            z-index: 10;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        .subscription-center-table th:last-child {
            border-right: none;
        }
        
        .subscription-center-table td {
            padding: 16px 12px;
            border-bottom: 1px solid #e8ecf0;
            border-right: 1px solid #e8ecf0;
            text-align: center;
            vertical-align: middle;
            background: white;
            font-size: 12px;
            color: #2c3e50;
            line-height: 1.4;
        }
        
        .subscription-center-table td:last-child {
            border-right: none;
        }
        
        .subscription-center-table tbody tr:hover {
            background-color: #f8fafc;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            transition: all 0.2s ease;
        }
        
        .subscription-center-table tbody tr:hover td {
            background-color: #f8fafc;
        }
        
        /* 订阅中心表格列宽设置 */
        .subscription-center-table th:nth-child(1) { width: 10%; } /* 订阅类型 */
        .subscription-center-table th:nth-child(2) { width: 20%; } /* 订阅课程 */ 
        .subscription-center-table th:nth-child(3) { width: 18%; } /* 订阅条件 */
        .subscription-center-table th:nth-child(4) { width: 10%; } /* 当前状态 */
        .subscription-center-table th:nth-child(5) { width: 10%; } /* 创建日期 */
        .subscription-center-table th:nth-child(6) { width: 12%; } /* 截止日期 */
        .subscription-center-table th:nth-child(7) { width: 20%; } /* 操作 */
        
        /* 筛选区域样式 */
        .subscription-filter-area {
            display: flex;
            gap: 20px;
            align-items: center;
            padding: 15px 20px;
            background: #f8f9fa;
            border-radius: 6px;
            margin-bottom: 15px;
            border: 1px solid #e1e5e9;
        }
        
        .filter-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .filter-item label {
            font-size: 12px;
            color: #495057;
            white-space: nowrap;
            font-weight: 500;
        }
        
        .filter-select {
            padding: 5px 8px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 12px;
            background: white;
            color: #495057;
            min-width: 120px;
            cursor: pointer;
        }
        
        .filter-select:focus {
            border-color: #4a90e2;
            outline: none;
            box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.2);
        }
        
        .filter-reset-btn {
            padding: 5px 12px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.2s ease;
        }
        
        .filter-reset-btn:hover {
            background: #5a6268;
        }
        
        /* 操作按钮样式 */
        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 6px;
            justify-content: center;
            align-items: center;
            text-align: center;
            height: 100%;
        }
        
        .action-btn {
            background: none;
            border: none;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
            padding: 3px 0;
            font-weight: 600;
            letter-spacing: 0.2px;
            border-radius: 3px;
        }
        
        /* 不同功能按钮的颜色 */
        .btn-edit {
            color: #28a745; /* 绿色 - 编辑 */
        }
        
        .btn-edit:hover {
            color: #1e7e34;
            text-decoration: underline;
        }
        
        .btn-cancel {
            color: #dc3545; /* 红色 - 取消 */
        }
        
        .btn-cancel:hover {
            color: #c82333;
            text-decoration: underline;
        }
        
        .btn-renew {
            color: #ffc107; /* 黄色 - 续期 */
        }
        
        .btn-renew:hover {
            color: #e0a800;
            text-decoration: underline;
        }
        
        .btn-view {
            color: #007bff; /* 蓝色 - 查看 */
        }
        
        .btn-view:hover {
            color: #0056b3;
            text-decoration: underline;
        }
        
        .btn-select {
            color: #17a2b8; /* 青色 - 选择/跳转 */
        }
        
        .btn-select:hover {
            color: #138496;
            text-decoration: underline;
        }
        
        .btn-detail {
            color: #6f42c1; /* 紫色 - 详情 */
        }
        
        .btn-detail:hover {
            color: #5a2d91;
            text-decoration: underline;
        }
        
        .final-status-note {
            font-size: 11px;
            color: #6c757d;
            font-style: italic;
            font-weight: 500;
            text-align: center;
            padding: 6px 0;
            letter-spacing: 0.1px;
        }
        
        /* 订阅类型样式 */
        .subscription-type-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 14px;
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 0.2px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .type-product {
            background-color: #e3f2fd;
            color: #1565c0;
        }
        
        .type-home {
            background-color: #f3e5f5;
            color: #7b1fa2;
        }
        
        /* 订阅课程信息样式 */
        .subscription-course-cell {
            text-align: left;
            line-height: 1.5;
            max-width: 200px;
            padding: 16px 15px;
        }
        
        .course-info-top {
            font-family: "SF Mono", "Monaco", "Consolas", monospace;
            font-weight: 600;
            color: #1a365d;
            font-size: 12px;
            display: block;
            margin-bottom: 4px;
            letter-spacing: 0.2px;
        }
        
        .course-info-bottom {
            color: #718096;
            font-size: 11px;
            font-weight: 500;
            display: block;
            letter-spacing: 0.1px;
        }
        
        /* 订阅条件样式 */
        .subscription-conditions {
            text-align: left;
            max-width: 140px;
            position: relative;
            padding: 16px 15px;
        }
        
        .conditions-summary {
            cursor: pointer;
            display: block;
            font-size: 12px;
            color: #2c3e50;
            font-weight: 500;
            line-height: 1.4;
        }
        
        .conditions-tooltip {
            position: absolute;
            background: #333;
            color: white;
            padding: 8px 10px;
            border-radius: 4px;
            font-size: 10px;
            white-space: nowrap;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-bottom: 5px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .conditions-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: #333;
        }
        
        .subscription-conditions:hover .conditions-tooltip {
            opacity: 1;
            visibility: visible;
        }
        
        /* 状态样式 */
        .status-waiting {
            color: #fd7e14;
            font-weight: 600;
            font-size: 12px;
            letter-spacing: 0.2px;
        }
        
        .status-matched {
            color: #20c997;
            font-weight: 600;
            font-size: 12px;
            letter-spacing: 0.2px;
        }
        
        .status-notified {
            color: #007bff;
            font-weight: 600;
            font-size: 12px;
            letter-spacing: 0.2px;
        }
        
        .status-viewed {
            color: #6f42c1;
            font-weight: 600;
            font-size: 12px;
            letter-spacing: 0.2px;
        }
        
        .status-converted {
            color: #28a745;
            font-weight: 600;
            font-size: 12px;
            letter-spacing: 0.2px;
        }
        
        .status-expired {
            color: #dc3545;
            font-weight: 600;
            font-size: 12px;
            letter-spacing: 0.2px;
        }
        
        /* 截止日期样式 */
        .deadline-cell {
            font-weight: 500;
            font-size: 12px;
            color: #2c3e50;
            line-height: 1.4;
        }
        
        .deadline-urgent {
            color: #dc3545;
            font-weight: 600;
            font-size: 12px;
        }
        
        .deadline-countdown {
            font-size: 11px;
            color: #dc3545;
            font-weight: 600;
            display: block;
            margin-top: 3px;
            letter-spacing: 0.1px;
        }
        

        

        
        .page-header {
            padding: 20px 0 24px 0;
            border-bottom: 1px solid #e1e5e9;
            margin-bottom: 24px;
        }
        
        .page-header h1 {
            margin: 0 0 8px 0;
            font-size: 28px;
            font-weight: var(--font-weight-bold);
            color: var(--text-primary);
        }
        
        .page-subtitle {
            margin: 0;
            font-size: var(--font-size-base);
            color: var(--text-secondary);
            line-height: 1.5;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .back-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: white;
            border: 1px solid #e1e5e9;
            border-radius: 6px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: var(--font-size-sm);
        }
        
        .back-btn:hover {
            background: var(--bg-secondary);
            border-color: var(--primary-blue);
            color: var(--primary-blue);
        }
        
        /* Tab导航样式 */
        .analysis-tab-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 24px;
            overflow: hidden;
        }
        
        .analysis-tab-nav {
            display: flex;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-bottom: 1px solid #e1e5e9;
        }
        
        .analysis-tab-btn {
            flex: 1;
            padding: 16px 20px;
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-medium);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            border-bottom: 3px solid transparent;
        }
        
        .analysis-tab-btn:hover {
            background: rgba(0, 123, 255, 0.1);
            color: var(--primary-blue);
        }
        
        .analysis-tab-btn.active {
            background: white;
            color: var(--primary-blue);
            border-bottom-color: var(--primary-blue);
            box-shadow: 0 -2px 8px rgba(0, 123, 255, 0.2);
        }
        
        .analysis-tab-btn:not(:last-child) {
            border-right: 1px solid #e1e5e9;
        }
        
        /* Tab内容区域样式 */
        .analysis-content-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            min-height: 500px;
        }
        
        .analysis-tab-content {
            display: none;
            padding: 32px;
        }
        
        .analysis-tab-content.active {
            display: block;
        }
        
        .content-placeholder {
            text-align: center;
            padding: 80px 20px;
            color: var(--text-secondary);
        }
        
        .content-placeholder h3 {
            margin-bottom: 16px;
            color: var(--text-primary);
            font-size: 24px;
            font-weight: var(--font-weight-semibold);
        }
        
        .content-placeholder p {
            font-size: var(--font-size-base);
            line-height: 1.6;
            max-width: 600px;
            margin: 0 auto;
        }
        
        /* 功能栏按钮样式 */
        .function-left {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .function-right {
            display: flex;
            align-items: center;
        }
        
        .btn-primary, .btn-secondary {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: var(--primary-blue);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-blue-dark);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
        }
        
        .search-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .search-input {
            padding: 8px 12px;
            border: 1px solid #e1e5e9;
            border-radius: 6px;
            font-size: var(--font-size-sm);
            min-width: 250px;
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }
        
        .search-btn {
            padding: 8px 12px;
            background: var(--primary-blue);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .search-btn:hover {
            background: var(--primary-blue-dark);
        }
        
        /* 分页样式 */
        .pagination-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            padding: 16px 0;
            border-top: 1px solid #f1f3f5;
        }
        
        .pagination-info {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
        }
        
        .pagination-controls {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .pagination-btn {
            padding: 6px 12px;
            background: white;
            border: 1px solid #e1e5e9;
            border-radius: 4px;
            cursor: pointer;
            font-size: var(--font-size-sm);
            transition: all 0.2s ease;
        }
        
        .pagination-btn:not(:disabled):hover {
            background: var(--bg-secondary);
            border-color: var(--primary-blue);
        }
        
        .pagination-btn:disabled {
            cursor: not-allowed;
            opacity: 0.5;
        }
        
        .pagination-current {
            padding: 6px 12px;
            background: var(--primary-blue);
            color: white;
            border-radius: 4px;
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
        }
        
        .section-description {
            font-size: var(--font-size-sm);
            color: var(--text-hint);
            margin: 6px 0 16px 0;
            line-height: 1.4;
            padding: 10px;
            background: #e8f5e8;
            border-left: 4px solid var(--primary-green);
            border-radius: 4px;
        }
        
        .unified-card, .course-list-card {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
        }
        
        .unified-title, .list-title {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-bold);
            color: var(--text-primary);
            margin: 0 0 6px 0;
        }
        
        .unified-description {
            font-size: var(--font-size-sm);
            color: var(--text-hint);
            margin: 0 0 12px 0;
            line-height: 1.4;
        }
        
        /* 课程项目样式 */
        .course-item {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 8px;
            transition: all 0.2s ease;
        }
        
        .course-item:hover {
            border-color: var(--primary-green);
            box-shadow: 0 2px 4px rgba(50, 205, 50, 0.1);
        }
        
        .course-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .course-name {
            font-size: var(--font-size-md);
            font-weight: var(--font-weight-medium);
            color: var(--text-primary);
        }
        
        .course-status {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .status-label {
            font-size: var(--font-size-sm);
            color: var(--text-muted);
            padding: 4px 8px;
            background: #e9ecef;
            border-radius: 4px;
        }
        
        .status-label.active {
            background: var(--primary-green);
            color: white;
        }
        
        .toggle-btn {
            background: var(--primary-green);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: var(--font-size-sm);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .toggle-btn:hover {
            background: var(--hover-green);
        }
        
        .toggle-btn.secondary {
            background: #6c757d;
        }
        
        .toggle-btn.secondary:hover {
            background: #5a6268;
        }
        
        /* 独立设置表单样式 */
        .individual-form {
            background: #f8f9fa;
            border-top: 1px solid #e9ecef;
            padding: 16px;
            margin-top: 12px;
            border-radius: 0 0 6px 6px;
            display: none;
        }
        
        .individual-form.show {
            display: block;
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                max-height: 0;
                padding-top: 0;
                padding-bottom: 0;
            }
            to {
                opacity: 1;
                max-height: 800px;
                padding-top: 16px;
                padding-bottom: 16px;
            }
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .modal-content {
                width: 98%;
                margin: 10px auto;
                max-height: calc(100vh - 20px);
            }
            
            .info-header, .batch-info-header {
                grid-template-columns: 1fr;
                gap: 12px;
                padding: 12px;
            }
            
            .modal-body {
                padding: 12px;
            }
            
            .form-grid {
                gap: 12px;
            }
            
            .form-field {
                padding: 8px 12px;
                gap: 8px;
            }
            
            .field-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 6px;
            }
            
            .field-title-group {
                flex-direction: column;
                align-items: flex-start;
                gap: 4px;
            }
            
            .switch-wrapper {
                align-self: flex-end;
            }
            
            .date-range-wrapper {
                flex-direction: column;
                gap: 6px;
            }
            
            .date-separator {
                align-self: center;
                display: none;
            }
            
            .combo-input {
                flex-wrap: wrap;
                gap: 6px;
            }
            
            .modal-footer {
                padding: 16px;
                flex-direction: column;
                gap: 8px;
            }
            
            .btn {
                width: 100%;
            }
        }
        
        .content-area {
            flex: 1;
            padding: 0;
        }
        
        .top-navigation {
            display: flex;
            background: white;
            border-bottom: 1px solid #ddd;
        }
        
        .nav-tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            background: white;
            border-right: 1px solid #ddd;
            cursor: pointer;
            color: #666;
            font-weight: 500;
        }
        
        .nav-tab:last-child {
            border-right: none;
        }
        
        .nav-tab:hover, .nav-tab.active {
            background: var(--primary-green);
            color: white;
        }
        
        .container {
            max-width: none;
            margin: 0;
            background-color: white;
            padding: 30px;
            border-radius: 0;
            box-shadow: none;
        }
        
        h1 {
            color: var(--dark-green);
            text-align: center;
            border-bottom: 3px solid var(--primary-green);
            padding-bottom: 15px;
            margin-bottom: 30px;
            font-size: 2.2em;
        }
        
        h2 {
            color: #333;
            margin: 30px 0 20px 0;
            font-size: 1.5em;
        }
        .table-container {
            margin: 20px 0;
            overflow-x: auto;
            background: white;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .student-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        
        .student-table th {
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            padding: 12px 8px;
            text-align: center;
            font-weight: bold;
            color: #333;
            white-space: nowrap;
        }
        
        .student-table td {
            border: 1px solid #ddd;
            padding: 10px 8px;
            vertical-align: middle;
            color: #555;
            text-align: center;
        }
        
        .student-table tbody tr:hover {
            background-color: #f8f9fa;
        }
        
        .student-name {
            font-weight: bold;
            color: #333;
            white-space: nowrap;
        }
        
        .course-link {
            color: #1e90ff;
            text-decoration: underline;
            cursor: pointer;
        }
        
        .course-link:hover {
            color: #4169e1;
            text-decoration: none;
        }
        
        /* 课程单元格样式 */
        .course-cell {
            position: relative;
            padding: 10px 8px;
        }
        
        /* 课程订阅入口样式 - 文字版本 */
        .course-subscribe-btn {
            position: absolute;
            top: 2px;
            right: 2px;
            background: none;
            color: #ffa500;
            border: none;
            border-radius: 0;
            width: auto;
            height: auto;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            opacity: 1;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            padding: 1px 3px;
            line-height: 1;
        }
        
        /* 已订阅状态的文字 */
        .course-subscribe-btn.subscribed {
            color: #28a745;
            text-decoration: none;
            cursor: default;
            pointer-events: none;
        }
        
        /* 订阅文字始终可见，无需悬浮显示 */
        
        /* 订阅按钮悬浮效果 - 轻微放大和下划线 */
        .course-subscribe-btn:hover {
            transform: scale(1.1);
            text-decoration: underline;
        }
        
        /* 已订阅按钮不响应悬浮效果 */
        .course-subscribe-btn.subscribed:hover {
            transform: none;
            text-decoration: none;
        }
        
        /* 本校意向课程的订阅按钮 */
        .course-subscribe-btn.home-course {
            color: #ffa500;
            font-weight: bold;
        }
        
        .course-subscribe-btn.home-course:hover {
            transform: scale(1.1);
            text-decoration: underline;
        }
        
        /* 已订阅的本校课程按钮不响应悬浮效果 */
        .course-subscribe-btn.home-course.subscribed:hover {
            transform: none;
            text-decoration: none;
        }
        
        .course-subscribe-btn.home-course.subscribed {
            color: #28a745;
            cursor: default;
            pointer-events: none;
        }
        
        /* 确保课程链接文本不受影响 */
        .course-link {
            display: block;
            padding-right: 25px; /* 为订阅按钮留出空间 */
            line-height: 1.4;
        }
        
        /* 旧的订阅按钮样式保留以防其他地方使用 */
        .subscribe-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: var(--primary-green);
            color: white;
            border: none;
            border-radius: 15px;
            height: 24px;
            font-size: 11px;
            cursor: pointer;
            opacity: 0;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 8px;
            min-width: 20px;
            white-space: nowrap;
        }
        
        .subscribe-btn .btn-icon {
            display: inline-block;
        }
        
        .subscribe-btn .btn-text {
            display: none;
            margin-left: 4px;
            font-size: 10px;
        }
        
        .course-cell:hover .subscribe-btn {
            opacity: 1;
        }
        
        .course-cell:hover .subscribe-btn .btn-text {
            display: inline-block;
        }
        
        .subscribe-btn:hover {
            background: var(--hover-green);
            transform: scale(1.1);
        }
        
        .subscribe-btn.home-course {
            background: #007bff;
        }
        
        .subscribe-btn.home-course:hover {
            background: #0056b3;
            transform: scale(1.1);
        }
        
        .course-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .course-card {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .course-card:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        .course-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        .course-info {
            margin: 8px 0;
            color: #555;
        }
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .status.active {
            background-color: var(--primary-green);
            color: white;
        }
        .status.pending {
            background-color: #ffc107;
            color: #333;
        }
        .status.completed {
            background-color: #6c757d;
            color: white;
        }
        .subscription-form {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 4px;
            margin: 25px 0;
            border: 1px solid #ddd;
        }
        

        

        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .sub-content {
            display: block;
        }
        .form-group {
            margin-bottom: 18px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        input, select, textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-green);
        }
        button {
            background-color: var(--primary-green);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: var(--hover-green);
        }
        .footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
            color: #666;
        }
        
        .stats-number {
            font-size: 2em; 
            color: var(--primary-green); 
            text-align: center; 
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">🌱 LightCourseCRM</div>
        <div class="breadcrumb">客户关系管理系统 > 课程管理 > 课程订阅信息</div>
    </div>
    
    <div class="main-layout">
        <div class="content-area">
            <div class="top-navigation">
                <div class="nav-tab">大学中心</div>
                <div class="nav-tab">产品中心</div>
                <div class="nav-tab active">学生中心</div>
            </div>
            
            <div class="container">
                <div id="content-area">
                    <!-- 大学中心内容 -->
                    <div id="university-center" class="tab-content" style="display: none;">
                        <div style="text-align: center; padding: 100px 0; color: #999;">
                            <h2>大学中心</h2>
                            <p>内容开发中...</p>
                        </div>
                    </div>
                    
                    <!-- 产品中心内容 -->
                    <div id="product-center" class="tab-content" style="display: none;">
                        <div style="text-align: center; padding: 100px 0; color: #999;">
                            <h2>产品中心</h2>
                            <p>内容开发中...</p>
                        </div>
                    </div>
                    
                    <!-- 学生中心内容 -->
                    <div id="student-center" class="tab-content">
                        <div class="student-layout">
                            <!-- 学生中心的左侧边栏 -->
                            <div class="student-sidebar">
                                <div class="sidebar-section">
                                    <div class="sidebar-title active" data-target="student-service">学生服务</div>
                                </div>
                                
                                <div class="sidebar-section">
                                    <div class="sidebar-title" data-target="student-follow">学生跟进LC</div>
                                </div>
                            </div>
                            
                            <!-- 学生中心的主内容区 -->
                            <div class="student-content">
                                
                                <!-- 学生服务内容 -->
                                <div id="student-service" class="sub-content">
                                    <!-- 功能栏 -->
                                    <div class="function-bar">
                                        <div class="batch-subscribe-dropdown" id="batchSubscribeDropdown">
                                            <button class="function-btn batch-subscribe-btn" id="batchSubscribeBtn" disabled>
                                                <span class="btn-icon">🔔</span>
                                                <span class="btn-text">批量订阅</span>
                                                <span class="dropdown-arrow">▼</span>
                                            </button>
                                            <div class="dropdown-menu" id="dropdownMenu">
                                                <button class="dropdown-item" data-type="home">
                                                    <span class="btn-icon">📋</span>
                                                    <span class="btn-text">订阅本校课程</span>
                                                </button>
                                                <button class="dropdown-item" data-type="product">
                                                    <span class="btn-icon">🔔</span>
                                                    <span class="btn-text">订阅产品课程</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="table-container">
                                        <table class="student-table">
                                            <thead>
                                                <tr>
                                                    <th>选择</th>
                                                    <th>学生姓名</th>
                                                    <th>学生学校</th>
                                                    <th>本校意向课程</th>
                                                    <th>已选课程</th>
                                                    <th>上课形式</th>
                                                    <th>学习周期</th>
                                                    <th>班级代码</th>
                                                    <th>状态</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- Baoyan Han - 第一门意向课程的三个产品课程 -->
                                                <tr>
                                                    <td><input type="checkbox" class="course-checkbox" /></td>
                                                    <td class="student-name" rowspan="3">Baoyan Han</td>
                                                    <td rowspan="3">The Ohio State University</td>
                                                    <td rowspan="3" class="course-cell">
                                                        <span class="course-link">HTHRHSC 3400</span> (Introduction to Health Promotion and Disease Prevention)
                                                        <button class="course-subscribe-btn home-course" onclick="subscribeSingleCourse(this, 'home')" title="订阅本校意向课程">订阅</button>
                                                    </td>
                                                    <td class="course-cell">
                                                        <span class="course-link">EXSC 221</span> (Science of Wellness) - Brigham Young University
                                                        <button class="course-subscribe-btn" onclick="subscribeSingleCourse(this, 'product')" title="订阅产品课程">订阅</button>
                                                    </td>
                                                    <td>Self-Paced, Asynchronous ⚠️</td>
                                                    <td>2025-09-18 到 2026-09-18</td>
                                                    <td>EXSC 22108</td>
                                                    <td><span class="status completed">认证成功 已确认</span></td>
                                                </tr>
                                                <tr>
                                                    <td><input type="checkbox" class="course-checkbox" /></td>
                                                    <td class="course-cell">
                                                        <span class="course-link">HLTH 2010</span> (Personal Health and Wellness) - Arizona State University
                                                        <button class="course-subscribe-btn" onclick="subscribeSingleCourse(this, 'product')" title="订阅产品课程">订阅</button>
                                                    </td>
                                                    <td>Scheduled, Synchronous</td>
                                                    <td>2025-11-01 到 2026-05-01</td>
                                                    <td>HLTH 20103</td>
                                                    <td><span class="status pending">待认证</span></td>
                                                </tr>
                                                <tr>
                                                    <td><input type="checkbox" class="course-checkbox" /></td>
                                                    <td class="course-cell">
                                                        <span class="course-link">KINE 1304</span> (Health and Fitness for Life) - Utah State University
                                                        <button class="course-subscribe-btn" onclick="subscribeSingleCourse(this, 'product')" title="订阅产品课程">订阅</button>
                                                    </td>
                                                    <td>Self-Paced, Asynchronous</td>
                                                    <td>2025-12-01 到 2026-06-01</td>
                                                    <td>KINE 13042</td>
                                                    <td><span class="status active">进行中</span></td>
                                                </tr>
                                                
                                                <!-- Sarah Johnson - 第一门意向课程 -->
                                                <tr>
                                                    <td><input type="checkbox" class="course-checkbox" /></td>
                                                    <td class="student-name" rowspan="3">Sarah Johnson</td>
                                                    <td rowspan="3">University of California, Berkeley</td>
                                                    <td class="course-cell">
                                                        <span class="course-link">PSYC 2145</span> (Cognitive Psychology)
                                                        <button class="course-subscribe-btn home-course" onclick="subscribeSingleCourse(this, 'home')" title="订阅本校意向课程">订阅</button>
                                                    </td>
                                                    <td class="course-cell">
                                                        <span class="course-link">PSYC 111</span> (Introduction to Psychology) - Arizona State University
                                                        <button class="course-subscribe-btn" onclick="subscribeSingleCourse(this, 'product')" title="订阅产品课程">订阅</button>
                                                    </td>
                                                    <td>Scheduled, Synchronous</td>
                                                    <td>2025-08-25 到 2025-12-15</td>
                                                    <td>PSYC 11103</td>
                                                    <td><span class="status active">进行中</span></td>
                                                </tr>
                                                
                                                <!-- Sarah Johnson - 第二门意向课程 -->
                                                <tr>
                                                    <td><input type="checkbox" class="course-checkbox" /></td>
                                                    <td class="course-cell">
                                                        <span class="course-link">STAT 3021</span> (Statistical Methods)
                                                        <button class="course-subscribe-btn home-course" onclick="subscribeSingleCourse(this, 'home')" title="订阅本校意向课程">订阅</button>
                                                    </td>
                                                    <td class="course-cell">
                                                        <span class="course-link">STAT 1040</span> (Introduction to Statistics) - Brigham Young University
                                                        <button class="course-subscribe-btn" onclick="subscribeSingleCourse(this, 'product')" title="订阅产品课程">订阅</button>
                                                    </td>
                                                    <td>Self-Paced, Asynchronous</td>
                                                    <td>2025-10-15 到 2026-04-15</td>
                                                    <td>STAT 10401</td>
                                                    <td><span class="status pending">待认证</span></td>
                                                </tr>
                                                
                                                <!-- Sarah Johnson - 第三门意向课程 -->
                                                <tr>
                                                    <td><input type="checkbox" class="course-checkbox" /></td>
                                                    <td class="course-cell">
                                                        <span class="course-link">BIOL 1A03</span> (Introductory Biology)
                                                        <button class="course-subscribe-btn home-course" onclick="subscribeSingleCourse(this, 'home')" title="订阅本校意向课程">订阅</button>
                                                    </td>
                                                    <td class="course-cell">
                                                        <span class="course-link">BIOL 1010</span> (General Biology) - Utah State University
                                                        <button class="course-subscribe-btn" onclick="subscribeSingleCourse(this, 'product')" title="订阅产品课程">订阅</button>
                                                    </td>
                                                    <td>Scheduled, Synchronous</td>
                                                    <td>2025-09-01 到 2025-12-20</td>
                                                    <td>BIOL 10105</td>
                                                    <td><span class="status completed">认证成功 已确认</span></td>
                                                </tr>
                                                
                                                <!-- Michael Chen -->
                                                <tr>
                                                    <td><input type="checkbox" class="course-checkbox" /></td>
                                                    <td class="student-name">Michael Chen</td>
                                                    <td>Massachusetts Institute of Technology</td>
                                                    <td class="course-cell">
                                                        <span class="course-link">CS 6.006</span> (Introduction to Algorithms)
                                                        <button class="course-subscribe-btn home-course" onclick="subscribeSingleCourse(this, 'home')" title="订阅本校意向课程">订阅</button>
                                                    </td>
                                                    <td class="course-cell">
                                                        <span class="course-link">CS 1400</span> (Computer Science I) - Utah State University
                                                        <button class="course-subscribe-btn" onclick="subscribeSingleCourse(this, 'product')" title="订阅产品课程">订阅</button>
                                                    </td>
                                                    <td>Self-Paced, Asynchronous</td>
                                                    <td>2025-10-01 到 2026-04-01</td>
                                                    <td>CS 140002</td>
                                                    <td><span class="status pending">待认证</span></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                        
                                </div>
                                
                                <!-- 学生跟进LC内容 -->
                                <div id="student-follow" class="sub-content" style="display: none;">
                                    <div class="page-header">
                                        <h1>学生跟进LC管理</h1>
                                        <p class="page-subtitle">管理学生跟进状态、查看学生报告和订阅信息</p>
                                    </div>
                                    
                                    <!-- 功能操作栏 -->
                                    <div class="function-bar">
                                        <div class="function-left">
                                            <button class="btn-primary" onclick="addStudent()">
                                                <span>➕</span>
                                                <span class="btn-text">新增学生</span>
                                            </button>
                                            <button class="btn-secondary" onclick="exportStudents()">
                                                <span>📊</span>
                                                <span class="btn-text">导出数据</span>
                                            </button>
                                            <button class="btn-secondary" onclick="refreshStudents()">
                                                <span>🔄</span>
                                                <span class="btn-text">刷新</span>
                                            </button>
                                        </div>
                                        
                                        <div class="function-right">
                                            <div class="search-container">
                                                <input type="text" id="studentSearch" placeholder="搜索学生姓名、学校或微信..." class="search-input">
                                                <button class="search-btn" onclick="searchStudents()">🔍</button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- 学生跟进数据表格 -->
                                    <div class="table-container">
                                        <table class="data-table student-follow-table">
                                            <thead>
                                                <tr>
                                                    <th class="checkbox-col">
                                                        <input type="checkbox" id="selectAllStudents" onchange="toggleAllStudents(this)">
                                                    </th>
                                                    <th class="student-name-col">学生姓名</th>
                                                    <th class="school-col">学生学校</th>
                                                    <th class="entry-time-col">流量进入时间</th>
                                                    <th class="next-follow-col">下次跟进时间</th>
                                                    <th class="status-col">跟进状态</th>
                                                    <th class="wechat-col">微信名称</th>
                                                    <th class="report-col">学生报告</th>
                                                    <th class="subscription-col">课程订阅</th>
                                                    <th class="action-col">操作</th>
                                                </tr>
                                            </thead>
                                            <tbody id="studentFollowTableBody">
                                                <tr class="student-row">
                                                    <td><input type="checkbox" class="student-checkbox" value="1"></td>
                                                    <td class="student-name">张明</td>
                                                    <td class="school-name">Harvard University</td>
                                                    <td class="entry-time">2024-10-15 14:30</td>
                                                    <td class="next-follow">2024-10-28 10:00</td>
                                                    <td class="status">
                                                        <span class="status-badge status-pending">待跟进</span>
                                                    </td>
                                                    <td class="wechat-name">明明学习</td>
                                                    <td class="report-status">
                                                        <button class="btn-link" onclick="viewReport(1)">查看报告</button>
                                                    </td>
                                                    <td class="subscription-info">
                                                        <button class="btn-link" onclick="viewSubscriptionInfo('张明')">查看订阅信息</button>
                                                    </td>
                                                    <td class="actions">
                                                        <button class="btn-edit" onclick="editStudent(1)" title="编辑">✏️</button>
                                                        <button class="btn-follow" onclick="addFollowRecord(1)" title="跟进">📝</button>
                                                        <button class="btn-delete" onclick="deleteStudent(1)" title="删除">🗑️</button>
                                                    </td>
                                                </tr>
                                                <tr class="student-row">
                                                    <td><input type="checkbox" class="student-checkbox" value="2"></td>
                                                    <td class="student-name">李小雨</td>
                                                    <td class="school-name">Stanford University</td>
                                                    <td class="entry-time">2024-10-18 09:20</td>
                                                    <td class="next-follow">2024-10-29 15:30</td>
                                                    <td class="status">
                                                        <span class="status-badge status-following">跟进中</span>
                                                    </td>
                                                    <td class="wechat-name">雨天学习</td>
                                                    <td class="report-status">
                                                        <button class="btn-link" onclick="viewReport(2)">查看报告</button>
                                                    </td>
                                                    <td class="subscription-info">
                                                        <button class="btn-link" onclick="viewSubscriptionInfo('李小雨')">查看订阅信息</button>
                                                    </td>
                                                    <td class="actions">
                                                        <button class="btn-edit" onclick="editStudent(2)" title="编辑">✏️</button>
                                                        <button class="btn-follow" onclick="addFollowRecord(2)" title="跟进">📝</button>
                                                        <button class="btn-delete" onclick="deleteStudent(2)" title="删除">🗑️</button>
                                                    </td>
                                                </tr>
                                                <tr class="student-row">
                                                    <td><input type="checkbox" class="student-checkbox" value="3"></td>
                                                    <td class="student-name">王晓华</td>
                                                    <td class="school-name">University of Toronto</td>
                                                    <td class="entry-time">2024-10-20 16:45</td>
                                                    <td class="next-follow">2024-10-30 11:00</td>
                                                    <td class="status">
                                                        <span class="status-badge status-completed">已完成</span>
                                                    </td>
                                                    <td class="wechat-name">小华同学</td>
                                                    <td class="report-status">
                                                        <button class="btn-link" onclick="viewReport(3)">查看报告</button>
                                                    </td>
                                                    <td class="subscription-info">
                                                        <button class="btn-link" onclick="viewSubscriptionInfo('王晓华')">查看订阅信息</button>
                                                    </td>
                                                    <td class="actions">
                                                        <button class="btn-edit" onclick="editStudent(3)" title="编辑">✏️</button>
                                                        <button class="btn-follow" onclick="addFollowRecord(3)" title="跟进">📝</button>
                                                        <button class="btn-delete" onclick="deleteStudent(3)" title="删除">🗑️</button>
                                                    </td>
                                                </tr>
                                                <tr class="student-row">
                                                    <td><input type="checkbox" class="student-checkbox" value="4"></td>
                                                    <td class="student-name">陈思远</td>
                                                    <td class="school-name">University of British Columbia</td>
                                                    <td class="entry-time">2024-10-22 13:15</td>
                                                    <td class="next-follow">2024-10-31 14:00</td>
                                                    <td class="status">
                                                        <span class="status-badge status-pending">待跟进</span>
                                                    </td>
                                                    <td class="wechat-name">思远学子</td>
                                                    <td class="report-status">
                                                        <button class="btn-link" onclick="viewReport(4)">查看报告</button>
                                                    </td>
                                                    <td class="subscription-info">
                                                        <button class="btn-link" onclick="viewSubscriptionInfo('陈思远')">查看订阅信息</button>
                                                    </td>
                                                    <td class="actions">
                                                        <button class="btn-edit" onclick="editStudent(4)" title="编辑">✏️</button>
                                                        <button class="btn-follow" onclick="addFollowRecord(4)" title="跟进">📝</button>
                                                        <button class="btn-delete" onclick="deleteStudent(4)" title="删除">🗑️</button>
                                                    </td>
                                                </tr>
                                                <tr class="student-row">
                                                    <td><input type="checkbox" class="student-checkbox" value="5"></td>
                                                    <td class="student-name">刘佳妮</td>
                                                    <td class="school-name">McGill University</td>
                                                    <td class="entry-time">2024-10-25 10:30</td>
                                                    <td class="next-follow">2024-11-01 09:30</td>
                                                    <td class="status">
                                                        <span class="status-badge status-following">跟进中</span>
                                                    </td>
                                                    <td class="wechat-name">佳妮加油</td>
                                                    <td class="report-status">
                                                        <button class="btn-link" onclick="viewReport(5)">查看报告</button>
                                                    </td>
                                                    <td class="subscription-info">
                                                        <button class="btn-link" onclick="viewSubscriptionInfo('刘佳妮')">查看订阅信息</button>
                                                    </td>
                                                    <td class="actions">
                                                        <button class="btn-edit" onclick="editStudent(5)" title="编辑">✏️</button>
                                                        <button class="btn-follow" onclick="addFollowRecord(5)" title="跟进">📝</button>
                                                        <button class="btn-delete" onclick="deleteStudent(5)" title="删除">🗑️</button>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    
                                    <!-- 分页控件 -->
                                    <div class="pagination-container">
                                        <div class="pagination-info">
                                            共 5 条记录，第 1/1 页
                                        </div>
                                        <div class="pagination-controls">
                                            <button class="pagination-btn" disabled>上一页</button>
                                            <span class="pagination-current">1</span>
                                            <button class="pagination-btn" disabled>下一页</button>
                                        </div>
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 学生选课分析页面 -->
    <div id="student-analysis-page" class="page-container" style="display: none;">
        <div class="container">
            <!-- 页面头部 -->
            <div class="page-header">
                <div class="header-left">
                    <button class="back-btn" onclick="backToStudentFollow()">
                        <span>←</span>
                        <span>返回学生跟进</span>
                    </button>
                    <h1 id="student-analysis-title">学生选课分析</h1>
                    <p class="page-subtitle">查看学生详细档案、选课情况和分析报告</p>
                </div>
            </div>
            
            <!-- Tab导航栏 -->
            <div class="analysis-tab-container">
                <div class="analysis-tab-nav">
                    <button class="analysis-tab-btn active" data-target="student-profile">学生档案</button>
                    <button class="analysis-tab-btn" data-target="autonomous-selection">自主选课</button>
                    <button class="analysis-tab-btn" data-target="selected-courses">学生已选课程</button>
                    <button class="analysis-tab-btn" data-target="report-management">选课报告管理</button>
                    <button class="analysis-tab-btn" data-target="subscription-info">课程订阅中心</button>
                </div>
            </div>
            
            <!-- Tab内容区域 -->
            <div class="analysis-content-container">
                <!-- 学生档案 -->
                <div id="student-profile" class="analysis-tab-content active">
                    <div class="student-profile-form">
                        <form id="studentProfileForm">
                            <!-- 学生姓名 -->
                            <div class="profile-form-field">
                                <label for="studentName">学生姓名</label>
                                <input type="text" id="studentName" name="studentName" value="" disabled>
                            </div>
                            
                            <!-- 学生学校 -->
                            <div class="profile-form-field">
                                <label for="studentSchool">学生学校</label>
                                <input type="text" id="studentSchool" name="studentSchool" value="" disabled>
                            </div>
                            
                            <!-- 转学分需求 -->
                            <div class="profile-form-field">
                                <label>转学分需求</label>
                                <div class="profile-radio-group">
                                    <div class="profile-radio-option">
                                        <input type="radio" id="creditTransferYes" name="creditTransfer" value="yes" checked>
                                        <label for="creditTransferYes">是</label>
                                    </div>
                                    <div class="profile-radio-option">
                                        <input type="radio" id="creditTransferNo" name="creditTransfer" value="no">
                                        <label for="creditTransferNo">否</label>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 上课目的 -->
                            <div class="profile-form-field">
                                <label>上课目的</label>
                                <div class="profile-checkbox-group">
                                    <div class="profile-checkbox-option">
                                        <input type="checkbox" id="purposeGraduation" name="coursePurpose" value="graduation" checked>
                                        <label for="purposeGraduation">毕业</label>
                                    </div>
                                    <div class="profile-checkbox-option">
                                        <input type="checkbox" id="purposeTransfer" name="coursePurpose" value="transfer">
                                        <label for="purposeTransfer">转学</label>
                                    </div>
                                    <div class="profile-checkbox-option">
                                        <input type="checkbox" id="purposeGradSchool" name="coursePurpose" value="gradschool" checked>
                                        <label for="purposeGradSchool">申研</label>
                                    </div>
                                    <div class="profile-checkbox-option">
                                        <input type="checkbox" id="purposeStudyAbroad" name="coursePurpose" value="studyabroad">
                                        <label for="purposeStudyAbroad">游学</label>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 学生本校毕业要求 -->
                            <div class="profile-form-field">
                                <label for="graduationRequirements">学生本校毕业要求</label>
                                <div class="file-upload-area" onclick="document.getElementById('graduationReqFile').click()">
                                    <div class="file-upload-icon">📄</div>
                                    <div class="file-upload-text">将文件拖到此处，或点击上传</div>
                                    <div class="file-upload-hint">支持 PDF、Word、图片等格式，最大 10MB</div>
                                </div>
                                <input type="file" id="graduationReqFile" name="graduationReqFile" style="display: none;" multiple accept=".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif">
                                <div id="uploadedFiles" class="uploaded-files" style="display: none;">
                                    <!-- 已上传的文件将显示在这里 -->
                                </div>
                            </div>
                            
                            <!-- 提交按钮 -->
                            <button type="submit" class="profile-submit-btn">提交档案搜集</button>
                        </form>
                    </div>
                </div>
                
                <!-- 自主选课 -->
                <div id="autonomous-selection" class="analysis-tab-content">
                    <div class="autonomous-course-container">
                        <table class="course-table-excel">
                            <thead>
                                <tr>
                                    <th>选择</th>
                                    <th>课程代码</th>
                                    <th>课程名称</th>
                                    <th>本校通识类别</th>
                                    <th>课程对应</th>
                                    <th>课程类型</th>
                                    <th>对应在售课程单元</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="checkbox-cell"><input type="checkbox" class="course-checkbox" /></td>
                                    <td class="course-code-cell">MATH 21A</td>
                                    <td class="course-name-cell">Multivariable Calculus</td>
                                    <td class="general-category-cell">数学与逻辑推理</td>
                                    <td class="correspondence-cell correspondence-available">对应(20)</td>
                                    <td><span class="course-type-badge type-lecture">Lecture</span></td>
                                    <td class="available-units-cell units-available">可售(153)</td>
                                </tr>
                                <tr>
                                    <td class="checkbox-cell"><input type="checkbox" class="course-checkbox" /></td>
                                    <td class="course-code-cell">CHEM 17</td>
                                    <td class="course-name-cell">Principles of General Chemistry</td>
                                    <td class="general-category-cell">自然科学</td>
                                    <td class="correspondence-cell correspondence-available">对应(15)</td>
                                    <td><span class="course-type-badge type-lecture">Lecture</span></td>
                                    <td class="available-units-cell units-available">可售(87)</td>
                                </tr>
                                <tr>
                                    <td class="checkbox-cell"><input type="checkbox" class="course-checkbox" /></td>
                                    <td class="course-code-cell">CHEM 17L</td>
                                    <td class="course-name-cell">General Chemistry Laboratory</td>
                                    <td class="general-category-cell">自然科学</td>
                                    <td class="correspondence-cell correspondence-available">对应(6)</td>
                                    <td><span class="course-type-badge type-lab">Lab</span></td>
                                    <td class="available-units-cell units-available">可售(45)</td>
                                </tr>
                                <tr>
                                    <td class="checkbox-cell"><input type="checkbox" class="course-checkbox" /></td>
                                    <td class="course-code-cell">PSYC 1</td>
                                    <td class="course-name-cell">Introduction to Psychology</td>
                                    <td class="general-category-cell">社会科学</td>
                                    <td class="correspondence-cell correspondence-available">对应(12)</td>
                                    <td><span class="course-type-badge type-lecture">Lecture</span></td>
                                    <td class="available-units-cell units-available">可售(92)</td>
                                </tr>
                                <tr>
                                    <td class="checkbox-cell"><input type="checkbox" class="course-checkbox" /></td>
                                    <td class="course-code-cell">ENGL 10A</td>
                                    <td class="course-name-cell">Expository Writing</td>
                                    <td class="general-category-cell">语言文学</td>
                                    <td class="correspondence-cell correspondence-available">对应(8)</td>
                                    <td><span class="course-type-badge type-studio">Studio</span></td>
                                    <td class="available-units-cell units-available">可售(67)</td>
                                </tr>
                                <tr>
                                    <td class="checkbox-cell"><input type="checkbox" class="course-checkbox" /></td>
                                    <td class="course-code-cell">PHIL 144</td>
                                    <td class="course-name-cell">Philosophy of Mind</td>
                                    <td class="general-category-cell">哲学思辨</td>
                                    <td class="correspondence-cell correspondence-none">暂无</td>
                                    <td><span class="course-type-badge type-lecture">Lecture</span></td>
                                    <td class="available-units-cell units-none">暂无可售</td>
                                </tr>
                                <tr>
                                    <td class="checkbox-cell"><input type="checkbox" class="course-checkbox" /></td>
                                    <td class="course-code-cell">STAT 104</td>
                                    <td class="course-name-cell">Introduction to Statistics</td>
                                    <td class="general-category-cell">数学与逻辑推理</td>
                                    <td class="correspondence-cell correspondence-available">对应(18)</td>
                                    <td><span class="course-type-badge type-lecture">Lecture</span></td>
                                    <td class="available-units-cell units-available">可售(124)</td>
                                </tr>
                                <tr>
                                    <td class="checkbox-cell"><input type="checkbox" class="course-checkbox" /></td>
                                    <td class="course-code-cell">HIST 1430</td>
                                    <td class="course-name-cell">The United States in the World</td>
                                    <td class="general-category-cell">历史文化</td>
                                    <td class="correspondence-cell correspondence-available">对应(10)</td>
                                    <td><span class="course-type-badge type-lecture">Lecture</span></td>
                                    <td class="available-units-cell units-available">可售(73)</td>
                                </tr>
                                <tr>
                                    <td class="checkbox-cell"><input type="checkbox" class="course-checkbox" /></td>
                                    <td class="course-code-cell">VES 10A</td>
                                    <td class="course-name-cell">Drawing I</td>
                                    <td class="general-category-cell">艺术审美</td>
                                    <td class="correspondence-cell correspondence-available">对应(4)</td>
                                    <td><span class="course-type-badge type-studio">Studio</span></td>
                                    <td class="available-units-cell units-available">可售(28)</td>
                                </tr>
                                <tr>
                                    <td class="checkbox-cell"><input type="checkbox" class="course-checkbox" /></td>
                                    <td class="course-code-cell">ECON 10A</td>
                                    <td class="course-name-cell">Principles of Economics</td>
                                    <td class="general-category-cell">社会科学</td>
                                    <td class="correspondence-cell correspondence-available">对应(25)</td>
                                    <td><span class="course-type-badge type-lecture">Lecture</span></td>
                                    <td class="available-units-cell units-available">可售(156)</td>
                                </tr>
                                <tr>
                                    <td class="checkbox-cell"><input type="checkbox" class="course-checkbox" /></td>
                                    <td class="course-code-cell">BIOL 50</td>
                                    <td class="course-name-cell">Introductory Biology</td>
                                    <td class="general-category-cell">自然科学</td>
                                    <td class="correspondence-cell correspondence-available">对应(14)</td>
                                    <td><span class="course-type-badge type-lecture">Lecture</span></td>
                                    <td class="available-units-cell units-available">可售(98)</td>
                                </tr>
                                <tr>
                                    <td class="checkbox-cell"><input type="checkbox" class="course-checkbox" /></td>
                                    <td class="course-code-cell">BIOL 50L</td>
                                    <td class="course-name-cell">Introductory Biology Laboratory</td>
                                    <td class="general-category-cell">自然科学</td>
                                    <td class="correspondence-cell correspondence-available">对应(6)</td>
                                    <td><span class="course-type-badge type-lab">Lab</span></td>
                                    <td class="available-units-cell units-available">可售(42)</td>
                                </tr>
                                <tr>
                                    <td class="checkbox-cell"><input type="checkbox" class="course-checkbox" /></td>
                                    <td class="course-code-cell">GENED 1001</td>
                                    <td class="course-name-cell">Stories from the End of the World</td>
                                    <td class="general-category-cell">跨学科研究</td>
                                    <td class="correspondence-cell correspondence-none">暂无</td>
                                    <td><span class="course-type-badge type-lecture">Lecture</span></td>
                                    <td class="available-units-cell units-none">暂无可售</td>
                                </tr>
                                <tr>
                                    <td class="checkbox-cell"><input type="checkbox" class="course-checkbox" /></td>
                                    <td class="course-code-cell">CS 50</td>
                                    <td class="course-name-cell">Introduction to Computer Science</td>
                                    <td class="general-category-cell">计算思维</td>
                                    <td class="correspondence-cell correspondence-available">对应(22)</td>
                                    <td><span class="course-type-badge type-lecture">Lecture</span></td>
                                    <td class="available-units-cell units-available">可售(189)</td>
                                </tr>
                                <tr>
                                    <td class="checkbox-cell"><input type="checkbox" class="course-checkbox" /></td>
                                    <td class="course-code-cell">PHYS 11</td>
                                    <td class="course-name-cell">Mechanics and Relativity</td>
                                    <td class="general-category-cell">自然科学</td>
                                    <td class="correspondence-cell correspondence-available">对应(16)</td>
                                    <td><span class="course-type-badge type-lecture">Lecture</span></td>
                                    <td class="available-units-cell units-available">可售(76)</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- 学生已选课程 -->
                <div id="selected-courses" class="analysis-tab-content">
                    <div class="selected-courses-container">
                        <table class="selected-courses-table">
                            <thead>
                                <tr>
                                    <th>选择</th>
                                    <th>本校课程</th>
                                    <th>课程满足类别、场景</th>
                                    <th>当前状态</th>
                                    <th>审核状态</th>
                                    <th>产品课程</th>
                                    <th>产品学校</th>
                                    <th>上课日期</th>
                                    <th>价格</th>
                                    <th>班级代码</th>
                                    <th>课程时长</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- MATH 21A 对应的多门产品课程 -->
                                <tr>
                                    <td class="checkbox-cell"><input type="checkbox" class="course-checkbox" /></td>
                                    <td class="home-course-cell merged-cell" rowspan="2">MATH 21A</td>
                                    <td class="merged-cell" rowspan="2"><span class="course-category-badge category-required">专业必修课</span></td>
                                    <td class="merged-cell status-serving" rowspan="2">服务中</td>
                                    <td class="merged-cell" rowspan="2"><span class="audit-status-text audit-ai-passed">AI审核通过</span></td>
                                    <td class="product-course-cell">
                                        <span class="product-course-code">MATH 2210</span>
                                        <span class="product-course-name">Multivariable Calculus</span>
                                    </td>
                                    <td class="product-school-cell">University of Toronto</td>
                                    <td class="date-cell">2025-10-20~2025-12-13</td>
                                    <td class="price-cell">1500美元</td>
                                    <td class="code-cell">001</td>
                                    <td class="duration-cell">8周</td>
                                </tr>
                                <tr>
                                    <td class="checkbox-cell"><input type="checkbox" class="course-checkbox" /></td>
                                    <td class="product-course-cell">
                                        <span class="product-course-code">MATH 264</span>
                                        <span class="product-course-name">Vector Calculus</span>
                                    </td>
                                    <td class="product-school-cell">McGill University</td>
                                    <td class="date-cell">2025-11-05~2025-12-28</td>
                                    <td class="price-cell">1380美元</td>
                                    <td class="code-cell">002</td>
                                    <td class="duration-cell">8周</td>
                                </tr>
                                
                                <!-- CHEM 17 单门产品课程 -->
                                <tr>
                                    <td class="checkbox-cell"><input type="checkbox" class="course-checkbox" /></td>
                                    <td class="home-course-cell">CHEM 17</td>
                                    <td><span class="course-category-badge category-required">专业必修课</span></td>
                                    <td class="status-potential">潜在价值</td>
                                    <td><span class="audit-status-text audit-not-submitted">未提交审核</span></td>
                                    <td class="product-course-cell">
                                        <span class="product-course-code">CHEM 1000</span>
                                        <span class="product-course-name">Chemical Principles</span>
                                    </td>
                                    <td class="product-school-cell">University of British Columbia</td>
                                    <td class="date-cell">2025-11-12~2026-02-15</td>
                                    <td class="price-cell">1680美元</td>
                                    <td class="code-cell">003</td>
                                    <td class="duration-cell">14周</td>
                                </tr>
                                
                                <!-- PSYC 1 对应的三门产品课程 -->
                                <tr>
                                    <td class="checkbox-cell"><input type="checkbox" class="course-checkbox" /></td>
                                    <td class="home-course-cell merged-cell" rowspan="3">PSYC 1</td>
                                    <td class="merged-cell" rowspan="3"><span class="course-category-badge category-general">通识课</span></td>
                                    <td class="merged-cell status-serving" rowspan="3">服务中</td>
                                    <td class="merged-cell" rowspan="3"><span class="audit-status-text audit-ai-passed">AI审核通过</span></td>
                                    <td class="product-course-cell">
                                        <span class="product-course-code">PSYC 100</span>
                                        <span class="product-course-name">Introduction to Psychology</span>
                                    </td>
                                    <td class="product-school-cell">Stanford University</td>
                                    <td class="date-cell">2025-10-28~2025-12-20</td>
                                    <td class="price-cell">1420美元</td>
                                    <td class="code-cell">004</td>
                                    <td class="duration-cell">8周</td>
                                </tr>
                                <tr>
                                    <td class="checkbox-cell"><input type="checkbox" class="course-checkbox" /></td>
                                    <td class="product-course-cell">
                                        <span class="product-course-code">PSYC 1001</span>
                                        <span class="product-course-name">Psychology Fundamentals</span>
                                    </td>
                                    <td class="product-school-cell">University of Toronto</td>
                                    <td class="date-cell">2025-11-15~2026-01-10</td>
                                    <td class="price-cell">1350美元</td>
                                    <td class="code-cell">005</td>
                                    <td class="duration-cell">8周</td>
                                </tr>
                                <tr>
                                    <td class="checkbox-cell"><input type="checkbox" class="course-checkbox" /></td>
                                    <td class="product-course-cell">
                                        <span class="product-course-code">PSYC 101</span>
                                        <span class="product-course-name">Basic Psychology</span>
                                    </td>
                                    <td class="product-school-cell">McGill University</td>
                                    <td class="date-cell">2025-12-01~2026-01-25</td>
                                    <td class="price-cell">1290美元</td>
                                    <td class="code-cell">006</td>
                                    <td class="duration-cell">8周</td>
                                </tr>
                                
                                <!-- ENGL 10A 单门产品课程 -->
                                <tr>
                                    <td class="checkbox-cell"><input type="checkbox" class="course-checkbox" /></td>
                                    <td class="home-course-cell">ENGL 10A</td>
                                    <td><span class="course-category-badge category-elective">专业选修课</span></td>
                                    <td class="status-potential">潜在价值</td>
                                    <td><span class="audit-status-text audit-ai-rejected">AI审核驳回</span></td>
                                    <td class="product-course-cell">
                                        <span class="product-course-code">ENGL 1100</span>
                                        <span class="product-course-name">Academic Writing</span>
                                    </td>
                                    <td class="product-school-cell">University of British Columbia</td>
                                    <td class="date-cell">2025-11-20~2026-01-15</td>
                                    <td class="price-cell">1200美元</td>
                                    <td class="code-cell">007</td>
                                    <td class="duration-cell">8周</td>
                                </tr>
                                
                                <!-- STAT 104 对应的两门产品课程 -->
                                <tr>
                                    <td class="checkbox-cell"><input type="checkbox" class="course-checkbox" /></td>
                                    <td class="home-course-cell merged-cell" rowspan="2">STAT 104</td>
                                    <td class="merged-cell" rowspan="2"><span class="course-category-badge category-free">自由选修课</span></td>
                                    <td class="merged-cell status-serving" rowspan="2">服务中</td>
                                    <td class="merged-cell" rowspan="2"><span class="audit-status-text audit-ai-passed">AI审核通过</span></td>
                                    <td class="product-course-cell">
                                        <span class="product-course-code">STAT 2040</span>
                                        <span class="product-course-name">Statistics for Scientists</span>
                                    </td>
                                    <td class="product-school-cell">University of Toronto</td>
                                    <td class="date-cell">2025-10-15~2025-12-10</td>
                                    <td class="price-cell">1600美元</td>
                                    <td class="code-cell">008</td>
                                    <td class="duration-cell">8周</td>
                                </tr>
                                <tr>
                                    <td class="checkbox-cell"><input type="checkbox" class="course-checkbox" /></td>
                                    <td class="product-course-cell">
                                        <span class="product-course-code">MATH 204</span>
                                        <span class="product-course-name">Probability and Statistics</span>
                                    </td>
                                    <td class="product-school-cell">McGill University</td>
                                    <td class="date-cell">2025-11-01~2025-12-24</td>
                                    <td class="price-cell">1450美元</td>
                                    <td class="code-cell">009</td>
                                    <td class="duration-cell">8周</td>
                                </tr>
                                
                                <!-- CS 50 单门产品课程 -->
                                <tr>
                                    <td class="checkbox-cell"><input type="checkbox" class="course-checkbox" /></td>
                                    <td class="home-course-cell">CS 50</td>
                                    <td><span class="course-category-badge category-elective">专业选修课</span></td>
                                    <td class="status-serving">服务中</td>
                                    <td><span class="audit-status-text audit-ai-passed">AI审核通过</span></td>
                                    <td class="product-course-cell">
                                        <span class="product-course-code">CPSC 110</span>
                                        <span class="product-course-name">Computation, Programs, and Programming</span>
                                    </td>
                                    <td class="product-school-cell">University of British Columbia</td>
                                    <td class="date-cell">2025-12-05~2026-02-28</td>
                                    <td class="price-cell">1800美元</td>
                                    <td class="code-cell">010</td>
                                    <td class="duration-cell">12周</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- 选课报告管理 -->
                <div id="report-management" class="analysis-tab-content">
                    <div class="content-placeholder">
                        <h3>选课报告管理</h3>
                        <p>生成、查看和管理学生的选课分析报告</p>
                    </div>
                </div>
                
                <!-- 课程订阅中心 -->
                <div id="subscription-info" class="analysis-tab-content">
                    <div class="subscription-center-container">
                        <!-- 筛选条件区域 -->
                        <div class="subscription-filter-area">
                            <div class="filter-item">
                                <label for="subscription-type-filter">订阅类型：</label>
                                <select id="subscription-type-filter" class="filter-select">
                                    <option value="">全部</option>
                                    <option value="product">产品课程</option>
                                    <option value="home">本校课程</option>
                                </select>
                            </div>
                            <div class="filter-item">
                                <label for="status-filter">当前状态：</label>
                                <select id="status-filter" class="filter-select">
                                    <option value="">全部</option>
                                    <option value="waiting">等待上架</option>
                                    <option value="matched">已匹配</option>
                                    <option value="notified">已通知</option>
                                    <option value="viewed">已查看</option>
                                    <option value="converted">已转化</option>
                                    <option value="expired">已过期</option>
                                </select>
                            </div>
                            <button class="filter-reset-btn" onclick="resetSubscriptionFilters()">重置筛选</button>
                        </div>
                        
                        <table class="subscription-center-table">
                            <thead>
                                <tr>
                                    <th>订阅类型</th>
                                    <th>订阅课程</th>
                                    <th>订阅条件</th>
                                    <th>当前状态</th>
                                    <th>创建日期</th>
                                    <th>截止日期</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- 等待上架状态 -->
                                <tr>
                                    <td><span class="subscription-type-badge type-product">产品课程</span></td>
                                    <td class="subscription-course-cell">
                                        <span class="course-info-top">CHEM 1000 (Chemical Principles)</span>
                                        <span class="course-info-bottom">University of British Columbia</span>
                                    </td>
                                    <td class="subscription-conditions">
                                        <span class="conditions-summary">2025-Winter, 线下</span>
                                        <div class="conditions-tooltip">学期：2025-Winter | 上课形式：线下 | 时长：12-16周 | 价格：≤2000美元</div>
                                    </td>
                                    <td class="status-waiting">等待上架</td>
                                    <td>2025-08-15</td>
                                    <td class="deadline-cell deadline-urgent">
                                        2025-11-05
                                        <span class="deadline-countdown">(剩7天)</span>
                                    </td>
                                    <td class="action-buttons">
                                        <button class="action-btn btn-edit">编辑条件</button>
                                        <button class="action-btn btn-cancel">取消订阅</button>
                                        <button class="action-btn btn-renew">续期</button>
                                    </td>
                                </tr>
                                <!-- 已匹配状态 -->
                                <tr>
                                    <td><span class="subscription-type-badge type-product">产品课程</span></td>
                                    <td class="subscription-course-cell">
                                        <span class="course-info-top">MATH 2210 (Multivariable Calculus)</span>
                                        <span class="course-info-bottom">University of Toronto</span>
                                    </td>
                                    <td class="subscription-conditions">
                                        <span class="conditions-summary">2025-Fall, 线上直播</span>
                                        <div class="conditions-tooltip">学期：2025-Fall | 上课形式：线上直播 | 时长：≥8周 | 价格：≤1600美元</div>
                                    </td>
                                    <td class="status-matched">已匹配</td>
                                    <td>2025-09-10</td>
                                    <td class="deadline-cell">2025-12-15</td>
                                    <td class="action-buttons">
                                        <button class="action-btn btn-view">查看匹配课程</button>
                                        <button class="action-btn btn-select">跳转选课</button>
                                    </td>
                                </tr>
                                <!-- 已通知状态 -->
                                <tr>
                                    <td><span class="subscription-type-badge type-home">本校课程</span></td>
                                    <td class="subscription-course-cell">
                                        <span class="course-info-top">PSYC 1 (Introduction to Psychology)</span>
                                        <span class="course-info-bottom">Harvard University</span>
                                    </td>
                                    <td class="subscription-conditions">
                                        <span class="conditions-summary">任意学期, 不限形式</span>
                                        <div class="conditions-tooltip">学期：任意学期 | 上课形式：不限 | 时长：不限 | 价格：≤1500美元</div>
                                    </td>
                                    <td class="status-notified">已通知</td>
                                    <td>2025-07-20</td>
                                    <td class="deadline-cell">2025-12-20</td>
                                    <td class="action-buttons">
                                        <button class="action-btn btn-detail">查看通知详情</button>
                                        <button class="action-btn btn-view">查看匹配课程</button>
                                        <button class="action-btn btn-select">跳转选课</button>
                                    </td>
                                </tr>
                                <!-- 已查看状态 -->
                                <tr>
                                    <td><span class="subscription-type-badge type-product">产品课程</span></td>
                                    <td class="subscription-course-cell">
                                        <span class="course-info-top">ENGL 1100 (Academic Writing)</span>
                                        <span class="course-info-bottom">University of British Columbia</span>
                                    </td>
                                    <td class="subscription-conditions">
                                        <span class="conditions-summary">2025-Fall, 任意形式</span>
                                        <div class="conditions-tooltip">学期：2025-Fall | 上课形式：任意 | 时长：≥6周 | 价格：≤1200美元</div>
                                    </td>
                                    <td class="status-viewed">已查看</td>
                                    <td>2025-08-25</td>
                                    <td class="deadline-cell">2025-11-30</td>
                                    <td class="action-buttons">
                                        <button class="action-btn btn-view">查看匹配课程</button>
                                        <button class="action-btn btn-select">跳转选课</button>
                                    </td>
                                </tr>
                                <!-- 已转化状态 -->
                                <tr>
                                    <td><span class="subscription-type-badge type-home">本校课程</span></td>
                                    <td class="subscription-course-cell">
                                        <span class="course-info-top">CS 50 (Introduction to Computer Science)</span>
                                        <span class="course-info-bottom">Harvard University</span>
                                    </td>
                                    <td class="subscription-conditions">
                                        <span class="conditions-summary">2025-Spring, 线上非直播</span>
                                        <div class="conditions-tooltip">学期：2025-Spring | 上课形式：线上非直播 | 时长：8-12周 | 价格：≤1800美元 | 学分：≥3学分</div>
                                    </td>
                                    <td class="status-converted">已转化</td>
                                    <td>2025-06-15</td>
                                    <td class="deadline-cell">2025-10-15</td>
                                    <td class="action-buttons">
                                        <span class="final-status-note">已完成</span>
                                    </td>
                                </tr>
                                <!-- 已过期状态 -->
                                <tr>
                                    <td><span class="subscription-type-badge type-product">产品课程</span></td>
                                    <td class="subscription-course-cell">
                                        <span class="course-info-top">STAT 2040 (Statistics for Scientists)</span>
                                        <span class="course-info-bottom">University of Toronto</span>
                                    </td>
                                    <td class="subscription-conditions">
                                        <span class="conditions-summary">2025-Fall, 线上直播</span>
                                        <div class="conditions-tooltip">学期：2025-Fall | 上课形式：线上直播 | 时长：8周 | 价格：≤1600美元</div>
                                    </td>
                                    <td class="status-expired">已过期</td>
                                    <td>2025-05-15</td>
                                    <td class="deadline-cell">2025-10-28</td>
                                    <td class="action-buttons">
                                        <button class="action-btn btn-renew">续期</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 单门课程订阅方式选择模态框 -->
    <div id="singleCourseModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 650px;">
            <div class="modal-header product-course">
                <h3 id="singleCourseModalTitle">请选择订阅方式</h3>
                <button class="modal-close" onclick="closeSingleCourseModal()">&times;</button>
            </div>
            
            <div class="modal-body">
                <!-- 课程信息显示区 -->
                <div class="course-info-display" id="courseInfoDisplay">
                    <div class="info-row-horizontal">
                        <div class="info-item">
                            <label class="info-label">学生姓名</label>
                            <div class="info-value readonly-field" id="singleStudentName">-</div>
                        </div>
                        <div class="info-item">
                            <label class="info-label">订阅课程</label>
                            <div class="info-value readonly-field" id="singleCourseName">-</div>
                        </div>
                    </div>
                </div>
                
                <!-- 订阅方式选择 -->
                <div class="subscription-options">
                    <div class="option-card selected" data-option="direct">
                        <div class="option-header">
                            <input type="radio" name="subscribeOption" value="direct" id="directSubscription" checked>
                            <label for="directSubscription" class="option-title">直接订阅</label>
                        </div>
                        <p class="option-description">系统将在所有关联课程可售时通知您，无需设置额外条件</p>
                    </div>
                    
                    <div class="option-card" data-option="custom">
                        <div class="option-header">
                            <input type="radio" name="subscribeOption" value="custom" id="customSubscription">
                            <label for="customSubscription" class="option-title">个性化订阅</label>
                        </div>
                        <p class="option-description">您可以根据学期、开课日期、上课形式等设置个性化订阅条件，系统仅在满足订阅条件时通知您</p>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-cancel" onclick="closeSingleCourseModal()">取消</button>
                <button type="button" class="btn btn-save" id="confirmSelectionBtn">确认</button>
            </div>
        </div>
    </div>

    <!-- 订阅条件模态框 -->
    <div id="subscribeModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">课程订阅条件设置</h3>
                <button class="modal-close" onclick="closeSubscribeModal()">&times;</button>
            </div>
            
            <div class="modal-body">
                <!-- 单门课程模式：顶部信息区 -->
                <div class="info-header" id="singleCourseInfo">
                    <div class="info-item">
                        <label class="info-label">学生姓名</label>
                        <div class="info-value" id="studentNameField">-</div>
                    </div>
                    <div class="info-item">
                        <label class="info-label">订阅课程</label>
                        <div class="info-value" id="selectedCoursesField">-</div>
                    </div>
                </div>
                
                <!-- 批量课程模式：信息区和统一设置区 -->
                <div class="batch-unified-section" id="batchUnifiedSection" style="display: none;">
                    <!-- 批量模式的顶部信息区 -->
                    <div class="batch-info-header">
                        <div class="info-item">
                            <label class="info-label">学生姓名</label>
                            <div class="info-value" id="batchStudentNameField">-</div>
                        </div>
                        <div class="info-item course-list-item">
                            <label class="info-label" id="batchCoursesTitle">订阅课程</label>
                            <div class="info-value course-list-container">
                                <div class="course-list-scroll" id="batchSelectedCoursesField">
                                    <!-- 课程列表将通过JavaScript动态生成 -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <form id="subscribeForm">
                    <!-- 订阅条件设置 -->
                    <div class="form-section">
                        <h3 class="section-title" id="formSectionTitle">订阅条件设置</h3>
                        <p class="section-description" id="formSectionDescription" style="display: none;">为所有选中的课程设置统一的订阅条件，您也可以滑到底部，为单门课程进行个性化调整</p>
                        
                        <div class="form-grid">
                            <!-- 学年季度 -->
                            <div class="form-field">
                                <div class="field-left">
                                    <div class="field-header">
                                        <div class="field-title-group">
                                            <label class="field-label">学年季度</label>
                                            <span class="field-hint">选择您期望上课的学期</span>
                                        </div>
                                        <div class="switch-wrapper">
                                            <span class="switch-label">必须满足</span>
                                            <label class="switch">
                                                <input type="checkbox" name="semesterRequired">
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="field-control">
                                        <select name="semester" class="form-select">
                                            <option value="">请选择学期</option>
                                            <option value="2025-2026-Fall">2025-2026 Fall</option>
                                            <option value="2025-2026-Winter">2025-2026 Winter</option>
                                            <option value="2025-2026-Summer">2025-2026 Summer</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 开课日期 -->
                            <div class="form-field">
                                <div class="field-left">
                                    <div class="field-header">
                                        <div class="field-title-group">
                                            <label class="field-label">开课日期</label>
                                            <span class="field-hint">课程开始日期的可接受范围</span>
                                        </div>
                                        <div class="switch-wrapper">
                                            <span class="switch-label">必须满足</span>
                                            <label class="switch">
                                                <input type="checkbox" name="dateRequired">
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="field-control">
                                        <div class="date-range-wrapper">
                                            <input type="date" id="startDate" name="startDate" class="form-input date-input">
                                            <span class="date-separator">至</span>
                                            <input type="date" id="endDate" name="endDate" class="form-input date-input">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 上课形式 -->
                            <div class="form-field">
                                <div class="field-left">
                                    <div class="field-header">
                                        <div class="field-title-group">
                                            <label class="field-label">上课形式</label>
                                            <span class="field-hint">选择您偏好的上课形式</span>
                                        </div>
                                        <div class="switch-wrapper">
                                            <span class="switch-label">必须满足</span>
                                            <label class="switch">
                                                <input type="checkbox" name="formatRequired">
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="field-control">
                                        <select name="format" class="form-select">
                                            <option value="">请选择上课形式</option>
                                            <option value="online-live">线上直播</option>
                                            <option value="online-recorded">线上非直播</option>
                                            <option value="offline">线下</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 课程时长 -->
                            <div class="form-field">
                                <div class="field-left">
                                    <div class="field-header">
                                        <div class="field-title-group">
                                            <label class="field-label">课程时长</label>
                                            <span class="field-hint">课程时长的可接受条件</span>
                                        </div>
                                        <div class="switch-wrapper">
                                            <span class="switch-label">必须满足</span>
                                            <label class="switch">
                                                <input type="checkbox" name="durationRequired">
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="field-control">
                                        <div class="combo-input">
                                            <select name="durationOperator" class="combo-select">
                                                <option value="equal">等于</option>
                                                <option value="gte">大于等于</option>
                                                <option value="lte">小于等于</option>
                                            </select>
                                            <input type="number" id="duration" name="duration" min="1" max="52" class="form-input combo-number">
                                            <span class="combo-unit">周</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 学分数量 -->
                            <div class="form-field">
                                <div class="field-left">
                                    <div class="field-header">
                                        <div class="field-title-group">
                                            <label class="field-label">学分数量</label>
                                            <span class="field-hint">课程的学分值要求</span>
                                        </div>
                                        <div class="switch-wrapper">
                                            <span class="switch-label">必须满足</span>
                                            <label class="switch">
                                                <input type="checkbox" name="creditsRequired">
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="field-control">
                                        <div class="combo-input">
                                            <select name="creditsOperator" class="combo-select">
                                                <option value="equal">等于</option>
                                                <option value="gte">大于等于</option>
                                                <option value="lte">小于等于</option>
                                            </select>
                                            <input type="number" id="credits" name="credits" min="1" max="10" class="form-input combo-number">
                                            <span class="combo-unit">学分</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 课程价格 -->
                            <div class="form-field">
                                <div class="field-left">
                                    <div class="field-header">
                                        <div class="field-title-group">
                                            <label class="field-label">课程价格</label>
                                            <span class="field-hint">可接受的最高课程价格</span>
                                        </div>
                                        <div class="switch-wrapper">
                                            <span class="switch-label">必须满足</span>
                                            <label class="switch">
                                                <input type="checkbox" name="priceRequired">
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="field-control">
                                        <div class="combo-input">
                                            <select name="priceOperator" class="combo-select">
                                                <option value="lte">小于等于</option>
                                            </select>
                                            <input type="number" id="price" name="price" min="0" step="10" class="form-input combo-number">
                                            <span class="combo-unit">美元</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
                
                <!-- 批量课程模式：课程列表区 -->
                <div class="batch-course-list" id="batchCourseList" style="display: none;">
                    <div class="course-list-card">
                        <h4 class="list-title">课程列表与单独调整</h4>
                        <div class="course-items" id="courseItems">
                            <!-- 课程项目将通过JavaScript动态生成 -->
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-cancel" onclick="closeSubscribeModal()">取消</button>
                <button type="button" class="btn btn-save" onclick="submitSubscribe()">确认订阅</button>
            </div>
        </div>
    </div>    <script>

        
        // 顶部导航标签切换
        document.querySelectorAll('.nav-tab').forEach((tab, index) => {
            tab.addEventListener('click', function() {
                // 移除所有活跃状态
                document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                // 添加当前标签的活跃状态
                this.classList.add('active');
                
                // 隐藏所有内容
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.style.display = 'none';
                });
                
                // 显示对应内容
                if (index === 0) { // 大学中心
                    document.getElementById('university-center').style.display = 'block';
                } else if (index === 1) { // 产品中心
                    document.getElementById('product-center').style.display = 'block';
                } else if (index === 2) { // 学生中心
                    document.getElementById('student-center').style.display = 'block';
                }
            });
        });
        
        // 默认显示学生中心
        document.getElementById('student-center').style.display = 'block';
        
        // 初始化批量订阅按钮状态
        updateBatchSubscribeButton();
        
        // 点击页面其他地方时隐藏下拉菜单
        document.addEventListener('click', function(e) {
            const dropdown = document.getElementById('batchSubscribeDropdown');
            if (!dropdown.contains(e.target)) {
                // 可以添加额外的隐藏逻辑，但CSS悬浮效果会自动处理
            }
        });
        
        // 单门课程订阅选项卡点击效果
        document.addEventListener('DOMContentLoaded', function() {
            // 选项卡点击事件
            document.querySelectorAll('.option-card').forEach(card => {
                card.addEventListener('click', function() {
                    // 移除所有选中状态
                    document.querySelectorAll('.option-card').forEach(c => c.classList.remove('selected'));
                    // 添加当前选中状态
                    this.classList.add('selected');
                    // 选中对应的单选按钮
                    const radio = this.querySelector('input[type="radio"]');
                    if (radio) radio.checked = true;
                });
            });
            
            // 单选按钮变化事件
            document.querySelectorAll('input[name="subscriptionType"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    // 移除所有选中状态
                    document.querySelectorAll('.option-card').forEach(c => c.classList.remove('selected'));
                    // 添加当前选中状态
                    const card = this.closest('.option-card');
                    if (card) card.classList.add('selected');
                });
            });
        });
        
        // 学生中心左侧边栏功能项点击
        document.querySelectorAll('.student-sidebar .sidebar-title').forEach(item => {
            item.addEventListener('click', function() {
                // 移除所有选中状态
                document.querySelectorAll('.student-sidebar .sidebar-title').forEach(i => i.classList.remove('active'));
                // 添加当前项的选中状态
                this.classList.add('active');
                
                // 隐藏所有子内容
                document.querySelectorAll('.sub-content').forEach(content => {
                    content.style.display = 'none';
                });
                
                // 显示对应子内容
                const target = this.getAttribute('data-target');
                document.getElementById(target).style.display = 'block';
            });
        });
        
        // 监听课程选择变化
        function updateBatchSubscribeButton() {
            const selectedCount = document.querySelectorAll('.course-checkbox:checked').length;
            const batchBtn = document.getElementById('batchSubscribeBtn');
            const dropdownMenu = document.getElementById('dropdownMenu');
            
            if (selectedCount >= 2) {
                batchBtn.disabled = false;
                batchBtn.querySelector('.btn-text').textContent = `批量订阅 (${selectedCount}门课程)`;
                dropdownMenu.classList.remove('disabled');
            } else {
                batchBtn.disabled = true;
                batchBtn.querySelector('.btn-text').textContent = '批量订阅';
                dropdownMenu.classList.add('disabled');
            }
        }
        
        // 为所有课程复选框添加事件监听器
        document.querySelectorAll('.course-checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', updateBatchSubscribeButton);
        });
        
        // 批量订阅按钮点击事件（现在只是阻止默认行为，实际功能由下拉菜单处理）
        document.getElementById('batchSubscribeBtn').addEventListener('click', function(e) {
            if (this.disabled) {
                e.preventDefault();
                return;
            }
            // 点击主按钮时不执行任何操作，用户需要悬浮选择子选项
            e.preventDefault();
        });
        
        // 下拉菜单项点击事件
        document.querySelectorAll('.dropdown-item').forEach(item => {
            item.addEventListener('click', function(e) {
                e.stopPropagation();
                
                const selectedCount = document.querySelectorAll('.course-checkbox:checked').length;
                if (selectedCount < 2) {
                    alert('请至少选择2门课程进行批量订阅');
                    return;
                }
                
                const type = this.getAttribute('data-type');
                const courseType = type === 'home' ? '本校课程' : '产品课程';
                
                // 打开批量订阅选择方式模态框
                openBatchSelectionModal(type, courseType);
            });
        });
        
        // 打开批量订阅选择方式模态框
        function openBatchSelectionModal(type, courseType) {
            const selectedCourses = getSelectedCourses();
            if (selectedCourses.length < 2) {
                alert('请至少选择2门课程进行批量订阅');
                return;
            }
            
            // 设置模态框标题
            document.getElementById('singleCourseModalTitle').textContent = `请选择${courseType}订阅方式`;
            
            // 确保模态框头部始终有绿色背景
            const modalHeader = document.querySelector('#singleCourseModal .modal-header');
            modalHeader.classList.add('product-course');
            
            // 获取选中学生的姓名（假设所有选中课程都是同一个学生的）
            const studentName = selectedCourses.length > 0 ? selectedCourses[0].student : '未知学生';
            
            // 设置课程信息显示
            const courseInfoDisplay = document.getElementById('courseInfoDisplay');
            
            // 构建课程列表HTML
            let courseListHTML = '';
            selectedCourses.forEach(course => {
                // 从课程信息中提取课程代码和名称
                const fullText = course.course;
                const courseCodeMatch = fullText.match(/^([A-Z]{2,}\s+[\d\.]+)/);
                const courseCode = courseCodeMatch ? courseCodeMatch[1] : '';
                
                // 提取课程名称（括号中的内容）
                const courseNameMatch = fullText.match(/\(([^)]+)\)/);
                const courseName = courseNameMatch ? courseNameMatch[1] : fullText;
                
                courseListHTML += `<div class="course-item-row">${courseCode} - ${courseName}</div>`;
            });
            
            courseInfoDisplay.innerHTML = `
                <div class="info-row-horizontal">
                    <div class="info-item">
                        <span class="info-label">学生姓名：</span>
                        <span class="info-value readonly-field">${studentName}</span>
                    </div>
                    <div class="info-item course-list-item">
                        <span class="info-label">订阅课程：</span>
                        <div class="info-value course-list-container">
                            <div class="course-count-title">已选课程 (${selectedCourses.length}门)</div>
                            <div class="course-list-scroll readonly-field">
                                ${courseListHTML}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // 更新确认按钮事件
            const confirmBtn = document.getElementById('confirmSelectionBtn');
            confirmBtn.onclick = function() {
                const selectedOption = document.querySelector('input[name="subscribeOption"]:checked');
                if (!selectedOption) {
                    alert('请选择订阅方式');
                    return;
                }
                
                // 关闭选择模态框
                document.getElementById('singleCourseModal').style.display = 'none';
                
                // 根据选择的方式处理
                if (selectedOption.value === 'direct') {
                    // 直接订阅 - 直接执行批量订阅
                    executeBatchSubscribe(type, courseType);
                } else {
                    // 个性化订阅 - 打开设置条件模态框
                    openBatchSubscribeModal(courseType + '订阅');
                }
            };
            
            // 重置单选框状态
            document.querySelectorAll('input[name="subscribeOption"]').forEach(radio => {
                radio.checked = false;
            });
            // 默认选中第一个选项
            document.getElementById('directSubscription').checked = true;
            
            // 显示选择模态框
            document.getElementById('singleCourseModal').style.display = 'flex';
        }
        
        // 打开批量订阅模态框
        function openBatchSubscribeModal(type) {
            const selectedCourses = getSelectedCourses();
            if (selectedCourses.length < 2) {
                alert('请至少选择2门课程进行批量订阅');
                return;
            }
            
            // 设置模态框标题
            document.getElementById('modalTitle').textContent = type + '批量设置';
            
            // 设置模态框头部样式（本校课程和产品课程都使用绿色样式）
            const modalHeader = document.querySelector('#subscribeModal .modal-header');
            modalHeader.classList.add('product-course');
            
            // 填充批量数据
            fillBatchModalData(selectedCourses, type);
            
            // 只显示批量模式
            showBatchCourseMode();
            
            // 显示模态框
            document.getElementById('subscribeModal').style.display = 'flex';
        }
        
        // 执行直接批量订阅
        function executeBatchSubscribe(type, courseType) {
            const selectedCourses = getSelectedCourses();
            
            // 显示成功消息
            alert(`成功为 ${selectedCourses.length} 门课程订阅了${courseType}！`);
            
            // 取消所有选中状态
            document.querySelectorAll('.course-checkbox:checked').forEach(checkbox => {
                checkbox.checked = false;
            });
            
            // 更新批量订阅按钮状态
            updateBatchSubscribeButton();
            
            console.log(`批量订阅执行完成 - 类型: ${courseType}, 课程数量: ${selectedCourses.length}`);
        }
        
        // 打开订阅模态框（现在只用于单门课程）
        function openSubscribeModal(type) {
            const selectedCourses = getSelectedCourses();
            if (selectedCourses.length === 0) {
                alert('请先选择要订阅的课程');
                return;
            }
            
            // 只处理单门课程订阅
            document.getElementById('modalTitle').textContent = type + '条件设置';
            
            // 设置模态框头部样式（本校课程和产品课程都使用绿色样式）
            const modalHeader = document.querySelector('#subscribeModal .modal-header');
            modalHeader.classList.add('product-course');
            
            fillModalData(selectedCourses, type);
            showSingleCourseMode();
            document.getElementById('subscribeModal').style.display = 'flex';
        }
        
        // 显示单门课程模式
        function showSingleCourseMode() {
            document.getElementById('singleCourseInfo').style.display = 'grid';
            document.getElementById('batchUnifiedSection').style.display = 'none';
            document.getElementById('batchCourseList').style.display = 'none';
            
            // 恢复单门课程的标题和隐藏说明
            document.getElementById('formSectionTitle').textContent = '订阅条件设置';
            document.getElementById('formSectionDescription').style.display = 'none';
        }
        
        // 显示批量课程模式
        function showBatchCourseMode() {
            document.getElementById('singleCourseInfo').style.display = 'none';
            document.getElementById('batchUnifiedSection').style.display = 'block';
            document.getElementById('batchCourseList').style.display = 'block';
            
            // 更新表单标题和说明
            document.getElementById('formSectionTitle').textContent = '统一订阅条件设置';
            document.getElementById('formSectionDescription').style.display = 'block';
        }
        
        // 关闭订阅模态框
        function closeSubscribeModal() {
            document.getElementById('subscribeModal').style.display = 'none';
            // 清理批量模式的动态内容
            document.getElementById('courseItems').innerHTML = '';
            // 清除模态框头部的产品课程样式
            document.querySelector('#subscribeModal .modal-header').classList.remove('product-course');
            // 清理单门课程订阅的状态
            window.currentSubscribeButton = null;
        }
        
        // 获取选中的课程
        function getSelectedCourses() {
            const selectedCourses = [];
            const checkboxes = document.querySelectorAll('.course-checkbox:checked');
            
            checkboxes.forEach(checkbox => {
                const row = checkbox.closest('tr');
                
                // 获取学生姓名（处理合并单元格）
                let studentName = '';
                const studentNameCell = row.querySelector('.student-name');
                if (studentNameCell) {
                    studentName = studentNameCell.textContent.trim();
                } else {
                    // 查找前面行的学生姓名
                    const allRows = Array.from(row.parentElement.children);
                    const currentRowIndex = allRows.indexOf(row);
                    for (let i = currentRowIndex - 1; i >= 0; i--) {
                        const prevRow = allRows[i];
                        const prevStudentNameCell = prevRow.querySelector('.student-name');
                        if (prevStudentNameCell) {
                            studentName = prevStudentNameCell.textContent.trim();
                            break;
                        }
                    }
                }
                
                const courseCell = row.cells[4]; // 已选课程列
                const fullCourseText = courseCell.textContent.trim();
                const buttonElement = courseCell.querySelector('.course-subscribe-btn');
                
                selectedCourses.push({
                    student: studentName,
                    course: fullCourseText,
                    buttonElement: buttonElement
                });
            });
            
            return selectedCourses;
        }
        
        // 填充模态框数据（单门课程）
        function fillModalData(selectedCourses, type) {
            // 填充学生姓名（取第一个学生）
            document.getElementById('studentNameField').textContent = selectedCourses[0].student;
            
            // 填充选中的课程
            const courseList = selectedCourses.map(item => `${item.course}`).join(', ');
            document.getElementById('selectedCoursesField').textContent = courseList;
        }
        
        // 填充批量模态框数据
        function fillBatchModalData(selectedCourses, type) {
            // 填充批量模式的学生姓名和课程信息
            document.getElementById('batchStudentNameField').textContent = selectedCourses[0].student;
            
            // 填充选中的课程（垂直列表显示）
            const courseCount = selectedCourses.length;
            const courseNames = [...new Set(selectedCourses.map(item => item.course))];
            
            // 生成垂直课程列表HTML
            let courseListHTML = `
                <div class="course-count-title">已选课程 (${courseNames.length}门)</div>
                <div class="course-list-scroll">
            `;
            
            courseNames.forEach(courseName => {
                courseListHTML += `<div class="course-item-row">${courseName}</div>`;
            });
            
            courseListHTML += `</div>`;
            document.getElementById('batchSelectedCoursesField').innerHTML = courseListHTML;
            
            // 生成课程列表
            const courseItemsContainer = document.getElementById('courseItems');
            courseItemsContainer.innerHTML = '';
            
            selectedCourses.forEach((course, index) => {
                const courseItem = createCourseItem(course, index);
                courseItemsContainer.appendChild(courseItem);
            });
        }
        
        // 创建课程项目元素
        function createCourseItem(course, index) {
            const courseItem = document.createElement('div');
            courseItem.className = 'course-item';
            courseItem.setAttribute('data-course-index', index);
            
            courseItem.innerHTML = `
                <div class="course-header">
                    <div class="course-name">${course.course}</div>
                    <div class="course-status">
                        <span class="status-label" id="status-${index}">默认使用统一设置</span>
                        <button class="toggle-btn" id="toggle-${index}" onclick="toggleIndividualSetting(${index})">
                            单独设置
                        </button>
                    </div>
                </div>
                <div class="individual-form" id="form-${index}">
                    <!-- 独立设置表单将通过JavaScript克隆生成 -->
                </div>
            `;
            
            return courseItem;
        }
        
        // 切换独立设置
        function toggleIndividualSetting(courseIndex) {
            const statusLabel = document.getElementById(`status-${courseIndex}`);
            const toggleBtn = document.getElementById(`toggle-${courseIndex}`);
            const individualForm = document.getElementById(`form-${courseIndex}`);
            
            if (individualForm.classList.contains('show')) {
                // 收起独立设置
                individualForm.classList.remove('show');
                statusLabel.textContent = '默认使用统一设置';
                statusLabel.classList.remove('active');
                toggleBtn.textContent = '单独设置';
                toggleBtn.classList.remove('secondary');
                
                // 清空独立表单
                individualForm.innerHTML = '';
            } else {
                // 展开独立设置
                const clonedForm = cloneUnifiedForm();
                fillClonedFormWithUnifiedData(clonedForm);
                individualForm.appendChild(clonedForm);
                
                individualForm.classList.add('show');
                statusLabel.textContent = '使用单独设置';
                statusLabel.classList.add('active');
                toggleBtn.textContent = '收起并使用统一设置';
                toggleBtn.classList.add('secondary');
            }
        }
        
        // 克隆统一设置表单
        function cloneUnifiedForm() {
            const originalForm = document.querySelector('#subscribeForm .form-section');
            const clonedForm = originalForm.cloneNode(true);
            
            // 修改克隆表单的标题
            const title = clonedForm.querySelector('.section-title');
            title.textContent = '单独设置';
            
            // 修改说明文字
            const description = clonedForm.querySelector('.section-description');
            if (description) {
                description.textContent = '您正在为本课程进行个性化设置。此处的条件将优先于统一设置，并仅应用于该门课程。';
                description.style.display = 'block';
            }
            
            // 为克隆表单的控件添加唯一标识符
            const inputs = clonedForm.querySelectorAll('input, select');
            inputs.forEach((input, index) => {
                if (input.name) {
                    input.name = input.name + '_individual';
                }
                if (input.id) {
                    input.id = input.id + '_individual';
                }
            });
            
            return clonedForm;
        }
        
        // 填充克隆表单的数据
        function fillClonedFormWithUnifiedData(clonedForm) {
            const unifiedForm = document.querySelector('#subscribeForm');
            
            // 复制统一设置的表单数据到克隆表单
            const unifiedInputs = unifiedForm.querySelectorAll('input, select');
            const clonedInputs = clonedForm.querySelectorAll('input, select');
            
            unifiedInputs.forEach((unifiedInput, index) => {
                const clonedInput = clonedInputs[index];
                if (clonedInput) {
                    if (unifiedInput.type === 'checkbox') {
                        clonedInput.checked = unifiedInput.checked;
                    } else {
                        clonedInput.value = unifiedInput.value;
                    }
                }
            });
        }
        
        // 提交订阅
        function submitSubscribe() {
            // 检查是否是单门课程订阅模式
            if (window.currentSubscribeButton) {
                console.log('检测到单门课程订阅模式');
                // 单门课程提交
                submitSingleCourse();
            } else {
                console.log('检测到批量课程订阅模式');
                // 批量课程提交
                const selectedCourses = getSelectedCourses();
                console.log('选中的课程数量:', selectedCourses.length);
                submitBatchCourses(selectedCourses);
            }
        }
        
        // 提交单门课程
        function submitSingleCourse() {
            // 更新按钮状态为已订阅
            if (window.currentSubscribeButton) {
                window.currentSubscribeButton.classList.add('subscribed');
                window.currentSubscribeButton.textContent = '已订阅';
                window.currentSubscribeButton.title = window.currentSubscribeButton.title.replace('订阅', '取消订阅');
                console.log('单门课程订阅成功，按钮状态已更新');
            } else {
                console.error('错误：未找到currentSubscribeButton');
            }
            
            alert('订阅成功！系统将根据设置的条件监控课程状态。');
            closeSubscribeModal();
        }
        
        // 提交批量课程
        function submitBatchCourses(selectedCourses) {
            const coursesData = [];
            
            selectedCourses.forEach((course, index) => {
                const individualForm = document.getElementById(`form-${index}`);
                const useIndividual = individualForm.classList.contains('show');
                
                let formData;
                if (useIndividual) {
                    // 收集单独设置的数据
                    formData = collectFormData(individualForm);
                } else {
                    // 收集统一设置的数据
                    formData = collectFormData(document.querySelector('#subscribeForm'));
                }
                
                coursesData.push({
                    courseIndex: index,
                    courseName: course.course,
                    student: course.student,
                    settings: formData,
                    useIndividual: useIndividual
                });
            });
            
            // 更新所有选中课程的按钮状态
            selectedCourses.forEach(course => {
                if (course.buttonElement) {
                    course.buttonElement.classList.add('subscribed');
                    course.buttonElement.textContent = '已订阅';
                    course.buttonElement.title = course.buttonElement.title.replace('订阅', '取消订阅');
                }
            });
            
            console.log('批量订阅数据:', coursesData);
            alert(`成功订阅 ${selectedCourses.length} 门课程！系统将根据设置的条件监控课程状态。`);
            closeSubscribeModal();
        }
        
        // 收集表单数据
        function collectFormData(formContainer) {
            const data = {};
            const inputs = formContainer.querySelectorAll('input, select');
            
            inputs.forEach(input => {
                if (input.type === 'checkbox') {
                    data[input.name] = input.checked;
                } else {
                    data[input.name] = input.value;
                }
            });
            
            return data;
        }
        
        // 点击模态框外部关闭
        document.getElementById('subscribeModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeSubscribeModal();
            }
        });
        
        // 学生跟进相关功能函数
        function toggleAllStudents(checkbox) {
            const checkboxes = document.querySelectorAll('.student-checkbox');
            checkboxes.forEach(cb => cb.checked = checkbox.checked);
        }
        
        function addStudent() {
            alert('新增学生功能开发中...');
        }
        
        function exportStudents() {
            alert('导出数据功能开发中...');
        }
        
        function refreshStudents() {
            alert('数据已刷新');
        }
        
        function searchStudents() {
            const searchValue = document.getElementById('studentSearch').value.toLowerCase();
            const rows = document.querySelectorAll('.student-row');
            
            rows.forEach(row => {
                const studentName = row.querySelector('.student-name').textContent.toLowerCase();
                const schoolName = row.querySelector('.school-name').textContent.toLowerCase();
                const wechatName = row.querySelector('.wechat-name').textContent.toLowerCase();
                
                if (studentName.includes(searchValue) || 
                    schoolName.includes(searchValue) || 
                    wechatName.includes(searchValue)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        
        function editStudent(studentId) {
            alert(`编辑学生 ID: ${studentId} 功能开发中...`);
        }
        
        function addFollowRecord(studentId) {
            alert(`添加跟进记录 - 学生 ID: ${studentId} 功能开发中...`);
        }
        
        function deleteStudent(studentId) {
            if (confirm('确定要删除该学生信息吗？')) {
                alert(`删除学生 ID: ${studentId} 功能开发中...`);
            }
        }
        
        function viewReport(studentId) {
            // 获取学生信息
            const studentRow = document.querySelector(`input[value="${studentId}"]`).closest('.student-row');
            const studentName = studentRow.querySelector('.student-name').textContent;
            const studentSchool = studentRow.querySelector('.school-name').textContent;
            
            // 存储当前学生信息到全局变量
            window.currentStudentInfo = {
                id: studentId,
                name: studentName,
                school: studentSchool
            };
            
            // 更新分析页面标题
            document.getElementById('student-analysis-title').textContent = `${studentName} - 学生选课分析`;
            
            // 立即更新学生档案数据
            updateStudentProfileData();
            
            // 隐藏主页面，显示分析页面
            document.querySelector('.main-layout').style.display = 'none';
            document.getElementById('student-analysis-page').style.display = 'block';
        }
        
        // 查看订阅信息功能
        function viewSubscriptionInfo(studentName) {
            // 获取学生行信息
            const studentRows = document.querySelectorAll('.student-row');
            let studentInfo = null;
            
            for (let row of studentRows) {
                if (row.querySelector('.student-name').textContent === studentName) {
                    studentInfo = {
                        name: studentName,
                        school: row.querySelector('.school-name').textContent,
                        id: row.querySelector('.student-checkbox').value
                    };
                    break;
                }
            }
            
            if (studentInfo) {
                // 存储当前学生信息到全局变量
                window.currentStudentInfo = studentInfo;
                
                // 更新分析页面标题
                document.getElementById('student-analysis-title').textContent = `${studentName} - 学生选课分析`;
                
                // 隐藏主页面，显示分析页面
                document.querySelector('.main-layout').style.display = 'none';
                document.getElementById('student-analysis-page').style.display = 'block';
                
                // 直接切换到课程订阅中心tab
                const subscriptionTab = document.querySelector('[data-target="subscription-info"]');
                if (subscriptionTab) {
                    // 移除所有tab的active状态
                    document.querySelectorAll('.analysis-tab-btn').forEach(tab => {
                        tab.classList.remove('active');
                    });
                    
                    // 隐藏所有tab内容
                    document.querySelectorAll('.analysis-tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // 激活订阅中心tab
                    subscriptionTab.classList.add('active');
                    document.getElementById('subscription-info').classList.add('active');
                }
            }
        }
        
        // 搜索框回车事件
        document.getElementById('studentSearch').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchStudents();
            }
        });
        
        // 返回学生跟进页面
        function backToStudentFollow() {
            document.getElementById('student-analysis-page').style.display = 'none';
            document.querySelector('.main-layout').style.display = 'block';
        }
        
        // 单独订阅课程功能
        function subscribeSingleCourse(buttonElement, courseType) {
            // 阻止事件冒泡，防止触发其他点击事件
            event.stopPropagation();
            
            // 检查当前订阅状态
            const isSubscribed = buttonElement.classList.contains('subscribed');
            
            if (isSubscribed) {
                // 如果已订阅，仅作展示，不执行任何操作
                return;
            }
            
            // 获取课程信息
            const courseCell = buttonElement.closest('.course-cell');
            const courseName = courseCell.querySelector('.course-link').textContent.trim();
            
            // 获取学生信息
            const row = courseCell.closest('tr');
            let studentName = '';
            
            // 查找学生姓名 - 可能在当前行或者在前面的行（合并单元格情况）
            const studentNameCell = row.querySelector('.student-name');
            if (studentNameCell) {
                studentName = studentNameCell.textContent.trim();
            } else {
                // 如果当前行没有学生姓名，查找前面的行（处理rowspan情况）
                const allRows = Array.from(row.parentElement.children);
                const currentRowIndex = allRows.indexOf(row);
                
                for (let i = currentRowIndex - 1; i >= 0; i--) {
                    const prevRow = allRows[i];
                    const prevStudentNameCell = prevRow.querySelector('.student-name');
                    if (prevStudentNameCell) {
                        studentName = prevStudentNameCell.textContent.trim();
                        break;
                    }
                }
            }
            
            // 创建单门课程的选中数据
            const selectedCourse = [{
                student: studentName,
                course: courseName,
                type: courseType
            }];
            
            // 确定模态框标题
            let modalTitle = '';
            if (courseType === 'home') {
                modalTitle = '本校课程订阅';
            } else if (courseType === 'product') {
                modalTitle = '产品课程订阅';
            }
            
            // 打开单门课程订阅方式选择模态框
            openSingleCourseSelectionModal(selectedCourse, modalTitle, buttonElement);
        }
        
        // 打开单门课程订阅方式选择模态框
        function openSingleCourseSelectionModal(selectedCourse, modalTitle, buttonElement) {
            // 存储当前订阅信息，供后续使用
            window.currentSingleCourseData = {
                selectedCourse: selectedCourse,
                modalTitle: modalTitle,
                buttonElement: buttonElement
            };
            
            // 设置模态框标题
            const courseType = window.currentSingleCourseData.selectedCourse[0].type;
            let courseTypeText = '';
            if (courseType === 'home') {
                courseTypeText = '本校课程';
            } else if (courseType === 'product') {
                courseTypeText = '产品课程';
            }
            document.getElementById('singleCourseModalTitle').textContent = `请选择${courseTypeText}订阅方式`;
            
            // 确保模态框头部始终有绿色背景
            const modalHeader = document.querySelector('#singleCourseModal .modal-header');
            modalHeader.classList.add('product-course');
            
            // 设置课程信息显示（使用原有的学生课程信息格式）
            const courseInfoDisplay = document.getElementById('courseInfoDisplay');
            courseInfoDisplay.innerHTML = `
                <div class="info-row-horizontal">
                    <div class="info-item">
                        <label class="info-label">学生姓名</label>
                        <div class="info-value readonly-field">${selectedCourse[0].student}</div>
                    </div>
                    <div class="info-item">
                        <label class="info-label">订阅课程</label>
                        <div class="info-value readonly-field">${selectedCourse[0].course}</div>
                    </div>
                </div>
            `;
            
            // 更新确认按钮事件
            const confirmBtn = document.getElementById('confirmSelectionBtn');
            confirmBtn.onclick = function() {
                const selectedOption = document.querySelector('input[name="subscribeOption"]:checked');
                if (!selectedOption) {
                    alert('请选择订阅方式');
                    return;
                }
                
                const data = window.currentSingleCourseData;
                if (!data) return;
                
                if (selectedOption.value === 'direct') {
                    // 直接订阅
                    data.buttonElement.classList.add('subscribed');
                    data.buttonElement.textContent = '已订阅';
                    data.buttonElement.title = data.buttonElement.title.replace('订阅', '取消订阅');
                    alert('订阅成功！');
                    closeSingleCourseModal();
                } else {
                    // 个性化订阅，打开条件设置页面
                    closeSingleCourseModal();
                    openSingleCourseSubscribeModal(data.selectedCourse, data.modalTitle, data.buttonElement);
                }
            };
            
            // 重置单选框状态
            document.querySelectorAll('input[name="subscribeOption"]').forEach(radio => {
                radio.checked = false;
            });
            // 默认选中第一个选项
            document.getElementById('directSubscription').checked = true;
            
            // 显示模态框
            document.getElementById('singleCourseModal').style.display = 'flex';
        }
        
        // 关闭单门课程订阅方式选择模态框
        function closeSingleCourseModal() {
            document.getElementById('singleCourseModal').style.display = 'none';
            window.currentSingleCourseData = null;
        }
        

        
        // 为单门课程打开订阅模态框
        function openSingleCourseSubscribeModal(selectedCourses, modalTitle, buttonElement) {
            // 设置模态框标题
            document.getElementById('modalTitle').textContent = modalTitle + '条件设置';
            
            // 设置模态框头部样式（本校课程和产品课程都使用绿色样式）
            const modalHeader = document.querySelector('#subscribeModal .modal-header');
            modalHeader.classList.add('product-course');
            
            // 填充单门课程数据
            fillModalData(selectedCourses, modalTitle);
            
            // 显示单门课程模式
            showSingleCourseMode();
            
            // 存储按钮元素用于后续更新状态
            window.currentSubscribeButton = buttonElement;
            
            // 显示模态框
            document.getElementById('subscribeModal').style.display = 'flex';
        }
        
        // 学生选课分析页面Tab切换功能
        document.addEventListener('DOMContentLoaded', function() {
            // 绑定分析页面Tab切换事件
            const analysisTabBtns = document.querySelectorAll('.analysis-tab-btn');
            analysisTabBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    // 移除所有active状态
                    analysisTabBtns.forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.analysis-tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // 添加当前选中的active状态
                    this.classList.add('active');
                    const target = this.getAttribute('data-target');
                    document.getElementById(target).classList.add('active');
                    
                    // 如果切换到学生档案页面，更新学生信息
                    if (target === 'student-profile') {
                        updateStudentProfileData();
                    }
                });
            });
            
            // 初始化文件上传功能
            initFileUpload();
            
            // 初始化学生档案表单
            initStudentProfileForm();
            
            // 页面加载时检查是否需要更新学生档案数据
            updateStudentProfileData();
        });
        
        // 更新学生档案数据
        function updateStudentProfileData() {
            let studentData = null;
            
            // 优先使用存储的当前学生信息
            if (window.currentStudentInfo) {
                studentData = getStudentDataByName(window.currentStudentInfo.name);
                if (document.getElementById('studentName')) {
                    document.getElementById('studentName').value = window.currentStudentInfo.name;
                    document.getElementById('studentSchool').value = window.currentStudentInfo.school;
                }
            } else {
                // 备用方案：从分析页面标题中获取学生信息
                const titleElement = document.getElementById('student-analysis-title');
                if (titleElement) {
                    const currentStudentName = titleElement.textContent.split(' - ')[0];
                    studentData = getStudentDataByName(currentStudentName);
                    
                    if (studentData && document.getElementById('studentName')) {
                        document.getElementById('studentName').value = studentData.name;
                        document.getElementById('studentSchool').value = studentData.school;
                    }
                }
            }
            
            // 更新个性化档案选项
            if (studentData) {
                updateStudentProfileOptions(studentData);
            }
        }
        
        // 更新学生档案选项（转学分需求和上课目的）
        function updateStudentProfileOptions(studentData) {
            // 更新转学分需求
            if (studentData.creditTransfer) {
                const creditTransferRadio = document.querySelector(`input[name="creditTransfer"][value="${studentData.creditTransfer}"]`);
                if (creditTransferRadio) {
                    // 清除所有选中状态
                    document.querySelectorAll('input[name="creditTransfer"]').forEach(radio => {
                        radio.checked = false;
                    });
                    // 设置对应选项为选中
                    creditTransferRadio.checked = true;
                }
            }
            
            // 更新上课目的
            if (studentData.coursePurpose && Array.isArray(studentData.coursePurpose)) {
                // 先清除所有选中状态
                document.querySelectorAll('input[name="coursePurpose"]').forEach(checkbox => {
                    checkbox.checked = false;
                });
                
                // 设置对应选项为选中
                studentData.coursePurpose.forEach(purpose => {
                    const purposeCheckbox = document.querySelector(`input[name="coursePurpose"][value="${purpose}"]`);
                    if (purposeCheckbox) {
                        purposeCheckbox.checked = true;
                    }
                });
            }
        }
        
        // 根据学生姓名获取学生数据
        function getStudentDataByName(studentName) {
            // 预设的学生数据映射，包含个性化档案信息
            const studentDataMap = {
                '张明': { 
                    name: '张明', 
                    school: 'Harvard University',
                    creditTransfer: 'yes',
                    coursePurpose: ['graduation', 'gradschool']
                },
                '李小雨': { 
                    name: '李小雨', 
                    school: 'Stanford University',
                    creditTransfer: 'no',
                    coursePurpose: ['transfer', 'studyabroad']
                },
                '王晓华': { 
                    name: '王晓华', 
                    school: 'University of Toronto',
                    creditTransfer: 'yes',
                    coursePurpose: ['graduation']
                },
                '陈思远': { 
                    name: '陈思远', 
                    school: 'University of British Columbia',
                    creditTransfer: 'yes',
                    coursePurpose: ['graduation', 'transfer', 'gradschool']
                },
                '刘佳妮': { 
                    name: '刘佳妮', 
                    school: 'McGill University',
                    creditTransfer: 'no',
                    coursePurpose: ['gradschool', 'studyabroad']
                }
            };
            
            return studentDataMap[studentName] || { 
                name: studentName, 
                school: '未知学校',
                creditTransfer: 'yes',
                coursePurpose: ['graduation']
            };
        }
        
        // 初始化文件上传功能
        function initFileUpload() {
            const fileInput = document.getElementById('graduationReqFile');
            const uploadArea = document.querySelector('.file-upload-area');
            const uploadedFilesContainer = document.getElementById('uploadedFiles');
            let uploadedFiles = [];
            
            // 文件选择事件
            fileInput.addEventListener('change', function(e) {
                handleFiles(e.target.files);
            });
            
            // 拖拽上传功能
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', function(e) {
                e.preventDefault();
                this.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('dragover');
                handleFiles(e.dataTransfer.files);
            });
            
            // 处理文件
            function handleFiles(files) {
                Array.from(files).forEach(file => {
                    // 文件大小检查 (10MB)
                    if (file.size > 10 * 1024 * 1024) {
                        alert(`文件 "${file.name}" 超过10MB限制`);
                        return;
                    }
                    
                    // 文件类型检查
                    const allowedTypes = ['.pdf', '.doc', '.docx', '.jpg', '.jpeg', '.png', '.gif'];
                    const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
                    if (!allowedTypes.includes(fileExtension)) {
                        alert(`文件 "${file.name}" 格式不支持`);
                        return;
                    }
                    
                    // 检查文件是否已存在
                    if (uploadedFiles.some(f => f.name === file.name && f.size === file.size)) {
                        alert(`文件 "${file.name}" 已存在`);
                        return;
                    }
                    
                    uploadedFiles.push(file);
                    updateUploadedFilesList();
                });
            }
            
            // 更新已上传文件列表
            function updateUploadedFilesList() {
                if (uploadedFiles.length === 0) {
                    uploadedFilesContainer.style.display = 'none';
                    return;
                }
                
                uploadedFilesContainer.style.display = 'block';
                uploadedFilesContainer.innerHTML = uploadedFiles.map((file, index) => `
                    <div class="uploaded-file-item">
                        <span class="uploaded-file-name">${file.name} (${formatFileSize(file.size)})</span>
                        <button type="button" class="uploaded-file-remove" onclick="removeUploadedFile(${index})" title="删除文件">✖</button>
                    </div>
                `).join('');
            }
            
            // 删除已上传文件
            window.removeUploadedFile = function(index) {
                uploadedFiles.splice(index, 1);
                updateUploadedFilesList();
            };
            
            // 格式化文件大小
            function formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
        }
        
        // 初始化学生档案表单
        function initStudentProfileForm() {
            const form = document.getElementById('studentProfileForm');
            
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // 收集表单数据
                const formData = new FormData();
                
                // 基本信息
                formData.append('studentName', document.getElementById('studentName').value);
                formData.append('studentSchool', document.getElementById('studentSchool').value);
                
                // 转学分需求
                const creditTransfer = document.querySelector('input[name="creditTransfer"]:checked');
                formData.append('creditTransfer', creditTransfer ? creditTransfer.value : '');
                
                // 上课目的
                const coursePurposes = [];
                document.querySelectorAll('input[name="coursePurpose"]:checked').forEach(checkbox => {
                    coursePurposes.push(checkbox.value);
                });
                formData.append('coursePurpose', coursePurposes.join(','));
                
                // 毕业要求文件
                const fileInput = document.getElementById('graduationReqFile');
                if (fileInput.files.length > 0) {
                    Array.from(fileInput.files).forEach(file => {
                        formData.append('graduationReqFiles', file);
                    });
                }
                
                // 提交表单
                submitStudentProfile(formData);
            });
        }
        
        // 提交学生档案
        function submitStudentProfile(formData) {
            // 显示提交成功消息
            const studentName = formData.get('studentName');
            const creditTransfer = formData.get('creditTransfer') === 'yes' ? '需要' : '不需要';
            const purposes = formData.get('coursePurpose').split(',').map(p => {
                const purposeMap = {
                    'graduation': '毕业',
                    'transfer': '转学',
                    'gradschool': '申研',
                    'studyabroad': '游学'
                };
                return purposeMap[p] || p;
            }).join('、');
            
            const fileCount = document.getElementById('graduationReqFile').files.length;
            
            let message = `档案搜集提交成功！\n\n`;
            message += `学生: ${studentName}\n`;
            message += `学校: ${formData.get('studentSchool')}\n`;
            message += `转学分需求: ${creditTransfer}\n`;
            message += `上课目的: ${purposes}\n`;
            if (fileCount > 0) {
                message += `已上传 ${fileCount} 个毕业要求文件`;
            }
            
            alert(message);
            
            console.log('学生档案数据:', {
                studentName: formData.get('studentName'),
                studentSchool: formData.get('studentSchool'),
                creditTransfer: formData.get('creditTransfer'),
                coursePurpose: formData.get('coursePurpose'),
                fileCount: fileCount
            });
        }
        
        // 订阅中心筛选功能
        function initSubscriptionFilters() {
            const typeFilter = document.getElementById('subscription-type-filter');
            const statusFilter = document.getElementById('status-filter');
            
            if (typeFilter && statusFilter) {
                typeFilter.addEventListener('change', filterSubscriptions);
                statusFilter.addEventListener('change', filterSubscriptions);
            }
        }
        
        function filterSubscriptions() {
            const typeFilter = document.getElementById('subscription-type-filter').value;
            const statusFilter = document.getElementById('status-filter').value;
            const tableRows = document.querySelectorAll('.subscription-center-table tbody tr');
            
            tableRows.forEach(row => {
                let showRow = true;
                
                // 筛选订阅类型
                if (typeFilter) {
                    const typeBadge = row.querySelector('.subscription-type-badge');
                    const typeClass = typeBadge ? typeBadge.className : '';
                    
                    if (typeFilter === 'product' && !typeClass.includes('type-product')) {
                        showRow = false;
                    } else if (typeFilter === 'home' && !typeClass.includes('type-home')) {
                        showRow = false;
                    }
                }
                
                // 筛选状态
                if (statusFilter && showRow) {
                    const statusCell = row.querySelector('td:nth-child(4)');
                    const statusClass = statusCell ? statusCell.className : '';
                    
                    if (statusFilter === 'waiting' && !statusClass.includes('status-waiting')) {
                        showRow = false;
                    } else if (statusFilter === 'matched' && !statusClass.includes('status-matched')) {
                        showRow = false;
                    } else if (statusFilter === 'notified' && !statusClass.includes('status-notified')) {
                        showRow = false;
                    } else if (statusFilter === 'viewed' && !statusClass.includes('status-viewed')) {
                        showRow = false;
                    } else if (statusFilter === 'converted' && !statusClass.includes('status-converted')) {
                        showRow = false;
                    } else if (statusFilter === 'expired' && !statusClass.includes('status-expired')) {
                        showRow = false;
                    }
                }
                
                row.style.display = showRow ? '' : 'none';
            });
        }
        
        function resetSubscriptionFilters() {
            document.getElementById('subscription-type-filter').value = '';
            document.getElementById('status-filter').value = '';
            filterSubscriptions();
        }
        
        // 初始化订阅筛选功能
        document.addEventListener('DOMContentLoaded', function() {
            initSubscriptionFilters();
        });
    </script>
</body>
</html>
