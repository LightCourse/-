<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>课程订阅信息 - LightCourseCRM</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-green: #2ecc71;
            --light-green: #98FB98;
            --dark-green: #27ae60;
            --hover-green: #229954;
            --bg-green: #F0FFF0;
            
            /* 字体层级变量 */
            --font-size-xl: 20px;      /* 大标题 */
            --font-size-lg: 16px;      /* 小节标题 */
            --font-size-base: 14px;    /* 基础字体 */
            --font-size-md: 14px;      /* 表单标签/正文 */
            --font-size-sm: 12px;      /* 辅助说明 */
            
            --font-weight-bold: 700;     /* 粗体 */
            --font-weight-semibold: 600; /* 半粗体 */
            --font-weight-medium: 500;   /* 中等字重 */
            --font-weight-regular: 400;  /* 常规字重 */
            
            /* 颜色变量 */
            --text-primary: #2c3e50;   /* 主要文本 */
            --text-secondary: #495057; /* 次要文本 */
            --text-muted: #6c757d;     /* 静音文本 */
            --text-hint: #909399;      /* 提示文本 */
            
            /* 蓝色主题变量 */
            --primary-blue: #007bff;
            --primary-blue-dark: #0056b3;
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
        }
        
        body {
            font-family: "Noto Sans SC", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: white;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .header {
            background: white;
            color: var(--text-primary);
            padding: 15px 20px;
            border-radius: 8px;
            border: 1px solid #e1e5e9;
            box-shadow: 0 2px 6px rgba(15, 23, 42, 0.06);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            border-bottom: 1px solid #f1f3f5;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            margin: 0;
            color: var(--primary-green);
            text-shadow: none;
        }

        .breadcrumb {
            font-size: 14px;
            margin-top: 5px;
            color: var(--primary-green);
            opacity: 0.8;
        }

        .main-layout {
            display: flex;
            margin-top: 80px;
            min-height: calc(100vh - 80px);
        }

        .student-layout {
            display: flex;
            min-height: calc(100vh - 160px);
        }

        .student-sidebar {
            width: 220px;
            background: white;
            border-right: 1px solid #ddd;
            padding: 20px;
        }

        .student-content {
            flex: 1;
        }

        .product-layout {
            display: flex;
            min-height: calc(100vh - 160px);
        }

        .product-sidebar {
            width: 220px;
            background: white;
            border-right: 1px solid #ddd;
            padding: 20px;
        }

        .product-content {
            flex: 1;
        }

        .product-table-container {
            margin: 20px 0;
            padding: 16px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e1e5e9;
            box-shadow: 0 2px 6px rgba(15, 23, 42, 0.06);
        }

        .product-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
            background: white;
            border-radius: 6px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(15, 23, 42, 0.08);
        }

        .product-table thead th {
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--dark-green) 100%);
            color: white;
            font-weight: 600;
            letter-spacing: 0.4px;
            padding: 14px 12px;
            text-align: left;
            white-space: nowrap;
        }

        #product-course-mapping .product-table thead tr:first-child th {
            background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
        }

        .product-table tbody td {
            padding: 12px;
            border-bottom: 1px solid #e1e5e9;
            color: #334155;
            background: white;
        }

        .product-table tbody tr:nth-child(even) td {
            background: #f9fafb;
        }

        .product-table tbody tr:hover td {
            background: #e8f1fe;
        }

        .university-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
            background: white;
            border-radius: 6px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(15, 23, 42, 0.08);
        }

        .university-table thead th {
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--dark-green) 100%);
            color: white;
            font-weight: 600;
            letter-spacing: 0.4px;
            padding: 14px 12px;
            text-align: left;
            white-space: nowrap;
        }

        .university-table tbody td {
            padding: 12px;
            border-bottom: 1px solid #e1e5e9;
            color: #334155;
            background: white;
        }

        .university-table tbody tr:nth-child(even) td {
            background: #f9fafb;
        }

        .university-table tbody tr:hover td {
            background: #e6f4ea;
        }

        .university-layout {
            display: flex;
            min-height: calc(100vh - 160px);
        }

        .university-sidebar {
            width: 220px;
            background: white;
            border-right: 1px solid #ddd;
            padding: 20px;
        }

        .university-content {
            flex: 1;
        }
        
        .sidebar-section {
            margin-bottom: 30px;
        }
        
        .sidebar-title {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 6px;
        }
        
        .sidebar-title:hover {
            background: #f8f9fa;
            color: #007bff;
            padding-left: 8px;
        }
        
        .sidebar-title.active {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            border-radius: 6px;
            padding-left: 8px;
            box-shadow: 0 2px 8px rgba(0, 123, 255, 0.3);
        }
        
        .function-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px 0;
        }
        
        .function-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .home-subscribe-btn {
            background: #1e90ff;
            color: white;
        }
        
        .home-subscribe-btn:hover {
            background: #0066cc;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(30, 144, 255, 0.4);
        }
        
        .product-subscribe-btn {
            background: #ffa500;
            color: white;
        }
        
        .product-subscribe-btn:hover {
            background: #e6940a;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(255, 165, 0, 0.4);
        }
        
        .batch-subscribe-btn {
            background: var(--primary-green);
            color: white;
        }
        
        .batch-subscribe-btn:hover:not(:disabled) {
            background: var(--hover-green);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(46, 204, 113, 0.4);
        }
        
        .batch-subscribe-btn:disabled {
            background: #cccccc;
            color: #666666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        /* 批量订阅下拉菜单样式 */
        .batch-subscribe-dropdown {
            position: relative;
            display: inline-block;
        }
        
        .dropdown-arrow {
            margin-left: 8px;
            font-size: 12px;
            transition: transform 0.3s ease;
        }
        
        .batch-subscribe-dropdown:hover .dropdown-arrow {
            transform: rotate(180deg);
        }
        
        .dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            background: white;
            border: 1px solid #e1e5e9;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            z-index: 1000;
            min-width: 200px;
        }
        
        .batch-subscribe-dropdown:hover .dropdown-menu:not(.disabled) {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .dropdown-menu.disabled {
            opacity: 0;
            visibility: hidden;
        }
        
        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 8px;
            width: 100%;
            padding: 12px 16px;
            border: none;
            background: white;
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            border-radius: 0;
        }
        
        .dropdown-item:first-child {
            border-radius: 6px 6px 0 0;
        }
        
        .dropdown-item:last-child {
            border-radius: 0 0 6px 6px;
        }
        
        .dropdown-item:hover {
            background: #f8f9fa;
            color: var(--primary-green);
        }
        
        .dropdown-item .btn-icon {
            font-size: 16px;
        }
        
        /* 单门课程订阅方式选择模态框样式 */
        .course-info-display {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
        }
        
        .info-row-horizontal {
            display: flex;
            gap: 20px;
        }
        
        /* 不可编辑字段样式 */
        .info-value.readonly-field {
            background-color: #f8f9fa !important;
            color: #6c757d !important;
            cursor: not-allowed !important;
            padding: 8px 12px !important;
            border-radius: 4px;
            border: 1px solid #e9ecef;
            user-select: none;
            font-weight: 500 !important;
            font-size: 14px;
        }
        
        .info-value.readonly-field:hover {
            background-color: #e9ecef !important;
            border-color: #dee2e6;
        }
        
        .info-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .info-item .info-label {
            font-size: 13px;
            font-weight: 500;
            color: #6c757d;
        }
        
        .info-item .info-value {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            padding: 10px 12px;
            background: white;
            border-radius: 4px;
            border: 1px solid #e9ecef;
        }
        
        .subscription-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .option-card {
            border: 2px solid #e9ecef;
            border-radius: 6px;
            padding: 12px 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .option-card:hover {
            border-color: var(--primary-green);
            background: #f0fff0;
        }
        
        .option-card.selected {
            border-color: var(--primary-green);
            background: #f0fff0;
        }
        
        .option-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 6px;
        }
        
        .option-title {
            font-size: 15px;
            font-weight: 600;
            color: #333;
            cursor: pointer;
            margin: 0;
        }
        
        .option-description {
            font-size: 13px;
            color: #6c757d;
            margin: 0;
            line-height: 1.4;
            padding-left: 28px;
        }
        
        .subscription-options input[type="radio"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .function-btn .btn-icon {
            font-size: 16px;
        }
        
        .course-checkbox {
            cursor: pointer;
            transform: scale(1.2);
        }
        
        .student-table td[rowspan] {
            border-right: 2px solid #ddd;
            background-color: #f9f9f9;
        }
        
        /* 模态框样式 */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 8px;
            width: 95%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid #e9ecef;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }
        
        .modal-header h3 {
            margin: 0;
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-bold);
            color: var(--text-primary);
        }
        
        /* 课程订阅模态框绿色主题样式 */
        .modal-header.product-course {
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--dark-green) 100%);
            color: white;
        }
        
        .modal-header.product-course h3 {
            color: white;
        }
        
        .modal-header.product-course .modal-close {
            color: white;
            opacity: 0.8;
        }
        
        .modal-header.product-course .modal-close:hover {
            opacity: 1;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: rgba(255, 255, 255, 0.8);
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.2s ease;
        }
        
        .modal-close:hover {
            color: white;
        }
        
        .modal-body {
            padding: 24px;
        }
        
        /* 顶部信息区样式 */
        .info-header {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 24px;
            border: 1px solid #e3e6ea;
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
        }
        
        .info-item {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .info-label {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .info-value {
            font-size: var(--font-size-md);
            font-weight: var(--font-weight-regular);
            color: var(--text-primary);
            padding: 10px 14px;
            background: white;
            border-radius: 6px;
            border: 1px solid #e3e6ea;
            min-height: 20px;
            line-height: 1.5;
        }
        
        /* 表单区域样式 */
        .form-section {
            margin-top: 16px;
        }
        
        .section-title {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-bold);
            color: var(--text-primary);
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e9ecef;
        }
        
        .form-grid {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .form-field {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 20px;
            padding: 12px 16px;
            background: #fafbfc;
            border-radius: 12px;
            border: 1px solid #e9ecef;
        }
        
        .field-left {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .field-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            margin-bottom: 4px;
        }
        
        .field-title-group {
            display: flex;
            align-items: baseline;
            gap: 12px;
        }
        
        .field-label {
            font-size: var(--font-size-md);
            font-weight: var(--font-weight-bold);
            color: var(--text-primary);
            margin: 0;
        }
        
        .field-hint {
            font-size: var(--font-size-sm);
            color: var(--text-hint);
            margin: 0;
            line-height: 1.4;
        }
        
        .field-control {
            min-width: 240px;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .field-right {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 0;
        }
        
        /* 表单控件样式 */
        .form-input, .form-select {
            padding: 10px 12px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: var(--font-size-md);
            font-weight: var(--font-weight-regular);
            color: var(--text-primary);
            transition: all 0.2s ease;
            background: white;
            line-height: 1.4;
        }
        
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }
        
        .form-input:hover, .form-select:hover {
            border-color: #007bff;
        }
        
        /* 日期范围输入 */
        .date-range-wrapper {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .date-input {
            flex: 1;
        }
        
        .date-separator {
            color: #6c757d;
            font-weight: 500;
            padding: 0 2px;
            font-size: var(--font-size-sm);
        }
        
        /* 组合输入框 */
        .combo-input {
            display: flex;
            align-items: center;
            gap: 4px;
            background: #f8f9fa;
            padding: 2px;
            border-radius: 6px;
            border: 2px solid #e9ecef;
            transition: border-color 0.2s ease;
        }
        
        .combo-input:focus-within {
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }
        
        .combo-label, .combo-unit {
            color: var(--text-secondary);
            font-weight: var(--font-weight-medium);
            font-size: var(--font-size-md);
            white-space: nowrap;
            padding: 0 8px;
        }
        
        .combo-select, .combo-number {
            border: none;
            background: white;
            padding: 8px 10px;
            border-radius: 4px;
            font-size: var(--font-size-md);
            font-weight: var(--font-weight-regular);
            color: var(--text-primary);
            min-width: 80px;
        }
        
        .combo-select:focus, .combo-number:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
        }
        
        /* 开关样式 */
        .switch-wrapper {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .switch-label {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            color: var(--text-secondary);
            user-select: none;
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 48px;
            height: 26px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .3s;
            border-radius: 26px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .3s;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        input:checked + .slider {
            background-color: var(--primary-green);
        }
        
        input:checked + .slider:before {
            transform: translateX(22px);
        }
        
        .slider:hover {
            box-shadow: 0 0 8px rgba(46, 204, 113, 0.3);
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .info-header {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .form-grid {
                gap: 16px;
            }
            
            .date-range-wrapper {
                flex-direction: column;
                gap: 8px;
            }
            
            .date-separator {
                display: none;
            }
            
            .combo-input {
                flex-wrap: wrap;
                gap: 6px;
            }
            
            .modal-footer {
                flex-direction: column-reverse;
                gap: 12px;
            }
            
            .btn {
                width: 100%;
            }
        }
        
        @media (min-width: 769px) {
            .form-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 24px 20px;
            }
            
            .form-field:nth-child(2) {
                grid-column: 1 / -1;
            }
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            padding: 20px 24px;
            border-top: 1px solid #e9ecef;
            background-color: #f8f9fa;
        }
        
        /* 通用按钮样式 */
        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-size: var(--font-size-md);
            font-weight: var(--font-weight-medium);
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 110px;
            line-height: 1.5;
        }
        
        .btn-cancel:hover {
            background: #e9ecef;
            color: var(--text-primary);
            border-color: #dee2e6;
        }
        
        /* 保存按钮 */
        .btn-save {
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--hover-green) 100%);
            color: white;
            font-weight: var(--font-weight-medium);
            box-shadow: 0 2px 4px rgba(50, 205, 50, 0.2);
        }
        
        .btn-save:hover {
            background: linear-gradient(135deg, var(--hover-green) 0%, var(--dark-green) 100%);
            box-shadow: 0 4px 8px rgba(50, 205, 50, 0.3);
            transform: translateY(-1px);
        }
        
        .btn-save:active {
            transform: translateY(0);
        }
        
        /* 批量设置样式 */
        .batch-info-header {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            border: 1px solid #e3e6ea;
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 16px;
        }
        
        /* 课程列表样式 */
        .course-list-item {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .course-list-container {
            background: white;
            border: 1px solid #e3e6ea;
            border-radius: 6px;
            padding: 0;
            min-height: 40px;
            max-height: 120px;
            overflow: hidden;
        }
        
        /* 选择模态框中的课程列表样式 */
        .course-list-container .course-list-scroll.readonly-field {
            background-color: #f8f9fa !important;
            cursor: default !important;
            max-height: 100px;
            overflow-y: auto !important;
        }
        
        .course-list-container .course-count-title {
            background: #f8f9fa;
            padding: 8px 12px;
            font-size: 13px;
            font-weight: 500;
            color: #6c757d;
            border-bottom: 1px solid #e9ecef;
        }
        
        .course-list-scroll {
            max-height: 120px;
            overflow-y: auto;
            padding: 8px 12px;
        }
        
        .course-item-row {
            padding: 4px 0;
            border-bottom: 1px solid #f1f3f5;
            font-size: var(--font-size-sm);
            color: var(--text-primary);
            line-height: 1.4;
        }
        
        .course-item-row:last-child {
            border-bottom: none;
        }
        
        /* 选择模态框中的只读课程行样式 */
        .readonly-field .course-item-row {
            color: #6c757d;
            padding: 6px 12px;
            font-size: 13px;
        }
        
        .course-count-title {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            color: var(--text-secondary);
            margin-bottom: 4px;
        }
        
        /* 滚动条样式 */
        .course-list-scroll::-webkit-scrollbar {
            width: 4px;
        }
        
        .course-list-scroll::-webkit-scrollbar-track {
            background: #f1f3f5;
            border-radius: 2px;
        }
        
        .course-list-scroll::-webkit-scrollbar-thumb {
            background: #c1c7cd;
            border-radius: 2px;
        }
        
        .course-list-scroll::-webkit-scrollbar-thumb:hover {
            background: #a8b2ba;
        }
        
        /* 学生跟进表格样式 */
        .student-follow-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .student-follow-table th {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 12px 8px;
            text-align: left;
            font-weight: var(--font-weight-semibold);
            color: var(--text-primary);
            border-bottom: 2px solid #dee2e6;
            font-size: var(--font-size-sm);
            white-space: nowrap;
        }
        
        .student-follow-table td {
            padding: 10px 8px;
            border-bottom: 1px solid #f1f3f5;
            font-size: var(--font-size-sm);
            color: var(--text-primary);
            vertical-align: middle;
        }
        
        .student-row:hover {
            background-color: #f8f9fa;
        }
        
        .student-row:nth-child(even) {
            background-color: #fdfdfd;
        }
        
        .student-row:nth-child(even):hover {
            background-color: #f8f9fa;
        }
        
        /* 表格列宽设置 */
        .checkbox-col { width: 40px; text-align: center; }
        .student-name-col { width: 100px; }
        .school-col { width: 120px; }
        .entry-time-col { width: 140px; }
        .next-follow-col { width: 140px; }
        .status-col { width: 90px; }
        .wechat-col { width: 100px; }
        .report-col { width: 80px; text-align: center; }
        .subscription-col { width: 180px; }
        .action-col { width: 120px; text-align: center; }
        
        /* 状态标签样式 */
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: var(--font-weight-medium);
            white-space: nowrap;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .status-following {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .status-completed {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        /* 操作按钮样式 */
        .btn-edit, .btn-follow, .btn-delete {
            background: none;
            border: none;
            padding: 4px 6px;
            margin: 0 2px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }
        
        .btn-edit:hover {
            background: #e3f2fd;
        }
        
        .btn-follow:hover {
            background: #f3e5f5;
        }
        
        .btn-delete:hover {
            background: #ffebee;
        }
        
        .btn-link {
            background: none;
            border: none;
            color: var(--primary-blue);
            text-decoration: underline;
            cursor: pointer;
            font-size: var(--font-size-sm);
            padding: 2px 4px;
        }
        
        .btn-link:hover {
            color: var(--primary-blue-dark);
        }
        
        /* 学生姓名高亮 */
        .student-name {
            font-weight: var(--font-weight-medium);
            color: var(--text-primary);
        }
        
        /* 课程订阅信息样式 */
        .subscription-info {
            max-width: 180px;
            word-wrap: break-word;
            line-height: 1.4;
        }
        
        /* 学生选课分析页面样式 */
        .page-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            z-index: 1000;
            overflow-y: auto;
        }
        
        /* 学生档案表单样式 */
        .student-profile-form {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .profile-form-field {
            margin-bottom: 24px;
        }
        
        .profile-form-field label {
            display: block;
            font-size: var(--font-size-md);
            font-weight: var(--font-weight-medium);
            color: var(--text-primary);
            margin-bottom: 8px;
        }
        
        .profile-form-field input[type="text"],
        .profile-form-field select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: var(--font-size-md);
            color: var(--text-primary);
            background: white;
            transition: all 0.2s ease;
            box-sizing: border-box;
        }
        
        .profile-form-field input[type="text"]:focus,
        .profile-form-field select:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }
        
        .profile-form-field input[type="text"]:disabled {
            background-color: #f8f9fa;
            color: #6c757d;
            cursor: not-allowed;
            border-color: #e9ecef;
        }
        
        .profile-radio-group {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }
        
        .profile-radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .profile-radio-option input[type="radio"] {
            width: 16px;
            height: 16px;
            margin: 0;
        }
        
        .profile-radio-option label {
            font-size: var(--font-size-md);
            color: var(--text-primary);
            margin: 0;
            cursor: pointer;
        }
        
        .profile-checkbox-group {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }
        
        .profile-checkbox-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .profile-checkbox-option input[type="checkbox"] {
            width: 16px;
            height: 16px;
            margin: 0;
        }
        
        .profile-checkbox-option label {
            font-size: var(--font-size-md);
            color: var(--text-primary);
            margin: 0;
            cursor: pointer;
        }
        
        .file-upload-area {
            border: 2px dashed #e9ecef;
            border-radius: 8px;
            padding: 40px 20px;
            text-align: center;
            background: #f8f9fa;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .file-upload-area:hover {
            border-color: var(--primary-blue);
            background: #f0f7ff;
        }
        
        .file-upload-area.dragover {
            border-color: var(--primary-blue);
            background: #e6f3ff;
        }
        
        .file-upload-icon {
            font-size: 48px;
            color: #6c757d;
            margin-bottom: 16px;
        }
        
        .file-upload-text {
            font-size: var(--font-size-md);
            color: var(--text-secondary);
            margin-bottom: 8px;
        }
        
        .file-upload-hint {
            font-size: var(--font-size-sm);
            color: var(--text-muted);
        }
        
        .uploaded-files {
            margin-top: 16px;
        }
        
        .uploaded-file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            margin-bottom: 8px;
        }
        
        .uploaded-file-name {
            font-size: var(--font-size-sm);
            color: var(--text-primary);
        }
        
        .uploaded-file-remove {
            background: none;
            border: none;
            color: #dc3545;
            cursor: pointer;
            font-size: 16px;
            padding: 4px;
        }
        
        .uploaded-file-remove:hover {
            color: #c82333;
        }
        
        .profile-submit-btn {
            width: 100%;
            padding: 14px 24px;
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--hover-green) 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: var(--font-size-md);
            font-weight: var(--font-weight-medium);
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 32px;
        }
        
        .profile-submit-btn:hover {
            background: linear-gradient(135deg, var(--hover-green) 0%, var(--dark-green) 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(46, 204, 113, 0.3);
        }
        
        /* 自主选课Excel表格样式 */
        .autonomous-course-container {
            padding: 20px;
            max-width: 100%;
            overflow-x: auto;
        }
        
        .course-table-excel {
            width: 100%;
            border-collapse: collapse;
            background: white;
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            font-size: 13px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-radius: 6px;
            overflow: hidden;
        }
        
        .course-table-excel th {
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--dark-green) 100%);
            color: white;
            padding: 12px 10px;
            text-align: center;
            font-weight: 600;
            font-size: 12px;
            border-right: 1px solid rgba(255, 255, 255, 0.2);
            white-space: nowrap;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .course-table-excel th:last-child {
            border-right: none;
        }
        
        .course-table-excel td {
            padding: 10px;
            border-bottom: 1px solid #e1e5e9;
            border-right: 1px solid #e1e5e9;
            text-align: center;
            vertical-align: middle;
            background: white;
        }
        
        .course-table-excel td:last-child {
            border-right: none;
        }
        
        .course-table-excel tbody tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .course-table-excel tbody tr:hover {
            background-color: #e3f2fd;
        }
        
        /* 课程代码列样式 */
        .course-code-cell {
            font-family: "Consolas", "Monaco", monospace;
            font-weight: 600;
            color: #2c3e50;
            background-color: #f0f3f7 !important;
            text-align: left;
            padding-left: 12px;
            position: relative; /* 支持订阅按钮绝对定位 */
            padding-right: 40px; /* 为订阅按钮预留空间 */
        }
        
        /* 自主选课页面订阅按钮特殊样式 - 仅在课程代码列显示 */
        #autonomous-selection .course-code-cell .course-subscribe-btn {
            position: absolute;
            top: 50%;
            right: 5px;
            transform: translateY(-50%);
            background: none;
            color: #ffa500;
            border: none;
            font-size: 11px;
            font-weight: bold;
            cursor: pointer;
            opacity: 0.8;
            transition: all 0.3s ease;
            padding: 2px 4px;
            border-radius: 3px;
            z-index: 5;
        }
        
        #autonomous-selection .course-code-cell .course-subscribe-btn:hover {
            opacity: 1;
            background-color: rgba(255, 165, 0, 0.1);
            transform: translateY(-50%) scale(1.05);
        }
        
        #autonomous-selection .course-code-cell .course-subscribe-btn.subscribed {
            color: #28a745;
            opacity: 1;
        }
        
        /* 防护措施：确保其他列绝对不出现订阅按钮 */
        #autonomous-selection .available-units-cell .course-subscribe-btn,
        #autonomous-selection .general-category-cell .course-subscribe-btn,
        #autonomous-selection .correspondence-cell .course-subscribe-btn {
            display: none !important;
        }
        
        /* 课程名称列样式 */
        .course-name-cell {
            text-align: left;
            padding-left: 12px;
            max-width: 200px;
            line-height: 1.4;
        }
        
        /* 通识类别样式 */
        .general-category-cell {
            font-weight: 500;
            color: #7b68ee;
        }
        
        /* 复选框列样式 */
        .checkbox-cell {
            width: 40px;
            text-align: center;
            background-color: #f8f9fa !important;
        }
        
        .course-checkbox {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }
        
        /* 课程对应数量样式 */
        .correspondence-cell {
            font-weight: 600;
        }
        
        .correspondence-available {
            color: #28a745;
        }
        
        .correspondence-none {
            color: #dc3545;
        }
        
        /* 课程类型标签 */
        .course-type-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .type-lecture {
            background-color: #e3f2fd;
            color: #1565c0;
        }
        
        .type-studio {
            background-color: #f3e5f5;
            color: #7b1fa2;
        }
        
        .type-lab {
            background-color: #e8f5e8;
            color: #2e7d32;
        }
        
        /* 可售课程单元样式 */
        .available-units-cell {
            font-weight: 600;
        }
        
        .units-available {
            color: #28a745;
        }
        
        .units-none {
            color: #dc3545;
        }
        
        /* 表格响应式 */
        @media (max-width: 768px) {
            .autonomous-course-container {
                padding: 10px;
            }
            
            .course-table-excel {
                font-size: 12px;
            }
            
            .course-table-excel th,
            .course-table-excel td {
                padding: 8px 6px;
            }
            
            .course-name-cell {
                max-width: 150px;
            }
        }
        
        /* 学生已选课程表格样式 */
        .selected-courses-container {
            padding: 20px;
            max-width: 100%;
            overflow-x: auto;
        }
        
        .selected-courses-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            font-size: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-radius: 6px;
            overflow: hidden;
        }
        
        .selected-courses-table th {
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--dark-green) 100%);
            color: white;
            padding: 12px 8px;
            text-align: center;
            font-weight: 600;
            font-size: 11px;
            border-right: 1px solid rgba(255, 255, 255, 0.2);
            white-space: nowrap;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .selected-courses-table th:last-child {
            border-right: none;
        }
        
        .selected-courses-table td {
            padding: 10px 8px;
            border-bottom: 1px solid #e1e5e9;
            border-right: 1px solid #e1e5e9;
            text-align: center;
            vertical-align: middle;
            background: white;
            font-size: 11px;
        }
        
        .selected-courses-table td:last-child {
            border-right: none;
        }
        
        .selected-courses-table tbody tr:nth-child(even) {
            background-color: white;
        }
        
        .selected-courses-table tbody tr:hover {
            background-color: #f8f9fa;
        }
        
        /* 本校课程列样式 */
        .home-course-cell {
            font-family: "Consolas", "Monaco", monospace;
            font-weight: 600;
            color: #2c3e50;
            background-color: white !important;
        }

        .home-course-cell .home-course-code {
            font-size: 12px;
            font-weight: 700;
        }

        .home-course-cell .home-course-name {
            font-size: 11px;
            color: #6c757d;
            margin-top: 2px;
            font-weight: 500;
        }
        
        /* 课程满足类别样式 */
        .course-category-badge {
            display: inline-block;
            padding: 3px 6px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 600;
        }
        
        .category-required {
            background-color: #dc3545;
            color: white;
        }
        
        .category-elective {
            background-color: #007bff;
            color: white;
        }
        
        .category-general {
            background-color: #28a745;
            color: white;
        }
        
        .category-free {
            background-color: #6c757d;
            color: white;
        }
        
        /* 当前状态样式 */
        .status-potential {
            color: #fd7e14;
            font-weight: 600;
        }
        
        .status-serving {
            color: #20c997;
            font-weight: 600;
        }
        
        /* 审核状态样式 */
        .audit-status-text {
            font-size: 11px;
            font-weight: 600;
        }
        
        .audit-not-submitted {
            color: #6c757d;
        }
        
        .audit-ai-passed {
            color: #28a745;
        }
        
        .audit-ai-rejected {
            color: #dc3545;
        }
        
        /* 产品课程信息样式 */
        .product-course-cell {
            text-align: left;
            line-height: 1.4;
        }
        
        .product-course-code {
            font-family: "Consolas", "Monaco", monospace;
            font-weight: 600;
            color: #495057;
            display: block;
        }
        
        .product-course-name {
            color: #6c757d;
            font-size: 10px;
            margin-top: 2px;
            display: block;
        }

        .product-course-meta {
            display: block;
            font-size: 10px;
            color: #94a3b8;
            margin-top: 2px;
            font-weight: 500;
        }
        
        /* 产品学校样式 */
        .product-school-cell {
            font-weight: 500;
            color: #495057;
            font-size: 10px;
        }

        .product-school-onsale {
            color: #0f9d58;
            font-weight: 600;
        }

        .product-school-soldout {
            color: #6c757d;
        }
        
        /* 日期、价格等信息样式 */
        .date-cell, .price-cell, .code-cell, .duration-cell {
            font-weight: 500;
            font-size: 11px;
        }
        
        .price-cell {
            color: #e83e8c;
            font-weight: 600;
        }
        
        /* 合并单元格边框样式 */
        .merged-cell {
            border-right: 2px solid #4a90e2;
            background-color: white !important;
        }
        
        /* 课程订阅中心 - 卡片式布局样式 */
        .subscription-center-container {
            padding: 24px;
            max-width: 100%;
        }
        
        .subscription-cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 24px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .subscription-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            border: 1px solid #f1f5f9;
            overflow: hidden;
            transition: all 0.3s ease;
            font-family: "Noto Sans SC", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }
        
        .subscription-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            border-color: #e2e8f0;
        }
        
        .card-header {
            padding: 24px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            border-bottom: 1px solid #f8fafc;
            position: relative;
        }
        
        .course-main-info {
            flex: 1;
            padding-right: 16px;
        }
        
        .course-title {
            font-size: 20px;
            font-weight: 600;
            color: #0f172a;
            margin: 0 0 8px 0;
            line-height: 1.3;
            letter-spacing: -0.5px;
        }
        
        .course-subtitle {
            font-size: 15px;
            font-weight: 400;  
            color: #64748b;
            margin: 0 0 6px 0;
            line-height: 1.4;
        }
        
        .university-name {
            font-size: 13px;
            font-weight: 500;
            color: #94a3b8;
            margin: 0;
            letter-spacing: 0.1px;
        }        /* 筛选区域样式 - 升级版 */
        .subscription-filter-area {
            display: flex;
            gap: 24px;
            align-items: center;
            padding: 20px 24px;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 16px;
            margin-bottom: 24px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }
        
        .filter-item {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .filter-item label {
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            white-space: nowrap;
            letter-spacing: 0.2px;
        }
        
        .filter-select {
            padding: 10px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
            background: white;
            color: #374151;
            min-width: 140px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .filter-select:focus {
            border-color: var(--primary-green);
            outline: none;
            box-shadow: 0 0 0 3px rgba(46, 204, 113, 0.1);
        }
        
        .filter-reset-btn {
            padding: 10px 20px;
            background: #6b7280;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            letter-spacing: 0.2px;
        }
        
        .filter-reset-btn:hover {
            background: #4b5563;
            transform: translateY(-1px);
        }
        
        .card-body {
            padding: 20px 24px;
            border-bottom: 1px solid #f8fafc;
        }
        
        .status-section {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }
        
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            border-radius: 16px;
            font-size: 13px;
            font-weight: 500;
            letter-spacing: 0.1px;
            background: #f8fafc;
            color: #475569;
            border: 1px solid #e2e8f0;
        }
        
        .status-badge .status-icon {
            font-size: 14px;
        }
        
        /* 通过图标颜色区分不同状态 */
        .status-waiting .status-icon {
            color: #f59e0b;
        }
        
        .status-matched .status-icon {
            color: #10b981;
        }
        
        .status-notified .status-icon {
            color: #3b82f6;
        }
        
        .status-viewed .status-icon {
            color: #8b5cf6;
        }
        
        .status-converted .status-icon {
            color: #059669;
        }
        
        .status-expired .status-icon {
            color: #ef4444;
        }
        
        .deadline-info {
            text-align: right;
        }
        
        .deadline-label {
            display: block;
            font-size: 12px;
            color: #6b7280;
            font-weight: 500;
            margin-bottom: 4px;
        }
        
        .deadline-date {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #374151;
        }
        
        .deadline-info.urgent .deadline-date {
            color: #dc2626;
        }
        
        .deadline-info.expired .deadline-date {
            color: #6b7280;
            text-decoration: line-through;
        }
        
        .deadline-warning {
            display: block;
            font-size: 12px;
            color: #dc2626;
            font-weight: 700;
            margin-top: 4px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .subscription-summary {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: #f8fafc;
            border-radius: 12px;
            margin-bottom: 16px;
        }
        
        .summary-text {
            font-size: 14px;
            font-weight: 500;
            color: #374151;
        }
        
        .details-toggle {
            background: none;
            border: none;
            color: var(--primary-green);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 6px;
            transition: all 0.2s ease;
        }
        
        .details-toggle:hover {
            background: rgba(46, 204, 113, 0.1);
        }
        
        .subscription-details {
            background: #f9fafb;
            border-radius: 12px;
            padding: 16px;
            margin-top: 12px;
        }
        
        .detail-item {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .detail-item:last-child {
            border-bottom: none;
        }
        
        .detail-label {
            font-size: 13px;
            color: #6b7280;
            font-weight: 500;
        }
        
        .detail-value {
            font-size: 13px;
            color: #374151;
            font-weight: 600;
        }
        
        .card-actions {
            padding: 20px 24px;
            background: #fafbfc;
            border-top: 1px solid #f1f5f9;
            display: flex;
            gap: 12px;
            align-items: center;
            justify-content: flex-start;
        }
        
        .btn-primary {
            background: var(--primary-green);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            letter-spacing: 0.2px;
        }
        
        .btn-primary:hover {
            background: var(--dark-green);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(46, 204, 113, 0.3);
        }
        
        .btn-secondary {
            background: #f8fafc;
            color: #374151;
            border: 2px solid #e5e7eb;
            padding: 10px 20px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            letter-spacing: 0.2px;
        }
        
        .btn-secondary:hover {
            background: #e5e7eb;
            border-color: #d1d5db;
            transform: translateY(-1px);
        }
        
        .btn-danger {
            background: #fee2e2;
            color: #dc2626;
            border: 2px solid #fecaca;
            padding: 10px 20px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            letter-spacing: 0.2px;
        }
        
        .btn-danger:hover {
            background: #fecaca;
            border-color: #f87171;
            transform: translateY(-1px);
        }
        
        /* 统一的功能按钮样式 - 小巧圆角描边设计 */
        .card-actions button {
            background: transparent;
            border: 1.5px solid #e2e8f0;
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            letter-spacing: 0.1px;
        }
        
        .card-actions button:hover {
            background: #f8fafc;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        /* 跳转选课 - 绿色 */
        .btn-primary-action {
            color: #059669 !important;
            border-color: #d1fae5 !important;
        }
        
        .btn-primary-action:hover {
            color: #047857 !important;
            border-color: #a7f3d0 !important;
            background: #f0fdf4 !important;
        }
        
        /* 编辑条件 - 灰色 */
        .btn-edit {
            color: #6b7280 !important;
            border-color: #e5e7eb !important;
        }
        
        .btn-edit:hover {
            color: #4b5563 !important;
            border-color: #d1d5db !important;
            background: #f9fafb !important;
        }
        
        /* 查看匹配课程 - 蓝色 */
        .btn-view {
            color: #2563eb !important;
            border-color: #dbeafe !important;
        }
        
        .btn-view:hover {
            color: #1d4ed8 !important;
            border-color: #bfdbfe !important;
            background: #eff6ff !important;
        }
        
        /* 续期 - 橘色 */
        .btn-renew {
            color: #ea580c !important;
            border-color: #fed7aa !important;
        }
        
        .btn-renew:hover {
            color: #c2410c !important;
            border-color: #fdba74 !important;
            background: #fff7ed !important;
        }
        
        /* 取消订阅 - 红色 */
        .btn-destructive {
            color: #dc2626 !important;
            border-color: #fecaca !important;
        }
        
        .btn-destructive:hover {
            color: #b91c1c !important;
            border-color: #fca5a5 !important;
            background: #fef2f2 !important;
        }
        
        .completion-note {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #059669;
            font-weight: 600;
            font-size: 14px;
        }
        
        .completion-icon {
            font-size: 16px;
        }
        
        /* 订阅类型样式 - 升级版 */
        .subscription-type-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 11px;
            font-weight: 500;
            letter-spacing: 0.2px;
            background: #f8fafc;
            color: #64748b;
            border: 1px solid #e2e8f0;
        }
        
        .type-product {
            background: #eff6ff;
            color: #1e40af;
            border-color: #c7d2fe;
        }
        
        .type-home {
            background: #fff7ed;
            color: #c2410c;
            border-color: #fed7aa;
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .subscription-cards-container {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .subscription-center-container {
                padding: 16px;
            }
            
            .card-header,
            .card-body,
            .card-actions {
                padding-left: 16px;
                padding-right: 16px;
            }
            
            .course-title {
                font-size: 20px;
            }
            
            .course-subtitle {
                font-size: 14px;
            }
            
            .card-actions {
                flex-direction: column;
            }
            
            .card-actions button {
                width: 100%;
                justify-content: center;
            }
        }
        

        

        
        .page-header {
            padding: 20px 0 24px 0;
            border-bottom: 1px solid #e1e5e9;
            margin-bottom: 24px;
        }
        
        .page-header h1 {
            margin: 0 0 8px 0;
            font-size: 28px;
            font-weight: var(--font-weight-bold);
            color: var(--text-primary);
        }
        
        .page-subtitle {
            margin: 0;
            font-size: var(--font-size-base);
            color: var(--text-secondary);
            line-height: 1.5;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .back-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: white;
            border: 1px solid #e1e5e9;
            border-radius: 6px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: var(--font-size-sm);
        }
        
        .back-btn:hover {
            background: var(--bg-secondary);
            border-color: var(--primary-blue);
            color: var(--primary-blue);
        }
        
        /* Tab导航样式 */
        .analysis-tab-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 24px;
            overflow: hidden;
        }
        
        .analysis-tab-nav {
            display: flex;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-bottom: 1px solid #e1e5e9;
        }
        
        .analysis-tab-btn {
            flex: 1;
            padding: 16px 20px;
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-medium);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            border-bottom: 3px solid transparent;
        }
        
        .analysis-tab-btn:hover {
            background: rgba(0, 123, 255, 0.1);
            color: var(--primary-blue);
        }
        
        .analysis-tab-btn.active {
            background: white;
            color: var(--primary-blue);
            border-bottom-color: var(--primary-blue);
            box-shadow: 0 -2px 8px rgba(0, 123, 255, 0.2);
        }
        
        .analysis-tab-btn:not(:last-child) {
            border-right: 1px solid #e1e5e9;
        }
        
        /* Tab内容区域样式 */
        .analysis-content-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            min-height: 500px;
        }
        
        .analysis-tab-content {
            display: none;
            padding: 32px;
        }
        
        .analysis-tab-content.active {
            display: block;
        }
        
        .content-placeholder {
            text-align: center;
            padding: 80px 20px;
            color: var(--text-secondary);
        }
        
        .content-placeholder h3 {
            margin-bottom: 16px;
            color: var(--text-primary);
            font-size: 24px;
            font-weight: var(--font-weight-semibold);
        }
        
        .content-placeholder p {
            font-size: var(--font-size-base);
            line-height: 1.6;
            max-width: 600px;
            margin: 0 auto;
        }
        
        /* 功能栏按钮样式 */
        .function-left {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .function-right {
            display: flex;
            align-items: center;
        }
        
        .btn-primary, .btn-secondary {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: var(--primary-blue);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-blue-dark);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
        }
        
        .search-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .search-input {
            padding: 8px 12px;
            border: 1px solid #e1e5e9;
            border-radius: 6px;
            font-size: var(--font-size-sm);
            min-width: 250px;
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }
        
        .search-btn {
            padding: 8px 12px;
            background: var(--primary-blue);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .search-btn:hover {
            background: var(--primary-blue-dark);
        }
        
        /* 分页样式 */
        .pagination-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            padding: 16px 0;
            border-top: 1px solid #f1f3f5;
        }
        
        .pagination-info {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
        }
        
        .pagination-controls {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .pagination-btn {
            padding: 6px 12px;
            background: white;
            border: 1px solid #e1e5e9;
            border-radius: 4px;
            cursor: pointer;
            font-size: var(--font-size-sm);
            transition: all 0.2s ease;
        }
        
        .pagination-btn:not(:disabled):hover {
            background: var(--bg-secondary);
            border-color: var(--primary-blue);
        }
        
        .pagination-btn:disabled {
            cursor: not-allowed;
            opacity: 0.5;
        }
        
        .pagination-current {
            padding: 6px 12px;
            background: var(--primary-blue);
            color: white;
            border-radius: 4px;
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
        }
        
        .section-description {
            font-size: var(--font-size-sm);
            color: var(--text-hint);
            margin: 6px 0 16px 0;
            line-height: 1.4;
            padding: 10px;
            background: #e8f5e8;
            border-left: 4px solid var(--primary-green);
            border-radius: 4px;
        }
        
        .unified-card, .course-list-card {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
        }
        
        .unified-title, .list-title {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-bold);
            color: var(--text-primary);
            margin: 0 0 6px 0;
        }
        
        .unified-description {
            font-size: var(--font-size-sm);
            color: var(--text-hint);
            margin: 0 0 12px 0;
            line-height: 1.4;
        }
        
        /* 课程项目样式 */
        .course-item {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 8px;
            transition: all 0.2s ease;
        }
        
        .course-item:hover {
            border-color: var(--primary-green);
            box-shadow: 0 2px 4px rgba(50, 205, 50, 0.1);
        }
        
        .course-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .course-name {
            font-size: var(--font-size-md);
            font-weight: var(--font-weight-medium);
            color: var(--text-primary);
        }
        
        .course-status {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .status-label {
            font-size: var(--font-size-sm);
            color: var(--text-muted);
            padding: 4px 8px;
            background: #e9ecef;
            border-radius: 4px;
        }
        
        .status-label.active {
            background: var(--primary-green);
            color: white;
        }
        
        .toggle-btn {
            background: var(--primary-green);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: var(--font-size-sm);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .toggle-btn:hover {
            background: var(--hover-green);
        }
        
        .toggle-btn.secondary {
            background: #6c757d;
        }
        
        .toggle-btn.secondary:hover {
            background: #5a6268;
        }
        
        /* 独立设置表单样式 */
        .individual-form {
            background: #f8f9fa;
            border-top: 1px solid #e9ecef;
            padding: 16px;
            margin-top: 12px;
            border-radius: 0 0 6px 6px;
            display: none;
        }
        
        .individual-form.show {
            display: block;
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                max-height: 0;
                padding-top: 0;
                padding-bottom: 0;
            }
            to {
                opacity: 1;
                max-height: 800px;
                padding-top: 16px;
                padding-bottom: 16px;
            }
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .modal-content {
                width: 98%;
                margin: 10px auto;
                max-height: calc(100vh - 20px);
            }
            
            .info-header, .batch-info-header {
                grid-template-columns: 1fr;
                gap: 12px;
                padding: 12px;
            }
            
            .modal-body {
                padding: 12px;
            }
            
            .form-grid {
                gap: 12px;
            }
            
            .form-field {
                padding: 8px 12px;
                gap: 8px;
            }
            
            .field-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 6px;
            }
            
            .field-title-group {
                flex-direction: column;
                align-items: flex-start;
                gap: 4px;
            }
            
            .switch-wrapper {
                align-self: flex-end;
            }
            
            .date-range-wrapper {
                flex-direction: column;
                gap: 6px;
            }
            
            .date-separator {
                align-self: center;
                display: none;
            }
            
            .combo-input {
                flex-wrap: wrap;
                gap: 6px;
            }
            
            .modal-footer {
                padding: 16px;
                flex-direction: column;
                gap: 8px;
            }
            
            .btn {
                width: 100%;
            }
        }
        
        .content-area {
            flex: 1;
            padding: 0;
        }
        
        .top-navigation {
            display: flex;
            background: white;
            border-bottom: 1px solid #ddd;
        }
        
        .nav-tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            background: white;
            border-right: 1px solid #ddd;
            cursor: pointer;
            color: #666;
            font-weight: 500;
        }
        
        .nav-tab:last-child {
            border-right: none;
        }
        
        .nav-tab:hover, .nav-tab.active {
            background: var(--primary-green);
            color: white;
        }
        
        .container {
            max-width: none;
            margin: 0;
            background-color: white;
            padding: 30px;
            border-radius: 0;
            box-shadow: none;
        }
        
        h1 {
            color: var(--dark-green);
            text-align: center;
            border-bottom: 3px solid var(--primary-green);
            padding-bottom: 15px;
            margin-bottom: 30px;
            font-size: 2.2em;
        }
        
        h2 {
            color: #333;
            margin: 30px 0 20px 0;
            font-size: 1.5em;
        }
        .table-container {
            margin: 20px 0;
            overflow-x: auto;
            background: white;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .student-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        
        .student-table th {
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            padding: 12px 8px;
            text-align: center;
            font-weight: bold;
            color: #333;
            white-space: nowrap;
        }
        
        .student-table td {
            border: 1px solid #ddd;
            padding: 10px 8px;
            vertical-align: middle;
            color: #555;
            text-align: center;
        }
        
        .student-table tbody tr:hover {
            background-color: #f8f9fa;
        }
        
        .student-name {
            font-weight: bold;
            color: #333;
            white-space: nowrap;
        }
        
        .course-link {
            color: #1e90ff;
            text-decoration: underline;
            cursor: pointer;
        }
        
        .course-link:hover {
            color: #4169e1;
            text-decoration: none;
        }
        
        /* 课程单元格样式 */
        .course-cell {
            position: relative;
            padding: 10px 8px;
        }
        
        /* 课程订阅入口样式 - 文字版本 */
        .course-subscribe-btn {
            position: absolute;
            top: 2px;
            right: 2px;
            background: none;
            color: #ffa500;
            border: none;
            border-radius: 0;
            width: auto;
            height: auto;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            opacity: 1;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            padding: 1px 3px;
            line-height: 1;
        }
        
        /* 已订阅状态的文字 */
        .course-subscribe-btn.subscribed {
            color: #28a745;
            text-decoration: none;
            cursor: default;
            pointer-events: none;
        }
        
        /* 订阅文字始终可见，无需悬浮显示 */
        
        /* 订阅按钮悬浮效果 - 轻微放大和下划线 */
        .course-subscribe-btn:hover {
            transform: scale(1.1);
            text-decoration: underline;
        }
        
        /* 已订阅按钮不响应悬浮效果 */
        .course-subscribe-btn.subscribed:hover {
            transform: none;
            text-decoration: none;
        }
        
        /* 本校意向课程的订阅按钮 */
        .course-subscribe-btn.home-course {
            color: #ffa500;
            font-weight: bold;
        }
        
        .course-subscribe-btn.home-course:hover {
            transform: scale(1.1);
            text-decoration: underline;
        }
        
        /* 已订阅的本校课程按钮不响应悬浮效果 */
        .course-subscribe-btn.home-course.subscribed:hover {
            transform: none;
            text-decoration: none;
        }
        
        .course-subscribe-btn.home-course.subscribed {
            color: #28a745;
            cursor: default;
            pointer-events: none;
        }
        
        /* 确保课程链接文本不受影响 */
        .course-link {
            display: block;
            padding-right: 25px; /* 为订阅按钮留出空间 */
            line-height: 1.4;
        }
        
        /* 旧的订阅按钮样式保留以防其他地方使用 */
        .subscribe-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: var(--primary-green);
            color: white;
            border: none;
            border-radius: 15px;
            height: 24px;
            font-size: 11px;
            cursor: pointer;
            opacity: 0;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 8px;
            min-width: 20px;
            white-space: nowrap;
        }
        
        .subscribe-btn .btn-icon {
            display: inline-block;
        }
        
        .subscribe-btn .btn-text {
            display: none;
            margin-left: 4px;
            font-size: 10px;
        }
        
        .course-cell:hover .subscribe-btn {
            opacity: 1;
        }
        
        .course-cell:hover .subscribe-btn .btn-text {
            display: inline-block;
        }
        
        .subscribe-btn:hover {
            background: var(--hover-green);
            transform: scale(1.1);
        }
        
        .subscribe-btn.home-course {
            background: #007bff;
        }
        
        .subscribe-btn.home-course:hover {
            background: #0056b3;
            transform: scale(1.1);
        }
        
        .course-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .course-card {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .course-card:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        .course-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        .course-info {
            margin: 8px 0;
            color: #555;
        }
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .status.active {
            background-color: var(--primary-green);
            color: white;
        }
        .status.pending {
            background-color: #ffc107;
            color: #333;
        }
        .status.completed {
            background-color: #6c757d;
            color: white;
        }
        .subscription-form {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 4px;
            margin: 25px 0;
            border: 1px solid #ddd;
        }
        

        

        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .sub-content {
            display: block;
        }
        .form-group {
            margin-bottom: 18px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        input, select, textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-green);
        }
        button {
            background-color: var(--primary-green);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: var(--hover-green);
        }
        .footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
            color: #666;
        }
        
        .stats-number {
            font-size: 2em; 
            color: var(--primary-green); 
            text-align: center; 
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">🌱 LightCourseCRM</div>
        <div class="breadcrumb">客户关系管理系统 > 课程管理 > 课程订阅信息</div>
    </div>
    
    <div class="main-layout">
        <div class="content-area">
            <div class="top-navigation">
                <div class="nav-tab">大学中心</div>
                <div class="nav-tab">产品中心</div>
                <div class="nav-tab active">学生中心</div>
            </div>
            
            <div class="container">
                <div id="content-area">
                    <!-- 大学中心内容 -->
                    <div id="university-center" class="tab-content" style="display: none;">
                        <div class="university-layout">
                            <div class="university-sidebar">
                                <div class="sidebar-section">
                                    <div class="sidebar-title active" data-target="university-basic-info">大学基础信息</div>
                                </div>
                                <div class="sidebar-section">
                                    <div class="sidebar-title" data-target="university-course-library">课程库信息</div>
                                </div>
                            </div>
                            <div class="university-content">
                                <div id="university-basic-info" class="sub-content">
                                    <div class="university-table-container">
                                        <table class="university-table">
                                            <thead>
                                                <tr>
                                                    <th>School Name</th>
                                                    <th>Country</th>
                                                    <th>State / Province</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>The Pennsylvania State University Park</td>
                                                    <td>US</td>
                                                    <td>Pennsylvania</td>
                                                </tr>
                                                <tr>
                                                    <td>University of Illinois Urbana-Champaign</td>
                                                    <td>US</td>
                                                    <td>Illinois</td>
                                                </tr>
                                                <tr>
                                                    <td>University of Wisconsin-Madison</td>
                                                    <td>US</td>
                                                    <td>Wisconsin</td>
                                                </tr>
                                                <tr>
                                                    <td>San Francisco State University</td>
                                                    <td>US</td>
                                                    <td>California</td>
                                                </tr>
                                                <tr>
                                                    <td>University of Wisconsin-Green Bay</td>
                                                    <td>US</td>
                                                    <td>Wisconsin</td>
                                                </tr>
                                                <tr>
                                                    <td>Trine University</td>
                                                    <td>US</td>
                                                    <td>Indiana</td>
                                                </tr>
                                                <tr>
                                                    <td>Brookdale Community College</td>
                                                    <td>US</td>
                                                    <td>New Jersey</td>
                                                </tr>
                                                <tr>
                                                    <td>Arizona State University</td>
                                                    <td>US</td>
                                                    <td>Arizona</td>
                                                </tr>
                                                <tr>
                                                    <td>University of California, Davis</td>
                                                    <td>US</td>
                                                    <td>California</td>
                                                </tr>
                                                <tr>
                                                    <td>University of California, Los Angeles</td>
                                                    <td>US</td>
                                                    <td>California</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div id="university-course-library" class="sub-content" style="display: none;">
                                    <div class="university-table-container">
                                        <table class="university-table">
                                            <thead>
                                                <tr>
                                                    <th>School Name</th>
                                                    <th>Course Code</th>
                                                    <th>Course Name</th>
                                                    <th>Discipline</th>
                                                    <th>Credits</th>
                                                    <th>Course Description</th>
                                                    <th>Prerequisites</th>
                                                    <th>General Education Category</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>The Pennsylvania State University Park</td>
                                                    <td>MATH 240P</td>
                                                    <td>Multivariable Calculus</td>
                                                    <td>Mathematics</td>
                                                    <td>4</td>
                                                    <td>Vector calculus covering gradients, line integrals, and Green's Theorem.</td>
                                                    <td>MATH 141P</td>
                                                    <td>Quantitative Reasoning</td>
                                                </tr>
                                                <tr>
                                                    <td>The Pennsylvania State University Park</td>
                                                    <td>MATH 141P</td>
                                                    <td>Calculus II</td>
                                                    <td>Mathematics</td>
                                                    <td>4</td>
                                                    <td>Integral calculus with applications and series analysis.</td>
                                                    <td>MATH 140P</td>
                                                    <td>Quantitative Reasoning</td>
                                                </tr>
                                                <tr>
                                                    <td>The Pennsylvania State University Park</td>
                                                    <td>ECON 102P</td>
                                                    <td>Introductory Microeconomics</td>
                                                    <td>Economics</td>
                                                    <td>3</td>
                                                    <td>Consumer and firm decision-making with market analysis.</td>
                                                    <td>None</td>
                                                    <td>Social and Behavioral Sciences</td>
                                                </tr>
                                                <tr>
                                                    <td>The Pennsylvania State University Park</td>
                                                    <td>ECON 302P</td>
                                                    <td>Intermediate Microeconomic Analysis</td>
                                                    <td>Economics</td>
                                                    <td>3</td>
                                                    <td>Price theory with emphasis on optimization and welfare.</td>
                                                    <td>ECON 102P</td>
                                                    <td>Social and Behavioral Sciences</td>
                                                </tr>
                                                <tr>
                                                    <td>The Pennsylvania State University Park</td>
                                                    <td>PSYCH 100P</td>
                                                    <td>Introductory Psychology</td>
                                                    <td>Psychology</td>
                                                    <td>3</td>
                                                    <td>Survey of psychological science including cognition and behavior.</td>
                                                    <td>None</td>
                                                    <td>Social and Behavioral Sciences</td>
                                                </tr>
                                                <tr>
                                                    <td>The Pennsylvania State University Park</td>
                                                    <td>PSYCH 260P</td>
                                                    <td>Cognitive Psychology</td>
                                                    <td>Psychology</td>
                                                    <td>3</td>
                                                    <td>Information processing, attention, and memory research methods.</td>
                                                    <td>PSYCH 100P</td>
                                                    <td>Social and Behavioral Sciences</td>
                                                </tr>
                                                <tr>
                                                    <td>University of Illinois Urbana-Champaign</td>
                                                    <td>MATH 241U</td>
                                                    <td>Calculus III</td>
                                                    <td>Mathematics</td>
                                                    <td>4</td>
                                                    <td>Sequences, series, and multivariate calculus techniques.</td>
                                                    <td>MATH 231U</td>
                                                    <td>Quantitative Reasoning</td>
                                                </tr>
                                                <tr>
                                                    <td>University of Illinois Urbana-Champaign</td>
                                                    <td>MATH 231U</td>
                                                    <td>Calculus II</td>
                                                    <td>Mathematics</td>
                                                    <td>4</td>
                                                    <td>Integral calculus, applications, and introductory differential equations.</td>
                                                    <td>MATH 221U</td>
                                                    <td>Quantitative Reasoning</td>
                                                </tr>
                                                <tr>
                                                    <td>University of Illinois Urbana-Champaign</td>
                                                    <td>ECON 102U</td>
                                                    <td>Microeconomic Principles</td>
                                                    <td>Economics</td>
                                                    <td>3</td>
                                                    <td>Analysis of consumers, firms, and market structures.</td>
                                                    <td>None</td>
                                                    <td>Social and Behavioral Sciences</td>
                                                </tr>
                                                <tr>
                                                    <td>University of Illinois Urbana-Champaign</td>
                                                    <td>ECON 203U</td>
                                                    <td>Economic Statistics I</td>
                                                    <td>Economics</td>
                                                    <td>3</td>
                                                    <td>Probability, estimation, and inference for economic data.</td>
                                                    <td>MATH 231U</td>
                                                    <td>Statistics and Data Literacy</td>
                                                </tr>
                                                <tr>
                                                    <td>University of Illinois Urbana-Champaign</td>
                                                    <td>PSYC 100U</td>
                                                    <td>Introduction to Psychology</td>
                                                    <td>Psychology</td>
                                                    <td>3</td>
                                                    <td>Foundational perspectives on human thought and behavior.</td>
                                                    <td>None</td>
                                                    <td>Social and Behavioral Sciences</td>
                                                </tr>
                                                <tr>
                                                    <td>University of Illinois Urbana-Champaign</td>
                                                    <td>PSYC 238U</td>
                                                    <td>Abnormal Psychology</td>
                                                    <td>Psychology</td>
                                                    <td>3</td>
                                                    <td>Etiology and treatment of psychological disorders.</td>
                                                    <td>PSYC 100U</td>
                                                    <td>Social and Behavioral Sciences</td>
                                                </tr>
                                                <tr>
                                                    <td>University of Wisconsin-Madison</td>
                                                    <td>MATH 234W</td>
                                                    <td>Calculus-Functions of Several Variables</td>
                                                    <td>Mathematics</td>
                                                    <td>4</td>
                                                    <td>Differential and integral calculus for multivariable functions.</td>
                                                    <td>MATH 222W</td>
                                                    <td>Quantitative Reasoning</td>
                                                </tr>
                                                <tr>
                                                    <td>University of Wisconsin-Madison</td>
                                                    <td>MATH 222W</td>
                                                    <td>Calculus and Analytic Geometry II</td>
                                                    <td>Mathematics</td>
                                                    <td>4</td>
                                                    <td>Advanced integration techniques with series and polar coordinates.</td>
                                                    <td>MATH 221W</td>
                                                    <td>Quantitative Reasoning</td>
                                                </tr>
                                                <tr>
                                                    <td>University of Wisconsin-Madison</td>
                                                    <td>ECON 101W</td>
                                                    <td>Principles of Microeconomics</td>
                                                    <td>Economics</td>
                                                    <td>4</td>
                                                    <td>Market behavior, elasticity, and government intervention.</td>
                                                    <td>None</td>
                                                    <td>Social and Behavioral Sciences</td>
                                                </tr>
                                                <tr>
                                                    <td>University of Wisconsin-Madison</td>
                                                    <td>ECON 301W</td>
                                                    <td>Intermediate Microeconomics</td>
                                                    <td>Economics</td>
                                                    <td>3</td>
                                                    <td>Consumer theory, producer theory, and market equilibrium models.</td>
                                                    <td>ECON 101W</td>
                                                    <td>Social and Behavioral Sciences</td>
                                                </tr>
                                                <tr>
                                                    <td>University of Wisconsin-Madison</td>
                                                    <td>PSYCH 202W</td>
                                                    <td>Introduction to Psychology</td>
                                                    <td>Psychology</td>
                                                    <td>3</td>
                                                    <td>Overview of research areas such as cognition and personality.</td>
                                                    <td>None</td>
                                                    <td>Social and Behavioral Sciences</td>
                                                </tr>
                                                <tr>
                                                    <td>University of Wisconsin-Madison</td>
                                                    <td>PSYCH 225W</td>
                                                    <td>Cognition</td>
                                                    <td>Psychology</td>
                                                    <td>3</td>
                                                    <td>Attention, language, and decision-making processes.</td>
                                                    <td>PSYCH 202W</td>
                                                    <td>Social and Behavioral Sciences</td>
                                                </tr>
                                                <tr>
                                                    <td>San Francisco State University</td>
                                                    <td>MATH 226S</td>
                                                    <td>Calculus I</td>
                                                    <td>Mathematics</td>
                                                    <td>4</td>
                                                    <td>Limits, derivatives, and applications to optimization.</td>
                                                    <td>Pre-Calculus</td>
                                                    <td>Quantitative Reasoning</td>
                                                </tr>
                                                <tr>
                                                    <td>San Francisco State University</td>
                                                    <td>MATH 227S</td>
                                                    <td>Calculus II</td>
                                                    <td>Mathematics</td>
                                                    <td>4</td>
                                                    <td>Integral calculus techniques with series and parametric curves.</td>
                                                    <td>MATH 226S</td>
                                                    <td>Quantitative Reasoning</td>
                                                </tr>
                                                <tr>
                                                    <td>San Francisco State University</td>
                                                    <td>ECON 101S</td>
                                                    <td>Introduction to Microeconomic Analysis</td>
                                                    <td>Economics</td>
                                                    <td>3</td>
                                                    <td>Decision-making by households and firms in various markets.</td>
                                                    <td>None</td>
                                                    <td>Social and Behavioral Sciences</td>
                                                </tr>
                                                <tr>
                                                    <td>San Francisco State University</td>
                                                    <td>ECON 301S</td>
                                                    <td>Intermediate Microeconomic Theory</td>
                                                    <td>Economics</td>
                                                    <td>3</td>
                                                    <td>Game theory, externalities, and welfare implications.</td>
                                                    <td>ECON 101S</td>
                                                    <td>Social and Behavioral Sciences</td>
                                                </tr>
                                                <tr>
                                                    <td>San Francisco State University</td>
                                                    <td>PSY 200S</td>
                                                    <td>General Psychology</td>
                                                    <td>Psychology</td>
                                                    <td>3</td>
                                                    <td>Introduction to core psychological concepts and methods.</td>
                                                    <td>None</td>
                                                    <td>Social and Behavioral Sciences</td>
                                                </tr>
                                                <tr>
                                                    <td>San Francisco State University</td>
                                                    <td>PSY 451S</td>
                                                    <td>Theories of Personality</td>
                                                    <td>Psychology</td>
                                                    <td>3</td>
                                                    <td>Comparative study of major personality theories.</td>
                                                    <td>PSY 200S</td>
                                                    <td>Social and Behavioral Sciences</td>
                                                </tr>
                                                <tr>
                                                    <td>University of Wisconsin-Green Bay</td>
                                                    <td>MATH 209G</td>
                                                    <td>Calculus and Analytical Geometry I</td>
                                                    <td>Mathematics</td>
                                                    <td>4</td>
                                                    <td>Differential calculus with geometric interpretation.</td>
                                                    <td>Pre-Calculus</td>
                                                    <td>Quantitative Reasoning</td>
                                                </tr>
                                                <tr>
                                                    <td>University of Wisconsin-Green Bay</td>
                                                    <td>MATH 260G</td>
                                                    <td>Multivariable Calculus</td>
                                                    <td>Mathematics</td>
                                                    <td>4</td>
                                                    <td>Partial derivatives and multiple integrals with applications.</td>
                                                    <td>MATH 230G</td>
                                                    <td>Quantitative Reasoning</td>
                                                </tr>
                                                <tr>
                                                    <td>University of Wisconsin-Green Bay</td>
                                                    <td>ECON 202G</td>
                                                    <td>Macro Economic Analysis</td>
                                                    <td>Economics</td>
                                                    <td>3</td>
                                                    <td>National income, inflation, unemployment, and policy tools.</td>
                                                    <td>ECON 201G</td>
                                                    <td>Social and Behavioral Sciences</td>
                                                </tr>
                                                <tr>
                                                    <td>University of Wisconsin-Green Bay</td>
                                                    <td>ECON 302G</td>
                                                    <td>Intermediate Microeconomics</td>
                                                    <td>Economics</td>
                                                    <td>3</td>
                                                    <td>Analytical models of consumers, producers, and markets.</td>
                                                    <td>ECON 202G</td>
                                                    <td>Social and Behavioral Sciences</td>
                                                </tr>
                                                <tr>
                                                    <td>University of Wisconsin-Green Bay</td>
                                                    <td>PSYCH 203G</td>
                                                    <td>Foundations of Psychology</td>
                                                    <td>Psychology</td>
                                                    <td>3</td>
                                                    <td>Scientific study of behavior and mental processes.</td>
                                                    <td>None</td>
                                                    <td>Social and Behavioral Sciences</td>
                                                </tr>
                                                <tr>
                                                    <td>University of Wisconsin-Green Bay</td>
                                                    <td>PSYCH 440G</td>
                                                    <td>Physiological Psychology</td>
                                                    <td>Psychology</td>
                                                    <td>3</td>
                                                    <td>Biological bases of behavior and neural mechanisms.</td>
                                                    <td>PSYCH 203G</td>
                                                    <td>Natural Sciences</td>
                                                </tr>
                                                <tr>
                                                    <td>Trine University</td>
                                                    <td>MA 232T</td>
                                                    <td>Calculus II</td>
                                                    <td>Mathematics</td>
                                                    <td>4</td>
                                                    <td>Techniques of integration and sequences with engineering focus.</td>
                                                    <td>MA 131T</td>
                                                    <td>Quantitative Reasoning</td>
                                                </tr>
                                                <tr>
                                                    <td>Trine University</td>
                                                    <td>MA 233T</td>
                                                    <td>Calculus III</td>
                                                    <td>Mathematics</td>
                                                    <td>4</td>
                                                    <td>Vector calculus, line integrals, and surface integrals.</td>
                                                    <td>MA 232T</td>
                                                    <td>Quantitative Reasoning</td>
                                                </tr>
                                                <tr>
                                                    <td>Trine University</td>
                                                    <td>ECO 213T</td>
                                                    <td>Microeconomics</td>
                                                    <td>Economics</td>
                                                    <td>3</td>
                                                    <td>Demand, supply, and market efficiency analysis.</td>
                                                    <td>None</td>
                                                    <td>Social and Behavioral Sciences</td>
                                                </tr>
                                                <tr>
                                                    <td>Trine University</td>
                                                    <td>ECO 453T</td>
                                                    <td>International Economics</td>
                                                    <td>Economics</td>
                                                    <td>3</td>
                                                    <td>Trade theories, exchange rates, and global policy issues.</td>
                                                    <td>ECO 213T</td>
                                                    <td>Global Perspectives</td>
                                                </tr>
                                                <tr>
                                                    <td>Trine University</td>
                                                    <td>PSY 113T</td>
                                                    <td>Principles of Psychology</td>
                                                    <td>Psychology</td>
                                                    <td>3</td>
                                                    <td>Fundamental concepts in perception, learning, and development.</td>
                                                    <td>None</td>
                                                    <td>Social and Behavioral Sciences</td>
                                                </tr>
                                                <tr>
                                                    <td>Trine University</td>
                                                    <td>PSY 333T</td>
                                                    <td>Psychology of Learning</td>
                                                    <td>Psychology</td>
                                                    <td>3</td>
                                                    <td>Classical and operant conditioning with cognitive extensions.</td>
                                                    <td>PSY 113T</td>
                                                    <td>Social and Behavioral Sciences</td>
                                                </tr>
                                                <tr>
                                                    <td>Brookdale Community College</td>
                                                    <td>MATH 171B</td>
                                                    <td>Calculus I</td>
                                                    <td>Mathematics</td>
                                                    <td>4</td>
                                                    <td>Differential calculus for science and engineering majors.</td>
                                                    <td>Pre-Calculus</td>
                                                    <td>Quantitative Reasoning</td>
                                                </tr>
                                                <tr>
                                                    <td>Brookdale Community College</td>
                                                    <td>MATH 172B</td>
                                                    <td>Calculus II</td>
                                                    <td>Mathematics</td>
                                                    <td>4</td>
                                                    <td>Integral calculus with series and applications.</td>
                                                    <td>MATH 171B</td>
                                                    <td>Quantitative Reasoning</td>
                                                </tr>
                                                <tr>
                                                    <td>Brookdale Community College</td>
                                                    <td>ECON 105B</td>
                                                    <td>Principles of Microeconomics</td>
                                                    <td>Economics</td>
                                                    <td>3</td>
                                                    <td>Market structures, consumer theory, and government policy.</td>
                                                    <td>None</td>
                                                    <td>Social and Behavioral Sciences</td>
                                                </tr>
                                                <tr>
                                                    <td>Brookdale Community College</td>
                                                    <td>ECON 225B</td>
                                                    <td>Macroeconomics</td>
                                                    <td>Economics</td>
                                                    <td>3</td>
                                                    <td>GDP, monetary policy, and economic growth models.</td>
                                                    <td>ECON 105B</td>
                                                    <td>Social and Behavioral Sciences</td>
                                                </tr>
                                                <tr>
                                                    <td>Brookdale Community College</td>
                                                    <td>PSYC 105B</td>
                                                    <td>Introduction to Psychology</td>
                                                    <td>Psychology</td>
                                                    <td>3</td>
                                                    <td>Foundational survey of behavioral and cognitive science.</td>
                                                    <td>None</td>
                                                    <td>Social and Behavioral Sciences</td>
                                                </tr>
                                                <tr>
                                                    <td>Brookdale Community College</td>
                                                    <td>PSYC 215B</td>
                                                    <td>Lifespan Development</td>
                                                    <td>Psychology</td>
                                                    <td>3</td>
                                                    <td>Physical, cognitive, and social development across the lifespan.</td>
                                                    <td>PSYC 105B</td>
                                                    <td>Social and Behavioral Sciences</td>
                                                </tr>
                                                <tr>
                                                    <td>Arizona State University</td>
                                                    <td>MAT 265A</td>
                                                    <td>Calculus for Engineers I</td>
                                                    <td>Mathematics</td>
                                                    <td>3</td>
                                                    <td>Differential calculus emphasizing engineering applications.</td>
                                                    <td>MAT 170A</td>
                                                    <td>Quantitative Reasoning</td>
                                                </tr>
                                                <tr>
                                                    <td>Arizona State University</td>
                                                    <td>MAT 266A</td>
                                                    <td>Calculus for Engineers II</td>
                                                    <td>Mathematics</td>
                                                    <td>3</td>
                                                    <td>Integral calculus, series, and Laplace transforms for engineers.</td>
                                                    <td>MAT 265A</td>
                                                    <td>Quantitative Reasoning</td>
                                                </tr>
                                                <tr>
                                                    <td>Arizona State University</td>
                                                    <td>ECN 211A</td>
                                                    <td>Macroeconomic Principles</td>
                                                    <td>Economics</td>
                                                    <td>3</td>
                                                    <td>Aggregate economic activity, fiscal, and monetary policy.</td>
                                                    <td>None</td>
                                                    <td>Social and Behavioral Sciences</td>
                                                </tr>
                                                <tr>
                                                    <td>Arizona State University</td>
                                                    <td>ECN 312A</td>
                                                    <td>Intermediate Microeconomic Theory</td>
                                                    <td>Economics</td>
                                                    <td>3</td>
                                                    <td>Consumer and producer theory with competitive analysis.</td>
                                                    <td>ECN 211A</td>
                                                    <td>Social and Behavioral Sciences</td>
                                                </tr>
                                                <tr>
                                                    <td>Arizona State University</td>
                                                    <td>PSY 101A</td>
                                                    <td>Introduction to Psychology</td>
                                                    <td>Psychology</td>
                                                    <td>3</td>
                                                    <td>Behavioral, biological, and cognitive foundations of psychology.</td>
                                                    <td>None</td>
                                                    <td>Social and Behavioral Sciences</td>
                                                </tr>
                                                <tr>
                                                    <td>Arizona State University</td>
                                                    <td>PSY 230A</td>
                                                    <td>Introductory Statistics for Psychology</td>
                                                    <td>Psychology</td>
                                                    <td>3</td>
                                                    <td>Quantitative methods for psychological research.</td>
                                                    <td>PSY 101A</td>
                                                    <td>Statistics and Data Literacy</td>
                                                </tr>
                                                <tr>
                                                    <td>University of California, Davis</td>
                                                    <td>MAT 21A D</td>
                                                    <td>Differential Calculus</td>
                                                    <td>Mathematics</td>
                                                    <td>4</td>
                                                    <td>Differentiation techniques with scientific applications.</td>
                                                    <td>Pre-Calculus</td>
                                                    <td>Quantitative Reasoning</td>
                                                </tr>
                                                <tr>
                                                    <td>University of California, Davis</td>
                                                    <td>MAT 21B D</td>
                                                    <td>Integral Calculus</td>
                                                    <td>Mathematics</td>
                                                    <td>4</td>
                                                    <td>Integration, sequences, and series for physical sciences.</td>
                                                    <td>MAT 21A D</td>
                                                    <td>Quantitative Reasoning</td>
                                                </tr>
                                                <tr>
                                                    <td>University of California, Davis</td>
                                                    <td>ECN 1A D</td>
                                                    <td>Principles of Microeconomics</td>
                                                    <td>Economics</td>
                                                    <td>4</td>
                                                    <td>Consumer behavior, production, and market equilibrium.</td>
                                                    <td>None</td>
                                                    <td>Social and Behavioral Sciences</td>
                                                </tr>
                                                <tr>
                                                    <td>University of California, Davis</td>
                                                    <td>ECN 102 D</td>
                                                    <td>Analysis of Microeconomic Data</td>
                                                    <td>Economics</td>
                                                    <td>4</td>
                                                    <td>Empirical tools for microeconomic research and policy.</td>
                                                    <td>ECN 1A D</td>
                                                    <td>Statistics and Data Literacy</td>
                                                </tr>
                                                <tr>
                                                    <td>University of California, Davis</td>
                                                    <td>PSC 1 D</td>
                                                    <td>General Psychology</td>
                                                    <td>Psychology</td>
                                                    <td>4</td>
                                                    <td>Comprehensive overview of psychological science.</td>
                                                    <td>None</td>
                                                    <td>Social and Behavioral Sciences</td>
                                                </tr>
                                                <tr>
                                                    <td>University of California, Davis</td>
                                                    <td>PSC 121 D</td>
                                                    <td>Human Emotion</td>
                                                    <td>Psychology</td>
                                                    <td>4</td>
                                                    <td>Physiological and cognitive aspects of emotion.</td>
                                                    <td>PSC 1 D</td>
                                                    <td>Social and Behavioral Sciences</td>
                                                </tr>
                                                <tr>
                                                    <td>University of California, Los Angeles</td>
                                                    <td>MATH 31A L</td>
                                                    <td>Differential and Integral Calculus</td>
                                                    <td>Mathematics</td>
                                                    <td>4</td>
                                                    <td>Limits, derivatives, integrals, and applications.</td>
                                                    <td>Pre-Calculus</td>
                                                    <td>Quantitative Reasoning</td>
                                                </tr>
                                                <tr>
                                                    <td>University of California, Los Angeles</td>
                                                    <td>MATH 31B L</td>
                                                    <td>Integration and Infinite Series</td>
                                                    <td>Mathematics</td>
                                                    <td>4</td>
                                                    <td>Integral applications, sequences, and series for engineers.</td>
                                                    <td>MATH 31A L</td>
                                                    <td>Quantitative Reasoning</td>
                                                </tr>
                                                <tr>
                                                    <td>University of California, Los Angeles</td>
                                                    <td>ECON 11 L</td>
                                                    <td>Microeconomic Theory</td>
                                                    <td>Economics</td>
                                                    <td>4</td>
                                                    <td>Foundations of consumer and producer theory.</td>
                                                    <td>None</td>
                                                    <td>Social and Behavioral Sciences</td>
                                                </tr>
                                                <tr>
                                                    <td>University of California, Los Angeles</td>
                                                    <td>ECON 101 L</td>
                                                    <td>Price Theory</td>
                                                    <td>Economics</td>
                                                    <td>4</td>
                                                    <td>Advanced topics in market equilibrium and welfare analysis.</td>
                                                    <td>ECON 11 L</td>
                                                    <td>Social and Behavioral Sciences</td>
                                                </tr>
                                                <tr>
                                                    <td>University of California, Los Angeles</td>
                                                    <td>PSYCH 10 L</td>
                                                    <td>Introduction to Behavioral Science</td>
                                                    <td>Psychology</td>
                                                    <td>4</td>
                                                    <td>Survey of psychological theories with research emphasis.</td>
                                                    <td>None</td>
                                                    <td>Social and Behavioral Sciences</td>
                                                </tr>
                                                <tr>
                                                    <td>University of California, Los Angeles</td>
                                                    <td>PSYCH 115 L</td>
                                                    <td>Principles of Behavioral Neuroscience</td>
                                                    <td>Psychology</td>
                                                    <td>4</td>
                                                    <td>Neural mechanisms underlying behavior and cognition.</td>
                                                    <td>PSYCH 10 L</td>
                                                    <td>Natural Sciences</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 产品中心内容 -->
                    <div id="product-center" class="tab-content" style="display: none;">
                        <div class="product-layout">
                            <div class="product-sidebar">
                                <div class="sidebar-section">
                                    <div class="sidebar-title active" data-target="product-unit-management">课程单元管理</div>
                                </div>
                                <div class="sidebar-section">
                                    <div class="sidebar-title" data-target="product-course-mapping">课程对应信息</div>
                                </div>
                            </div>
                            <div class="product-content">
                                <div id="product-unit-management" class="sub-content">
                                    <div class="product-table-container">
                                        <table class="product-table">
                                            <thead>
                                                <tr>
                                                    <th>Course Price</th>
                                                    <th>School Name</th>
                                                    <th>Course Code</th>
                                                    <th>Course Name</th>
                                                    <th>Credits</th>
                                                    <th>Prerequisites</th>
                                                    <th>Start Date</th>
                                                    <th>End Date</th>
                                                    <th>Seats Remaining</th>
                                                    <th>Course Duration</th>
                                                    <th>Course Modality</th>
                                                    <th>Academic Term</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>1480美元</td>
                                                    <td>San Francisco State University</td>
                                                    <td>MATH 226S</td>
                                                    <td>Calculus I</td>
                                                    <td>4</td>
                                                    <td>Pre-Calculus</td>
                                                    <td>2025-08-26</td>
                                                    <td>2025-12-10</td>
                                                    <td>35</td>
                                                    <td>16周</td>
                                                    <td>On Campus</td>
                                                    <td>2025-2026(Fall)</td>
                                                </tr>
                                                <tr>
                                                    <td>1520美元</td>
                                                    <td>San Francisco State University</td>
                                                    <td>MATH 227S</td>
                                                    <td>Calculus II</td>
                                                    <td>4</td>
                                                    <td>MATH 226S</td>
                                                    <td>2026-01-16</td>
                                                    <td>2026-05-05</td>
                                                    <td>28</td>
                                                    <td>16周</td>
                                                    <td>Hybrid</td>
                                                    <td>2025-2026(Spring)</td>
                                                </tr>
                                                <tr>
                                                    <td>1180美元</td>
                                                    <td>San Francisco State University</td>
                                                    <td>ECON 101S</td>
                                                    <td>Introduction to Microeconomic Analysis</td>
                                                    <td>3</td>
                                                    <td>None</td>
                                                    <td>2025-09-02</td>
                                                    <td>2025-12-05</td>
                                                    <td>40</td>
                                                    <td>15周</td>
                                                    <td>Asynchronous</td>
                                                    <td>2025-2026(Fall)</td>
                                                </tr>
                                                <tr>
                                                    <td>1290美元</td>
                                                    <td>San Francisco State University</td>
                                                    <td>ECON 301S</td>
                                                    <td>Intermediate Microeconomic Theory</td>
                                                    <td>3</td>
                                                    <td>ECON 101S</td>
                                                    <td>2026-03-04</td>
                                                    <td>2026-05-28</td>
                                                    <td>22</td>
                                                    <td>12周</td>
                                                    <td>Synchronous</td>
                                                    <td>2025-2026(Spring)</td>
                                                </tr>
                                                <tr>
                                                    <td>980美元</td>
                                                    <td>San Francisco State University</td>
                                                    <td>PSY 200S</td>
                                                    <td>General Psychology</td>
                                                    <td>3</td>
                                                    <td>None</td>
                                                    <td>2025-10-07</td>
                                                    <td>2025-12-19</td>
                                                    <td>30</td>
                                                    <td>10周</td>
                                                    <td>Asynchronous</td>
                                                    <td>2025-2026(Fall)</td>
                                                </tr>
                                                <tr>
                                                    <td>1030美元</td>
                                                    <td>San Francisco State University</td>
                                                    <td>PSY 451S</td>
                                                    <td>Theories of Personality</td>
                                                    <td>3</td>
                                                    <td>PSY 200S</td>
                                                    <td>2026-02-10</td>
                                                    <td>2026-04-22</td>
                                                    <td>18</td>
                                                    <td>10周</td>
                                                    <td>Synchronous</td>
                                                    <td>2025-2026(Spring)</td>
                                                </tr>
                                                <tr>
                                                    <td>1420美元</td>
                                                    <td>University of Wisconsin-Green Bay</td>
                                                    <td>MATH 209G</td>
                                                    <td>Calculus and Analytical Geometry I</td>
                                                    <td>4</td>
                                                    <td>Pre-Calculus</td>
                                                    <td>2025-09-03</td>
                                                    <td>2025-12-12</td>
                                                    <td>32</td>
                                                    <td>15周</td>
                                                    <td>On Campus</td>
                                                    <td>2025-2026(Fall)</td>
                                                </tr>
                                                <tr>
                                                    <td>1470美元</td>
                                                    <td>University of Wisconsin-Green Bay</td>
                                                    <td>MATH 260G</td>
                                                    <td>Multivariable Calculus</td>
                                                    <td>4</td>
                                                    <td>MATH 230G</td>
                                                    <td>2026-01-22</td>
                                                    <td>2026-05-06</td>
                                                    <td>24</td>
                                                    <td>15周</td>
                                                    <td>Hybrid</td>
                                                    <td>2025-2026(Spring)</td>
                                                </tr>
                                                <tr>
                                                    <td>1120美元</td>
                                                    <td>University of Wisconsin-Green Bay</td>
                                                    <td>ECON 202G</td>
                                                    <td>Macro Economic Analysis</td>
                                                    <td>3</td>
                                                    <td>ECON 201G</td>
                                                    <td>2025-10-01</td>
                                                    <td>2025-12-17</td>
                                                    <td>27</td>
                                                    <td>11周</td>
                                                    <td>Asynchronous</td>
                                                    <td>2025-2026(Fall)</td>
                                                </tr>
                                                <tr>
                                                    <td>1240美元</td>
                                                    <td>University of Wisconsin-Green Bay</td>
                                                    <td>ECON 302G</td>
                                                    <td>Intermediate Microeconomics</td>
                                                    <td>3</td>
                                                    <td>ECON 202G</td>
                                                    <td>2026-02-03</td>
                                                    <td>2026-04-30</td>
                                                    <td>20</td>
                                                    <td>12周</td>
                                                    <td>Synchronous</td>
                                                    <td>2025-2026(Spring)</td>
                                                </tr>
                                                <tr>
                                                    <td>960美元</td>
                                                    <td>University of Wisconsin-Green Bay</td>
                                                    <td>PSYCH 203G</td>
                                                    <td>Foundations of Psychology</td>
                                                    <td>3</td>
                                                    <td>None</td>
                                                    <td>2025-09-16</td>
                                                    <td>2025-12-02</td>
                                                    <td>38</td>
                                                    <td>12周</td>
                                                    <td>Asynchronous</td>
                                                    <td>2025-2026(Fall)</td>
                                                </tr>
                                                <tr>
                                                    <td>1080美元</td>
                                                    <td>University of Wisconsin-Green Bay</td>
                                                    <td>PSYCH 440G</td>
                                                    <td>Physiological Psychology</td>
                                                    <td>3</td>
                                                    <td>PSYCH 203G</td>
                                                    <td>2026-01-29</td>
                                                    <td>2026-04-16</td>
                                                    <td>16</td>
                                                    <td>10周</td>
                                                    <td>Hybrid</td>
                                                    <td>2025-2026(Spring)</td>
                                                </tr>
                                                <tr>
                                                    <td>1360美元</td>
                                                    <td>Trine University</td>
                                                    <td>MA 232T</td>
                                                    <td>Calculus II</td>
                                                    <td>4</td>
                                                    <td>MA 131T</td>
                                                    <td>2025-08-25</td>
                                                    <td>2025-12-08</td>
                                                    <td>26</td>
                                                    <td>15周</td>
                                                    <td>On Campus</td>
                                                    <td>2025-2026(Fall)</td>
                                                </tr>
                                                <tr>
                                                    <td>1410美元</td>
                                                    <td>Trine University</td>
                                                    <td>MA 233T</td>
                                                    <td>Calculus III</td>
                                                    <td>4</td>
                                                    <td>MA 232T</td>
                                                    <td>2026-01-09</td>
                                                    <td>2026-04-26</td>
                                                    <td>21</td>
                                                    <td>14周</td>
                                                    <td>Synchronous</td>
                                                    <td>2025-2026(Spring)</td>
                                                </tr>
                                                <tr>
                                                    <td>1150美元</td>
                                                    <td>Trine University</td>
                                                    <td>ECO 213T</td>
                                                    <td>Microeconomics</td>
                                                    <td>3</td>
                                                    <td>None</td>
                                                    <td>2025-09-01</td>
                                                    <td>2025-11-24</td>
                                                    <td>34</td>
                                                    <td>12周</td>
                                                    <td>Hybrid</td>
                                                    <td>2025-2026(Fall)</td>
                                                </tr>
                                                <tr>
                                                    <td>1280美元</td>
                                                    <td>Trine University</td>
                                                    <td>ECO 453T</td>
                                                    <td>International Economics</td>
                                                    <td>3</td>
                                                    <td>ECO 213T</td>
                                                    <td>2026-02-17</td>
                                                    <td>2026-05-12</td>
                                                    <td>19</td>
                                                    <td>12周</td>
                                                    <td>Asynchronous</td>
                                                    <td>2025-2026(Spring)</td>
                                                </tr>
                                                <tr>
                                                    <td>920美元</td>
                                                    <td>Trine University</td>
                                                    <td>PSY 113T</td>
                                                    <td>Principles of Psychology</td>
                                                    <td>3</td>
                                                    <td>None</td>
                                                    <td>2025-10-06</td>
                                                    <td>2025-12-15</td>
                                                    <td>37</td>
                                                    <td>10周</td>
                                                    <td>Asynchronous</td>
                                                    <td>2025-2026(Fall)</td>
                                                </tr>
                                                <tr>
                                                    <td>1010美元</td>
                                                    <td>Trine University</td>
                                                    <td>PSY 333T</td>
                                                    <td>Psychology of Learning</td>
                                                    <td>3</td>
                                                    <td>PSY 113T</td>
                                                    <td>2026-01-27</td>
                                                    <td>2026-04-08</td>
                                                    <td>17</td>
                                                    <td>10周</td>
                                                    <td>Synchronous</td>
                                                    <td>2025-2026(Spring)</td>
                                                </tr>
                                                <tr>
                                                    <td>1320美元</td>
                                                    <td>Brookdale Community College</td>
                                                    <td>MATH 171B</td>
                                                    <td>Calculus I</td>
                                                    <td>4</td>
                                                    <td>Pre-Calculus</td>
                                                    <td>2025-09-04</td>
                                                    <td>2025-12-11</td>
                                                    <td>29</td>
                                                    <td>14周</td>
                                                    <td>On Campus</td>
                                                    <td>2025-2026(Fall)</td>
                                                </tr>
                                                <tr>
                                                    <td>1340美元</td>
                                                    <td>Brookdale Community College</td>
                                                    <td>MATH 172B</td>
                                                    <td>Calculus II</td>
                                                    <td>4</td>
                                                    <td>MATH 171B</td>
                                                    <td>2026-01-18</td>
                                                    <td>2026-04-29</td>
                                                    <td>24</td>
                                                    <td>14周</td>
                                                    <td>Hybrid</td>
                                                    <td>2025-2026(Spring)</td>
                                                </tr>
                                                <tr>
                                                    <td>970美元</td>
                                                    <td>Brookdale Community College</td>
                                                    <td>ECON 105B</td>
                                                    <td>Principles of Microeconomics</td>
                                                    <td>3</td>
                                                    <td>None</td>
                                                    <td>2025-09-10</td>
                                                    <td>2025-12-03</td>
                                                    <td>41</td>
                                                    <td>12周</td>
                                                    <td>Asynchronous</td>
                                                    <td>2025-2026(Fall)</td>
                                                </tr>
                                                <tr>
                                                    <td>1040美元</td>
                                                    <td>Brookdale Community College</td>
                                                    <td>ECON 225B</td>
                                                    <td>Macroeconomics</td>
                                                    <td>3</td>
                                                    <td>ECON 105B</td>
                                                    <td>2026-02-05</td>
                                                    <td>2026-04-30</td>
                                                    <td>23</td>
                                                    <td>12周</td>
                                                    <td>Synchronous</td>
                                                    <td>2025-2026(Spring)</td>
                                                </tr>
                                                <tr>
                                                    <td>880美元</td>
                                                    <td>Brookdale Community College</td>
                                                    <td>PSYC 105B</td>
                                                    <td>Introduction to Psychology</td>
                                                    <td>3</td>
                                                    <td>None</td>
                                                    <td>2025-10-01</td>
                                                    <td>2025-12-17</td>
                                                    <td>36</td>
                                                    <td>11周</td>
                                                    <td>Asynchronous</td>
                                                    <td>2025-2026(Fall)</td>
                                                </tr>
                                                <tr>
                                                    <td>930美元</td>
                                                    <td>Brookdale Community College</td>
                                                    <td>PSYC 215B</td>
                                                    <td>Lifespan Development</td>
                                                    <td>3</td>
                                                    <td>PSYC 105B</td>
                                                    <td>2026-01-29</td>
                                                    <td>2026-04-21</td>
                                                    <td>20</td>
                                                    <td>10周</td>
                                                    <td>Hybrid</td>
                                                    <td>2025-2026(Spring)</td>
                                                </tr>
                                                <tr>
                                                    <td>1490美元</td>
                                                    <td>Arizona State University</td>
                                                    <td>MAT 265A</td>
                                                    <td>Calculus for Engineers I</td>
                                                    <td>3</td>
                                                    <td>MAT 170A</td>
                                                    <td>2025-08-19</td>
                                                    <td>2025-12-03</td>
                                                    <td>44</td>
                                                    <td>16周</td>
                                                    <td>Hybrid</td>
                                                    <td>2025-2026(Fall)</td>
                                                </tr>
                                                <tr>
                                                    <td>1530美元</td>
                                                    <td>Arizona State University</td>
                                                    <td>MAT 266A</td>
                                                    <td>Calculus for Engineers II</td>
                                                    <td>3</td>
                                                    <td>MAT 265A</td>
                                                    <td>2026-01-13</td>
                                                    <td>2026-05-01</td>
                                                    <td>31</td>
                                                    <td>16周</td>
                                                    <td>On Campus</td>
                                                    <td>2025-2026(Spring)</td>
                                                </tr>
                                                <tr>
                                                    <td>1125美元</td>
                                                    <td>Arizona State University</td>
                                                    <td>ECN 211A</td>
                                                    <td>Macroeconomic Principles</td>
                                                    <td>3</td>
                                                    <td>None</td>
                                                    <td>2025-09-01</td>
                                                    <td>2025-12-09</td>
                                                    <td>48</td>
                                                    <td>15周</td>
                                                    <td>Asynchronous</td>
                                                    <td>2025-2026(Fall)</td>
                                                </tr>
                                                <tr>
                                                    <td>1260美元</td>
                                                    <td>Arizona State University</td>
                                                    <td>ECN 312A</td>
                                                    <td>Intermediate Microeconomic Theory</td>
                                                    <td>3</td>
                                                    <td>ECN 211A</td>
                                                    <td>2026-02-03</td>
                                                    <td>2026-04-28</td>
                                                    <td>26</td>
                                                    <td>12周</td>
                                                    <td>Synchronous</td>
                                                    <td>2025-2026(Spring)</td>
                                                </tr>
                                                <tr>
                                                    <td>985美元</td>
                                                    <td>Arizona State University</td>
                                                    <td>PSY 101A</td>
                                                    <td>Introduction to Psychology</td>
                                                    <td>3</td>
                                                    <td>None</td>
                                                    <td>2025-10-06</td>
                                                    <td>2025-12-18</td>
                                                    <td>42</td>
                                                    <td>10周</td>
                                                    <td>Asynchronous</td>
                                                    <td>2025-2026(Fall)</td>
                                                </tr>
                                                <tr>
                                                    <td>1095美元</td>
                                                    <td>Arizona State University</td>
                                                    <td>PSY 230A</td>
                                                    <td>Introductory Statistics for Psychology</td>
                                                    <td>3</td>
                                                    <td>PSY 101A</td>
                                                    <td>2026-01-27</td>
                                                    <td>2026-04-13</td>
                                                    <td>25</td>
                                                    <td>11周</td>
                                                    <td>Hybrid</td>
                                                    <td>2025-2026(Spring)</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div id="product-course-mapping" class="sub-content" style="display: none;">
                                    <div class="product-table-container">
                                        <table class="product-table">
                                            <thead>
                                                <tr>
                                                    <th colspan="4">学生学校课程信息</th>
                                                    <th colspan="3">产品学校课程信息</th>
                                                    <th colspan="2">对应详情</th>
                                                </tr>
                                                <tr>
                                                    <th>School Name</th>
                                                    <th>Course Code</th>
                                                    <th>Course Name</th>
                                                    <th>General Education Category</th>
                                                    <th>Product School</th>
                                                    <th>Product Course Code</th>
                                                    <th>Product Course Name</th>
                                                    <th>Alignment Status</th>
                                                    <th>Verification Outcome</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>The Pennsylvania State University Park</td>
                                                    <td>MATH 240P</td>
                                                    <td>Multivariable Calculus</td>
                                                    <td>Quantitative Reasoning</td>
                                                    <td>San Francisco State University</td>
                                                    <td>MATH 227S</td>
                                                    <td>Calculus II</td>
                                                    <td>对应</td>
                                                    <td>认证成功 (5)</td>
                                                </tr>
                                                <tr>
                                                    <td>The Pennsylvania State University Park</td>
                                                    <td>ECON 302P</td>
                                                    <td>Intermediate Microeconomic Analysis</td>
                                                    <td>Social and Behavioral Sciences</td>
                                                    <td>University of Wisconsin-Green Bay</td>
                                                    <td>ECON 302G</td>
                                                    <td>Intermediate Microeconomics</td>
                                                    <td>对应</td>
                                                    <td>认证成功 (3)</td>
                                                </tr>
                                                <tr>
                                                    <td>The Pennsylvania State University Park</td>
                                                    <td>PSYCH 260P</td>
                                                    <td>Cognitive Psychology</td>
                                                    <td>Social and Behavioral Sciences</td>
                                                    <td>Arizona State University</td>
                                                    <td>PSY 230A</td>
                                                    <td>Introductory Statistics for Psychology</td>
                                                    <td>不对应</td>
                                                    <td>认证失败 (2)</td>
                                                </tr>
                                                <tr>
                                                    <td>University of Illinois Urbana-Champaign</td>
                                                    <td>MATH 241U</td>
                                                    <td>Calculus III</td>
                                                    <td>Quantitative Reasoning</td>
                                                    <td>Trine University</td>
                                                    <td>MA 233T</td>
                                                    <td>Calculus III</td>
                                                    <td>对应</td>
                                                    <td>认证成功 (4)</td>
                                                </tr>
                                                <tr>
                                                    <td>University of Illinois Urbana-Champaign</td>
                                                    <td>ECON 203U</td>
                                                    <td>Economic Statistics I</td>
                                                    <td>Statistics and Data Literacy</td>
                                                    <td>Brookdale Community College</td>
                                                    <td>ECON 225B</td>
                                                    <td>Macroeconomics</td>
                                                    <td>不对应</td>
                                                    <td>认证失败 (1)</td>
                                                </tr>
                                                <tr>
                                                    <td>University of Illinois Urbana-Champaign</td>
                                                    <td>PSYC 238U</td>
                                                    <td>Abnormal Psychology</td>
                                                    <td>Social and Behavioral Sciences</td>
                                                    <td>Arizona State University</td>
                                                    <td>PSY 101A</td>
                                                    <td>Introduction to Psychology</td>
                                                    <td>对应</td>
                                                    <td>认证成功 (6)</td>
                                                </tr>
                                                <tr>
                                                    <td>University of Wisconsin-Madison</td>
                                                    <td>MATH 234W</td>
                                                    <td>Calculus-Functions of Several Variables</td>
                                                    <td>Quantitative Reasoning</td>
                                                    <td>Arizona State University</td>
                                                    <td>MAT 266A</td>
                                                    <td>Calculus for Engineers II</td>
                                                    <td>对应</td>
                                                    <td>认证成功 (5)</td>
                                                </tr>
                                                <tr>
                                                    <td>University of Wisconsin-Madison</td>
                                                    <td>ECON 301W</td>
                                                    <td>Intermediate Microeconomics</td>
                                                    <td>Social and Behavioral Sciences</td>
                                                    <td>Trine University</td>
                                                    <td>ECO 453T</td>
                                                    <td>International Economics</td>
                                                    <td>不对应</td>
                                                    <td>认证失败 (3)</td>
                                                </tr>
                                                <tr>
                                                    <td>University of Wisconsin-Madison</td>
                                                    <td>PSYCH 225W</td>
                                                    <td>Cognition</td>
                                                    <td>Social and Behavioral Sciences</td>
                                                    <td>San Francisco State University</td>
                                                    <td>PSY 451S</td>
                                                    <td>Theories of Personality</td>
                                                    <td>不对应</td>
                                                    <td>认证失败 (2)</td>
                                                </tr>
                                                <tr>
                                                    <td>University of California, Davis</td>
                                                    <td>MAT 21B D</td>
                                                    <td>Integral Calculus</td>
                                                    <td>Quantitative Reasoning</td>
                                                    <td>Brookdale Community College</td>
                                                    <td>MATH 172B</td>
                                                    <td>Calculus II</td>
                                                    <td>对应</td>
                                                    <td>认证成功 (7)</td>
                                                </tr>
                                                <tr>
                                                    <td>University of California, Davis</td>
                                                    <td>ECN 102 D</td>
                                                    <td>Analysis of Microeconomic Data</td>
                                                    <td>Statistics and Data Literacy</td>
                                                    <td>San Francisco State University</td>
                                                    <td>ECON 301S</td>
                                                    <td>Intermediate Microeconomic Theory</td>
                                                    <td>对应</td>
                                                    <td>认证成功 (4)</td>
                                                </tr>
                                                <tr>
                                                    <td rowspan="2">University of California, Davis</td>
                                                    <td rowspan="2">PSC 1 D</td>
                                                    <td rowspan="2">General Psychology</td>
                                                    <td rowspan="2">Social and Behavioral Sciences</td>
                                                    <td>Arizona State University</td>
                                                    <td>PSY 101A</td>
                                                    <td>Introduction to Psychology</td>
                                                    <td>对应</td>
                                                    <td>认证成功 (8)</td>
                                                </tr>
                                                <tr>
                                                    <td>San Francisco State University</td>
                                                    <td>PSY 200S</td>
                                                    <td>General Psychology</td>
                                                    <td>对应</td>
                                                    <td>认证成功 (5)</td>
                                                </tr>
                                                <tr>
                                                    <td rowspan="2">University of California, Los Angeles</td>
                                                    <td rowspan="2">MATH 31B L</td>
                                                    <td rowspan="2">Integration and Infinite Series</td>
                                                    <td rowspan="2">Quantitative Reasoning</td>
                                                    <td>University of Wisconsin-Green Bay</td>
                                                    <td>MATH 260G</td>
                                                    <td>Multivariable Calculus</td>
                                                    <td>对应</td>
                                                    <td>认证成功 (6)</td>
                                                </tr>
                                                <tr>
                                                    <td>Arizona State University</td>
                                                    <td>MAT 266A</td>
                                                    <td>Calculus for Engineers II</td>
                                                    <td>对应</td>
                                                    <td>认证成功 (4)</td>
                                                </tr>
                                                <tr>
                                                    <td>University of California, Los Angeles</td>
                                                    <td>ECON 101 L</td>
                                                    <td>Price Theory</td>
                                                    <td>Social and Behavioral Sciences</td>
                                                    <td>Arizona State University</td>
                                                    <td>ECN 312A</td>
                                                    <td>Intermediate Microeconomic Theory</td>
                                                    <td>对应</td>
                                                    <td>认证成功 (5)</td>
                                                </tr>
                                                <tr>
                                                    <td>University of California, Los Angeles</td>
                                                    <td>PSYCH 115 L</td>
                                                    <td>Principles of Behavioral Neuroscience</td>
                                                    <td>Natural Sciences</td>
                                                    <td>University of Wisconsin-Green Bay</td>
                                                    <td>PSYCH 440G</td>
                                                    <td>Physiological Psychology</td>
                                                    <td>对应</td>
                                                    <td>认证成功 (6)</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 学生中心内容 -->
                    <div id="student-center" class="tab-content">
                        <div class="student-layout">
                            <!-- 学生中心的左侧边栏 -->
                            <div class="student-sidebar">
                                <div class="sidebar-section">
                                    <div class="sidebar-title active" data-target="student-service">学生服务</div>
                                </div>
                                
                                <div class="sidebar-section">
                                    <div class="sidebar-title" data-target="student-follow">学生跟进LC</div>
                                </div>
                            </div>
                            
                            <!-- 学生中心的主内容区 -->
                            <div class="student-content">
                                
                                <!-- 学生服务内容 -->
                                <div id="student-service" class="sub-content">
                                    <!-- 功能栏 -->
                                    <div class="function-bar">
                                        <div class="batch-subscribe-dropdown" id="batchSubscribeDropdown">
                                            <button class="function-btn batch-subscribe-btn" id="batchSubscribeBtn" disabled>
                                                <span class="btn-icon">🔔</span>
                                                <span class="btn-text">批量订阅</span>
                                                <span class="dropdown-arrow">▼</span>
                                            </button>
                                            <div class="dropdown-menu" id="dropdownMenu">
                                                <button class="dropdown-item" data-type="home">
                                                    <span class="btn-icon">📋</span>
                                                    <span class="btn-text">订阅本校课程</span>
                                                </button>
                                                <button class="dropdown-item" data-type="product">
                                                    <span class="btn-icon">🔔</span>
                                                    <span class="btn-text">订阅产品课程</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="table-container">
                                        <table class="student-table">
                                            <thead>
                                                <tr>
                                                    <th>选择</th>
                                                    <th>学生姓名</th>
                                                    <th>学生学校</th>
                                                    <th>本校意向课程</th>
                                                    <th>已选课程</th>
                                                    <th>上课形式</th>
                                                    <th>学习周期</th>
                                                    <th>班级代码</th>
                                                    <th>状态</th>
                                                </tr>
                                            </thead>
                                            <tbody id="studentServiceTableBody"></tbody>
                                        </table>
                                    </div>
                        
                                </div>
                                
                                <!-- 学生跟进LC内容 -->
                                <div id="student-follow" class="sub-content" style="display: none;">
                                    <div class="page-header">
                                        <h1>学生跟进LC管理</h1>
                                        <p class="page-subtitle">管理学生跟进状态、查看学生报告和订阅信息</p>
                                    </div>
                                    
                                    <!-- 功能操作栏 -->
                                    <div class="function-bar">
                                        <div class="function-left">
                                            <button class="btn-primary" onclick="addStudent()">
                                                <span>➕</span>
                                                <span class="btn-text">新增学生</span>
                                            </button>
                                            <button class="btn-secondary" onclick="exportStudents()">
                                                <span>📊</span>
                                                <span class="btn-text">导出数据</span>
                                            </button>
                                            <button class="btn-secondary" onclick="refreshStudents()">
                                                <span>🔄</span>
                                                <span class="btn-text">刷新</span>
                                            </button>
                                        </div>
                                        
                                        <div class="function-right">
                                            <div class="search-container">
                                                <input type="text" id="studentSearch" placeholder="搜索学生姓名、学校或微信..." class="search-input">
                                                <button class="search-btn" onclick="searchStudents()">🔍</button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- 学生跟进数据表格 -->
                                    <div class="table-container">
                                        <table class="data-table student-follow-table">
                                            <thead>
                                                <tr>
                                                    <th class="checkbox-col">
                                                        <input type="checkbox" id="selectAllStudents" onchange="toggleAllStudents(this)">
                                                    </th>
                                                    <th class="student-name-col">学生姓名</th>
                                                    <th class="school-col">学生学校</th>
                                                    <th class="entry-time-col">流量进入时间</th>
                                                    <th class="next-follow-col">下次跟进时间</th>
                                                    <th class="status-col">跟进状态</th>
                                                    <th class="wechat-col">微信名称</th>
                                                    <th class="report-col">学生报告</th>
                                                    <th class="subscription-col">课程订阅</th>
                                                    <th class="action-col">操作</th>
                                                </tr>
                                            </thead>
                                            <tbody id="studentFollowTableBody"></tbody>
                                        </table>
                                    </div>
                                    
                                    <!-- 分页控件 -->
                                    <div class="pagination-container">
                                        <div class="pagination-info">
                                            共 5 条记录，第 1/1 页
                                        </div>
                                        <div class="pagination-controls">
                                            <button class="pagination-btn" disabled>上一页</button>
                                            <span class="pagination-current">1</span>
                                            <button class="pagination-btn" disabled>下一页</button>
                                        </div>
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 学生选课分析页面 -->
    <div id="student-analysis-page" class="page-container" style="display: none;">
        <div class="container">
            <!-- 页面头部 -->
            <div class="page-header">
                <div class="header-left">
                    <button class="back-btn" onclick="backToStudentFollow()">
                        <span>←</span>
                        <span>返回学生跟进</span>
                    </button>
                    <h1 id="student-analysis-title">学生选课分析</h1>
                    <p class="page-subtitle">查看学生详细档案、选课情况和分析报告</p>
                </div>
            </div>
            
            <!-- Tab导航栏 -->
            <div class="analysis-tab-container">
                <div class="analysis-tab-nav">
                    <button class="analysis-tab-btn active" data-target="student-profile">学生档案</button>
                    <button class="analysis-tab-btn" data-target="autonomous-selection">自主选课</button>
                    <button class="analysis-tab-btn" data-target="selected-courses">学生已选课程</button>
                    <button class="analysis-tab-btn" data-target="report-management">选课报告管理</button>
                    <button class="analysis-tab-btn" data-target="subscription-info">课程订阅中心</button>
                </div>
            </div>
            
            <!-- Tab内容区域 -->
            <div class="analysis-content-container">
                <!-- 学生档案 -->
                <div id="student-profile" class="analysis-tab-content active">
                    <div class="student-profile-form">
                        <form id="studentProfileForm">
                            <!-- 学生姓名 -->
                            <div class="profile-form-field">
                                <label for="studentName">学生姓名</label>
                                <input type="text" id="studentName" name="studentName" value="" disabled>
                            </div>
                            
                            <!-- 学生学校 -->
                            <div class="profile-form-field">
                                <label for="studentSchool">学生学校</label>
                                <input type="text" id="studentSchool" name="studentSchool" value="" disabled>
                            </div>
                            
                            <!-- 转学分需求 -->
                            <div class="profile-form-field">
                                <label>转学分需求</label>
                                <div class="profile-radio-group">
                                    <div class="profile-radio-option">
                                        <input type="radio" id="creditTransferYes" name="creditTransfer" value="yes" checked>
                                        <label for="creditTransferYes">是</label>
                                    </div>
                                    <div class="profile-radio-option">
                                        <input type="radio" id="creditTransferNo" name="creditTransfer" value="no">
                                        <label for="creditTransferNo">否</label>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 上课目的 -->
                            <div class="profile-form-field">
                                <label>上课目的</label>
                                <div class="profile-checkbox-group">
                                    <div class="profile-checkbox-option">
                                        <input type="checkbox" id="purposeGraduation" name="coursePurpose" value="graduation" checked>
                                        <label for="purposeGraduation">毕业</label>
                                    </div>
                                    <div class="profile-checkbox-option">
                                        <input type="checkbox" id="purposeTransfer" name="coursePurpose" value="transfer">
                                        <label for="purposeTransfer">转学</label>
                                    </div>
                                    <div class="profile-checkbox-option">
                                        <input type="checkbox" id="purposeGradSchool" name="coursePurpose" value="gradschool" checked>
                                        <label for="purposeGradSchool">申研</label>
                                    </div>
                                    <div class="profile-checkbox-option">
                                        <input type="checkbox" id="purposeStudyAbroad" name="coursePurpose" value="studyabroad">
                                        <label for="purposeStudyAbroad">游学</label>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 学生本校毕业要求 -->
                            <div class="profile-form-field">
                                <label for="graduationRequirements">学生本校毕业要求</label>
                                <div class="file-upload-area" onclick="document.getElementById('graduationReqFile').click()">
                                    <div class="file-upload-icon">📄</div>
                                    <div class="file-upload-text">将文件拖到此处，或点击上传</div>
                                    <div class="file-upload-hint">支持 PDF、Word、图片等格式，最大 10MB</div>
                                </div>
                                <input type="file" id="graduationReqFile" name="graduationReqFile" style="display: none;" multiple accept=".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif">
                                <div id="uploadedFiles" class="uploaded-files" style="display: none;">
                                    <!-- 已上传的文件将显示在这里 -->
                                </div>
                            </div>
                            
                            <!-- 提交按钮 -->
                            <button type="submit" class="profile-submit-btn">提交档案搜集</button>
                        </form>
                    </div>
                </div>
                
                <!-- 自主选课 -->
                <div id="autonomous-selection" class="analysis-tab-content">
                    <div class="autonomous-course-container">
                        <!-- 功能栏：批量订阅 -->
                        <div class="function-bar" style="margin-bottom: 16px; padding: 12px 16px; background: #f8f9fa; border-radius: 6px; border: 1px solid #e9ecef;">
                            <div class="batch-subscribe-section">
                                <button class="batch-subscribe-btn home-subscribe-btn" id="batchSubscribeHomeBtn" disabled>
                                    <span class="btn-icon">📋</span>
                                    <span class="btn-text">批量订阅</span>
                                </button>
                            </div>
                        </div>
                        
                        <table class="course-table-excel">
                            <thead>
                                <tr>
                                    <th>选择</th>
                                    <th>课程代码</th>
                                    <th>课程名称</th>
                                    <th>本校通识类别</th>
                                    <th>课程对应</th>
                                    <th>对应在售课程单元</th>
                                </tr>
                            </thead>
                            <tbody id="autonomousCourseTableBody"></tbody>
                        </table>
                    </div>
                </div>
                
                <!-- 学生已选课程 -->
                <div id="selected-courses" class="analysis-tab-content">
                    <div class="selected-courses-container">
                        <table class="selected-courses-table">
                            <thead>
                                <tr>
                                    <th>选择</th>
                                    <th>本校课程</th>
                                    <th>课程满足类别、场景</th>
                                    <th>当前状态</th>
                                    <th>审核状态</th>
                                    <th>产品课程</th>
                                    <th>产品学校</th>
                                    <th>上课日期</th>
                                    <th>价格</th>
                                    <th>班级代码</th>
                                    <th>课程时长</th>
                                </tr>
                            </thead>
                            <tbody id="selectedCoursesTableBody"></tbody>
                        </table>
                    </div>
                </div>
                
                <!-- 选课报告管理 -->
                <div id="report-management" class="analysis-tab-content">
                    <div class="report-management-container">
                        <div class="report-list-header">
                            <h3>选课报告管理</h3>
                            <p>生成、查看和管理学生的选课分析报告</p>
                        </div>
                        <div id="reportListContainer" class="report-card-list"></div>
                    </div>
                </div>
                
                <!-- 课程订阅中心 -->
                <div id="subscription-info" class="analysis-tab-content">
                    <div class="subscription-center-container">
                        <!-- 筛选条件区域 -->
                        <div class="subscription-filter-area">
                            <div class="filter-item">
                                <label for="subscription-type-filter">订阅类型：</label>
                                <select id="subscription-type-filter" class="filter-select" onchange="filterCards()">
                                    <option value="">全部</option>
                                    <option value="product">产品课程</option>
                                    <option value="home">本校课程</option>
                                </select>
                            </div>
                            <div class="filter-item">
                                <label for="status-filter">当前状态：</label>
                                <select id="status-filter" class="filter-select" onchange="filterCards()">
                                    <option value="">全部</option>
                                    <option value="waiting">等待上架</option>
                                    <option value="matched">已匹配</option>
                                    <option value="notified">已通知</option>
                                    <option value="viewed">已查看</option>
                                    <option value="converted">已转化</option>
                                    <option value="expired">已过期</option>
                                </select>
                            </div>
                            <div class="filter-item">
                                <label for="deadline-sort">截止日期排序：</label>
                                <select id="deadline-sort" class="filter-select" onchange="sortCardsByDeadline()">
                                    <option value="">默认</option>
                                    <option value="asc">升序 (最近的在前)</option>
                                    <option value="desc">降序 (最远的在前)</option>
                                </select>
                            </div>
                            <button class="filter-reset-btn" onclick="resetSubscriptionFilters()">重置</button>
                        </div>
                        
                        <div class="subscription-cards-container" id="subscriptionCardsContainer"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 单门课程订阅方式选择模态框 -->
    <div id="singleCourseModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 650px;">
            <div class="modal-header product-course">
                <h3 id="singleCourseModalTitle">请选择订阅方式</h3>
                <button class="modal-close" onclick="closeSingleCourseModal()">&times;</button>
            </div>
            
            <div class="modal-body">
                <!-- 课程信息显示区 -->
                <div class="course-info-display" id="courseInfoDisplay">
                    <div class="info-row-horizontal">
                        <div class="info-item">
                            <label class="info-label">学生姓名</label>
                            <div class="info-value readonly-field" id="singleStudentName">-</div>
                        </div>
                        <div class="info-item">
                            <label class="info-label">订阅课程</label>
                            <div class="info-value readonly-field" id="singleCourseName">-</div>
                        </div>
                    </div>
                </div>
                
                <!-- 订阅方式选择 -->
                <div class="subscription-options">
                    <div class="option-card selected" data-option="direct">
                        <div class="option-header">
                            <input type="radio" name="subscribeOption" value="direct" id="directSubscription" checked>
                            <label for="directSubscription" class="option-title">直接订阅</label>
                        </div>
                        <p class="option-description">系统将在所有关联课程可售时通知您，无需设置额外条件</p>
                    </div>
                    
                    <div class="option-card" data-option="custom">
                        <div class="option-header">
                            <input type="radio" name="subscribeOption" value="custom" id="customSubscription">
                            <label for="customSubscription" class="option-title">个性化订阅</label>
                        </div>
                        <p class="option-description">您可以根据学期、开课日期、上课形式等设置个性化订阅条件，系统仅在满足订阅条件时通知您</p>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-cancel" onclick="closeSingleCourseModal()">取消</button>
                <button type="button" class="btn btn-save" id="confirmSelectionBtn">确认</button>
            </div>
        </div>
    </div>

    <!-- 订阅条件模态框 -->
    <div id="subscribeModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">课程订阅条件设置</h3>
                <button class="modal-close" onclick="closeSubscribeModal()">&times;</button>
            </div>
            
            <div class="modal-body">
                <!-- 单门课程模式：顶部信息区 -->
                <div class="info-header" id="singleCourseInfo">
                    <div class="info-item">
                        <label class="info-label">学生姓名</label>
                        <div class="info-value" id="studentNameField">-</div>
                    </div>
                    <div class="info-item">
                        <label class="info-label">订阅课程</label>
                        <div class="info-value" id="selectedCoursesField">-</div>
                    </div>
                </div>
                
                <!-- 批量课程模式：信息区和统一设置区 -->
                <div class="batch-unified-section" id="batchUnifiedSection" style="display: none;">
                    <!-- 批量模式的顶部信息区 -->
                    <div class="batch-info-header">
                        <div class="info-item">
                            <label class="info-label">学生姓名</label>
                            <div class="info-value" id="batchStudentNameField">-</div>
                        </div>
                        <div class="info-item course-list-item">
                            <label class="info-label" id="batchCoursesTitle">订阅课程</label>
                            <div class="info-value course-list-container">
                                <div class="course-list-scroll" id="batchSelectedCoursesField">
                                    <!-- 课程列表将通过JavaScript动态生成 -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <form id="subscribeForm">
                    <!-- 订阅条件设置 -->
                    <div class="form-section">
                        <h3 class="section-title" id="formSectionTitle">订阅条件设置</h3>
                        <p class="section-description" id="formSectionDescription" style="display: none;">为所有选中的课程设置统一的订阅条件，您也可以滑到底部，为单门课程进行个性化调整</p>
                        
                        <div class="form-grid">
                            <!-- 学年季度 -->
                            <div class="form-field">
                                <div class="field-left">
                                    <div class="field-header">
                                        <div class="field-title-group">
                                            <label class="field-label">学年季度</label>
                                            <span class="field-hint">选择您期望上课的学期</span>
                                        </div>
                                        <div class="switch-wrapper">
                                            <span class="switch-label">必须满足</span>
                                            <label class="switch">
                                                <input type="checkbox" name="semesterRequired">
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="field-control">
                                        <select name="semester" class="form-select">
                                            <option value="">请选择学期</option>
                                            <option value="2025-2026-Fall">2025-2026 Fall</option>
                                            <option value="2025-2026-Winter">2025-2026 Winter</option>
                                            <option value="2025-2026-Summer">2025-2026 Summer</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 开课日期 -->
                            <div class="form-field">
                                <div class="field-left">
                                    <div class="field-header">
                                        <div class="field-title-group">
                                            <label class="field-label">开课日期</label>
                                            <span class="field-hint">课程开始日期的可接受范围</span>
                                        </div>
                                        <div class="switch-wrapper">
                                            <span class="switch-label">必须满足</span>
                                            <label class="switch">
                                                <input type="checkbox" name="dateRequired">
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="field-control">
                                        <div class="date-range-wrapper">
                                            <input type="date" id="startDate" name="startDate" class="form-input date-input">
                                            <span class="date-separator">至</span>
                                            <input type="date" id="endDate" name="endDate" class="form-input date-input">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 上课形式 -->
                            <div class="form-field">
                                <div class="field-left">
                                    <div class="field-header">
                                        <div class="field-title-group">
                                            <label class="field-label">上课形式</label>
                                            <span class="field-hint">选择您偏好的上课形式</span>
                                        </div>
                                        <div class="switch-wrapper">
                                            <span class="switch-label">必须满足</span>
                                            <label class="switch">
                                                <input type="checkbox" name="formatRequired">
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="field-control">
                                        <select name="format" class="form-select">
                                            <option value="">请选择上课形式</option>
                                            <option value="online-live">线上直播</option>
                                            <option value="online-recorded">线上非直播</option>
                                            <option value="offline">线下</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 课程时长 -->
                            <div class="form-field">
                                <div class="field-left">
                                    <div class="field-header">
                                        <div class="field-title-group">
                                            <label class="field-label">课程时长</label>
                                            <span class="field-hint">课程时长的可接受条件</span>
                                        </div>
                                        <div class="switch-wrapper">
                                            <span class="switch-label">必须满足</span>
                                            <label class="switch">
                                                <input type="checkbox" name="durationRequired">
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="field-control">
                                        <div class="combo-input">
                                            <select name="durationOperator" class="combo-select">
                                                <option value="equal">等于</option>
                                                <option value="gte">大于等于</option>
                                                <option value="lte">小于等于</option>
                                            </select>
                                            <input type="number" id="duration" name="duration" min="1" max="52" class="form-input combo-number">
                                            <span class="combo-unit">周</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 学分数量 -->
                            <div class="form-field">
                                <div class="field-left">
                                    <div class="field-header">
                                        <div class="field-title-group">
                                            <label class="field-label">学分数量</label>
                                            <span class="field-hint">课程的学分值要求</span>
                                        </div>
                                        <div class="switch-wrapper">
                                            <span class="switch-label">必须满足</span>
                                            <label class="switch">
                                                <input type="checkbox" name="creditsRequired">
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="field-control">
                                        <div class="combo-input">
                                            <select name="creditsOperator" class="combo-select">
                                                <option value="equal">等于</option>
                                                <option value="gte">大于等于</option>
                                                <option value="lte">小于等于</option>
                                            </select>
                                            <input type="number" id="credits" name="credits" min="1" max="10" class="form-input combo-number">
                                            <span class="combo-unit">学分</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 课程价格 -->
                            <div class="form-field">
                                <div class="field-left">
                                    <div class="field-header">
                                        <div class="field-title-group">
                                            <label class="field-label">课程价格</label>
                                            <span class="field-hint">可接受的最高课程价格</span>
                                        </div>
                                        <div class="switch-wrapper">
                                            <span class="switch-label">必须满足</span>
                                            <label class="switch">
                                                <input type="checkbox" name="priceRequired">
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="field-control">
                                        <div class="combo-input">
                                            <select name="priceOperator" class="combo-select">
                                                <option value="lte">小于等于</option>
                                            </select>
                                            <input type="number" id="price" name="price" min="0" step="10" class="form-input combo-number">
                                            <span class="combo-unit">美元</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
                
                <!-- 批量课程模式：课程列表区 -->
                <div class="batch-course-list" id="batchCourseList" style="display: none;">
                    <div class="course-list-card">
                        <h4 class="list-title">课程列表与单独调整</h4>
                        <div class="course-items" id="courseItems">
                            <!-- 课程项目将通过JavaScript动态生成 -->
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-cancel" onclick="closeSubscribeModal()">取消</button>
                <button type="button" class="btn btn-save" onclick="submitSubscribe()">确认订阅</button>
            </div>
        </div>
    </div>
    <script src="data/students.js"></script>
    <script src="scripts/studentRepository.js"></script>
    <script>

        
        // 顶部导航标签切换
        document.querySelectorAll('.nav-tab').forEach((tab, index) => {
            tab.addEventListener('click', function() {
                // 移除所有活跃状态
                document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                // 添加当前标签的活跃状态
                this.classList.add('active');
                
                // 隐藏所有内容
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.style.display = 'none';
                });
                
                // 显示对应内容
                if (index === 0) { // 大学中心
                    document.getElementById('university-center').style.display = 'block';
                } else if (index === 1) { // 产品中心
                    document.getElementById('product-center').style.display = 'block';
                } else if (index === 2) { // 学生中心
                    document.getElementById('student-center').style.display = 'block';
                }
            });
        });
        
        // 默认显示学生中心
        document.getElementById('student-center').style.display = 'block';
        
    // 渲染学生服务表格数据
    renderStudentServiceTable();

        // 初始化批量订阅按钮状态
        updateBatchSubscribeButton();
        
        // 点击页面其他地方时隐藏下拉菜单
        document.addEventListener('click', function(e) {
            const dropdown = document.getElementById('batchSubscribeDropdown');
            if (!dropdown.contains(e.target)) {
                // 可以添加额外的隐藏逻辑，但CSS悬浮效果会自动处理
            }
        });
        
        // 单门课程订阅选项卡点击效果
        document.addEventListener('DOMContentLoaded', function() {
            // 选项卡点击事件
            document.querySelectorAll('.option-card').forEach(card => {
                card.addEventListener('click', function() {
                    // 移除所有选中状态
                    document.querySelectorAll('.option-card').forEach(c => c.classList.remove('selected'));
                    // 添加当前选中状态
                    this.classList.add('selected');
                    // 选中对应的单选按钮
                    const radio = this.querySelector('input[type="radio"]');
                    if (radio) radio.checked = true;
                });
            });
            
            // 单选按钮变化事件
            document.querySelectorAll('input[name="subscriptionType"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    // 移除所有选中状态
                    document.querySelectorAll('.option-card').forEach(c => c.classList.remove('selected'));
                    // 添加当前选中状态
                    const card = this.closest('.option-card');
                    if (card) card.classList.add('selected');
                });
            });
        });
        
        // 学生中心左侧边栏功能项点击
        document.querySelectorAll('.student-sidebar .sidebar-title').forEach(item => {
            item.addEventListener('click', function() {
                document.querySelectorAll('.student-sidebar .sidebar-title').forEach(i => i.classList.remove('active'));
                this.classList.add('active');

                document.querySelectorAll('#student-center .sub-content').forEach(content => {
                    content.style.display = 'none';
                });

                const target = this.getAttribute('data-target');
                const targetElement = document.getElementById(target);
                if (targetElement) {
                    targetElement.style.display = 'block';
                }
            });
        });

        // 大学中心左侧边栏功能项点击
        document.querySelectorAll('.university-sidebar .sidebar-title').forEach(item => {
            item.addEventListener('click', function() {
                document.querySelectorAll('.university-sidebar .sidebar-title').forEach(i => i.classList.remove('active'));
                this.classList.add('active');

                document.querySelectorAll('#university-center .sub-content').forEach(content => {
                    content.style.display = 'none';
                });

                const target = this.getAttribute('data-target');
                const targetElement = document.getElementById(target);
                if (targetElement) {
                    targetElement.style.display = 'block';
                }
            });
        });

        document.querySelectorAll('.product-sidebar .sidebar-title').forEach(item => {
            item.addEventListener('click', function() {
                document.querySelectorAll('.product-sidebar .sidebar-title').forEach(i => i.classList.remove('active'));
                this.classList.add('active');

                document.querySelectorAll('#product-center .sub-content').forEach(content => {
                    content.style.display = 'none';
                });

                const target = this.getAttribute('data-target');
                const targetElement = document.getElementById(target);
                if (targetElement) {
                    targetElement.style.display = 'block';
                }
            });
        });
        
        // 监听课程选择变化
        function updateBatchSubscribeButton() {
            const selectedCount = document.querySelectorAll('.course-checkbox:checked').length;
            const batchBtn = document.getElementById('batchSubscribeBtn');
            const dropdownMenu = document.getElementById('dropdownMenu');
            
            if (selectedCount >= 2) {
                batchBtn.disabled = false;
                batchBtn.querySelector('.btn-text').textContent = `批量订阅 (${selectedCount}门课程)`;
                dropdownMenu.classList.remove('disabled');
            } else {
                batchBtn.disabled = true;
                batchBtn.querySelector('.btn-text').textContent = '批量订阅';
                dropdownMenu.classList.add('disabled');
            }
        }

        function attachCourseCheckboxListeners() {
            const checkboxes = document.querySelectorAll('.course-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.removeEventListener('change', updateBatchSubscribeButton);
                checkbox.addEventListener('change', updateBatchSubscribeButton);
            });
        }

        function createStudentServiceSubscribeButton(type) {
            const button = document.createElement('button');
            button.className = type === 'home' ? 'course-subscribe-btn home-course' : 'course-subscribe-btn';
            button.setAttribute('onclick', type === 'home'
                ? "subscribeSingleCourse(this, 'home')"
                : "subscribeSingleCourse(this, 'product')");
            button.title = type === 'home' ? '订阅本校意向课程' : '订阅产品课程';
            button.textContent = '订阅';
            return button;
        }

        function getStudentServiceStatusMeta(course, product) {
            const defaultMeta = { text: '待匹配', className: 'pending' };

            if (!product) {
                if (course && course.status === 'serving') {
                    return { text: '服务中', className: 'active' };
                }
                if (course && course.status === 'completed') {
                    return { text: '已完成', className: 'completed' };
                }
                if (course && course.status === 'potential') {
                    return { text: '潜在价值', className: 'pending' };
                }
                return defaultMeta;
            }

            const verification = product.verificationOutcome || '';
            if (verification) {
                if (verification.includes('成功')) {
                    return { text: verification, className: 'completed' };
                }
                if (verification.includes('失败')) {
                    return { text: verification, className: 'pending' };
                }
                return { text: verification, className: product.isOnSale ? 'active' : 'pending' };
            }

            const alignment = product.alignmentStatus || '';
            if (alignment) {
                return {
                    text: product.isOnSale ? `${alignment} · 在售` : alignment,
                    className: product.isOnSale ? 'active' : 'pending'
                };
            }

            if (product.isOnSale) {
                return { text: '在售课程单元', className: 'active' };
            }

            if (course && course.status === 'serving') {
                return { text: '服务中', className: 'active' };
            }

            return defaultMeta;
        }

        function buildStudentIdentityCells(row, studentInfo, rowSpan) {
            const spanValue = Math.max(rowSpan, 1);

            const nameCell = document.createElement('td');
            nameCell.className = 'student-name';
            nameCell.rowSpan = spanValue;
            nameCell.textContent = studentInfo && studentInfo.name ? studentInfo.name : '未知学生';
            row.appendChild(nameCell);

            const schoolCell = document.createElement('td');
            schoolCell.rowSpan = spanValue;
            schoolCell.textContent = studentInfo && studentInfo.school ? studentInfo.school : '未知学校';
            row.appendChild(schoolCell);
        }

        function createStudentServiceHomeCell(course, rowSpan) {
            const cell = document.createElement('td');
            cell.className = 'course-cell';
            if (rowSpan > 1) {
                cell.rowSpan = rowSpan;
            }

            const link = document.createElement('span');
            link.className = 'course-link';
            link.textContent = course && course.homeCourse ? course.homeCourse : '待配置课程';
            cell.appendChild(link);

            if (course && course.homeCourseName) {
                cell.appendChild(document.createTextNode(` (${course.homeCourseName})`));
            }

            if (course) {
                cell.appendChild(document.createTextNode(' '));
                cell.appendChild(createStudentServiceSubscribeButton('home'));
            }

            return cell;
        }

        function createStudentServiceProductCell(product) {
            const cell = document.createElement('td');
            cell.className = 'course-cell';

            const link = document.createElement('span');
            link.className = 'course-link';
            link.textContent = product && product.code ? product.code : '待匹配课程';
            cell.appendChild(link);

            if (product && product.name) {
                cell.appendChild(document.createTextNode(` (${product.name})`));
            }

            if (product && product.school) {
                cell.appendChild(document.createTextNode(` - ${product.school}`));
            }

            if (product) {
                cell.appendChild(document.createTextNode(' '));
                cell.appendChild(createStudentServiceSubscribeButton('product'));
            }

            return cell;
        }

        function createStudentServiceModalityCell(product) {
            const cell = document.createElement('td');
            cell.textContent = product && product.modality ? product.modality : '待匹配';
            return cell;
        }

        function createStudentServicePeriodCell(product) {
            const cell = document.createElement('td');
            if (product && product.startDate && product.endDate) {
                cell.textContent = `${product.startDate} 到 ${product.endDate}`;
            } else {
                cell.textContent = '-';
            }
            return cell;
        }

        function createStudentServiceClassCodeCell(product) {
            const cell = document.createElement('td');
            cell.textContent = product && product.classCode ? product.classCode : '-';
            return cell;
        }

        function createStudentServiceStatusCell(course, product) {
            const cell = document.createElement('td');
            const meta = getStudentServiceStatusMeta(course, product);
            const badge = document.createElement('span');
            badge.className = `status ${meta.className}`.trim();
            badge.textContent = meta.text;
            cell.appendChild(badge);
            return cell;
        }

        function createStudentServiceCheckboxCell() {
            const cell = document.createElement('td');
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.className = 'course-checkbox';
            cell.appendChild(checkbox);
            return cell;
        }

        function renderStudentServiceTable() {
            const tbody = document.getElementById('studentServiceTableBody');
            if (!tbody) {
                return;
            }

            const repository = getStudentRepository();
            if (!repository) {
                tbody.innerHTML = `<tr><td colspan="9" class="empty-state-cell">学生数据未加载</td></tr>`;
                return;
            }

            let snapshot = [];
            if (typeof repository.getStudentServiceSnapshot === 'function') {
                snapshot = repository.getStudentServiceSnapshot();
            } else {
                const students = repository.getAllFollowUps();
                snapshot = students.map(student => ({
                    student: {
                        id: student.id,
                        name: student.name,
                        school: student.school
                    },
                    courses: repository.getSelectedCourses(student.id)
                }));
            }

            if (!snapshot.length) {
                tbody.innerHTML = `<tr><td colspan="9" class="empty-state-cell">暂未找到在售课程</td></tr>`;
                attachCourseCheckboxListeners();
                updateBatchSubscribeButton();
                return;
            }

            const fragment = document.createDocumentFragment();
            let renderedRowCount = 0;

            snapshot.forEach(entry => {
                const studentInfo = entry.student || {};
                const rawCourses = Array.isArray(entry.courses) ? entry.courses : [];

                // Only render courses that have at least one on-sale product unit.
                const visibleCourses = rawCourses.reduce((acc, course) => {
                    if (!course) {
                        return acc;
                    }

                    const productList = Array.isArray(course.productCourses)
                        ? course.productCourses.filter(product => product && product.isOnSale)
                        : [];

                    if (!productList.length) {
                        return acc;
                    }

                    acc.push({ course, productList });
                    return acc;
                }, []);

                if (!visibleCourses.length) {
                    return;
                }

                const totalRows = visibleCourses.reduce((sum, item) => sum + item.productList.length, 0);
                let studentCellsRendered = false;

                visibleCourses.forEach(({ course, productList }) => {
                    const courseRowSpan = productList.length;

                    productList.forEach((product, index) => {
                        const row = document.createElement('tr');
                        row.appendChild(createStudentServiceCheckboxCell());

                        if (!studentCellsRendered) {
                            buildStudentIdentityCells(row, studentInfo, totalRows);
                            studentCellsRendered = true;
                        }

                        if (index === 0) {
                            row.appendChild(createStudentServiceHomeCell(course, courseRowSpan));
                        }

                        row.appendChild(createStudentServiceProductCell(product));
                        row.appendChild(createStudentServiceModalityCell(product));
                        row.appendChild(createStudentServicePeriodCell(product));
                        row.appendChild(createStudentServiceClassCodeCell(product));
                        row.appendChild(createStudentServiceStatusCell(course, product));
                        fragment.appendChild(row);
                        renderedRowCount += 1;
                    });
                });
            });

            if (!renderedRowCount) {
                tbody.innerHTML = `<tr><td colspan="9" class="empty-state-cell">暂未找到在售课程</td></tr>`;
                attachCourseCheckboxListeners();
                updateBatchSubscribeButton();
                return;
            }

            tbody.innerHTML = '';
            tbody.appendChild(fragment);
            attachCourseCheckboxListeners();
            updateBatchSubscribeButton();
        }
        
        // 为所有课程复选框添加事件监听器
        attachCourseCheckboxListeners();
        
        // 批量订阅按钮点击事件（现在只是阻止默认行为，实际功能由下拉菜单处理）
        document.getElementById('batchSubscribeBtn').addEventListener('click', function(e) {
            if (this.disabled) {
                e.preventDefault();
                return;
            }
            // 点击主按钮时不执行任何操作，用户需要悬浮选择子选项
            e.preventDefault();
        });
        
        // 下拉菜单项点击事件
        document.querySelectorAll('.dropdown-item').forEach(item => {
            item.addEventListener('click', function(e) {
                e.stopPropagation();
                
                const selectedCount = document.querySelectorAll('.course-checkbox:checked').length;
                if (selectedCount < 2) {
                    alert('请至少选择2门课程进行批量订阅');
                    return;
                }
                
                const type = this.getAttribute('data-type');
                const courseType = type === 'home' ? '本校课程' : '产品课程';
                
                // 打开批量订阅选择方式模态框
                openBatchSelectionModal(type, courseType);
            });
        });
        
        // 打开批量订阅选择方式模态框
        function openBatchSelectionModal(type, courseType) {
            const selectedCourses = getSelectedCourses();
            if (selectedCourses.length < 2) {
                alert('请至少选择2门课程进行批量订阅');
                return;
            }
            
            // 设置模态框标题
            document.getElementById('singleCourseModalTitle').textContent = `请选择${courseType}订阅方式`;
            
            // 确保模态框头部始终有绿色背景
            const modalHeader = document.querySelector('#singleCourseModal .modal-header');
            modalHeader.classList.add('product-course');
            
            // 获取选中学生的姓名（假设所有选中课程都是同一个学生的）
            const studentName = selectedCourses.length > 0 ? selectedCourses[0].student : '未知学生';
            
            // 设置课程信息显示
            const courseInfoDisplay = document.getElementById('courseInfoDisplay');
            
            // 构建课程列表HTML
            let courseListHTML = '';
            selectedCourses.forEach(course => {
                // 课程信息应该已经是"课程代码(课程名称)"格式，直接显示
                const courseDisplay = course.course || '未知课程';
                courseListHTML += `<div class="course-item-row">${courseDisplay}</div>`;
            });
            
            courseInfoDisplay.innerHTML = `
                <div class="info-row-horizontal">
                    <div class="info-item">
                        <span class="info-label">学生姓名：</span>
                        <span class="info-value readonly-field">${studentName}</span>
                    </div>
                    <div class="info-item course-list-item">
                        <span class="info-label">订阅课程：</span>
                        <div class="info-value course-list-container">
                            <div class="course-count-title">已选课程 (${selectedCourses.length}门)</div>
                            <div class="course-list-scroll readonly-field">
                                ${courseListHTML}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // 更新确认按钮事件
            const confirmBtn = document.getElementById('confirmSelectionBtn');
            confirmBtn.onclick = function() {
                const selectedOption = document.querySelector('input[name="subscribeOption"]:checked');
                if (!selectedOption) {
                    alert('请选择订阅方式');
                    return;
                }
                
                // 关闭选择模态框
                document.getElementById('singleCourseModal').style.display = 'none';
                
                // 根据选择的方式处理
                if (selectedOption.value === 'direct') {
                    // 直接订阅 - 直接执行批量订阅
                    executeBatchSubscribe(type, courseType);
                } else {
                    // 个性化订阅 - 打开设置条件模态框
                    openBatchSubscribeModal(courseType + '订阅');
                }
            };
            
            // 重置单选框状态
            document.querySelectorAll('input[name="subscribeOption"]').forEach(radio => {
                radio.checked = false;
            });
            // 默认选中第一个选项
            document.getElementById('directSubscription').checked = true;
            
            // 显示选择模态框
            document.getElementById('singleCourseModal').style.display = 'flex';
        }
        
        // 打开批量订阅模态框
        function openBatchSubscribeModal(type) {
            const selectedCourses = getSelectedCourses();
            if (selectedCourses.length < 2) {
                alert('请至少选择2门课程进行批量订阅');
                return;
            }
            
            // 设置模态框标题
            document.getElementById('modalTitle').textContent = type + '批量设置';
            
            // 设置模态框头部样式（本校课程和产品课程都使用绿色样式）
            const modalHeader = document.querySelector('#subscribeModal .modal-header');
            modalHeader.classList.add('product-course');
            
            // 填充批量数据
            fillBatchModalData(selectedCourses, type);
            
            // 只显示批量模式
            showBatchCourseMode();
            
            // 显示模态框
            document.getElementById('subscribeModal').style.display = 'flex';
        }
        
        // 执行直接批量订阅
        function executeBatchSubscribe(type, courseType) {
            const selectedCourses = getSelectedCourses();
            
            // 显示成功消息
            alert(`成功为 ${selectedCourses.length} 门课程订阅了${courseType}！`);
            
            // 取消所有选中状态
            document.querySelectorAll('.course-checkbox:checked').forEach(checkbox => {
                checkbox.checked = false;
            });
            
            // 更新批量订阅按钮状态
            updateBatchSubscribeButton();
            
            console.log(`批量订阅执行完成 - 类型: ${courseType}, 课程数量: ${selectedCourses.length}`);
        }
        
        // 打开订阅模态框（现在只用于单门课程）
        function openSubscribeModal(type) {
            const selectedCourses = getSelectedCourses();
            if (selectedCourses.length === 0) {
                alert('请先选择要订阅的课程');
                return;
            }
            
            // 只处理单门课程订阅
            document.getElementById('modalTitle').textContent = type + '条件设置';
            
            // 设置模态框头部样式（本校课程和产品课程都使用绿色样式）
            const modalHeader = document.querySelector('#subscribeModal .modal-header');
            modalHeader.classList.add('product-course');
            
            fillModalData(selectedCourses, type);
            showSingleCourseMode();
            document.getElementById('subscribeModal').style.display = 'flex';
        }
        
        // 显示单门课程模式
        function showSingleCourseMode() {
            document.getElementById('singleCourseInfo').style.display = 'grid';
            document.getElementById('batchUnifiedSection').style.display = 'none';
            document.getElementById('batchCourseList').style.display = 'none';
            
            // 恢复单门课程的标题和隐藏说明
            document.getElementById('formSectionTitle').textContent = '订阅条件设置';
            document.getElementById('formSectionDescription').style.display = 'none';
        }
        
        // 显示批量课程模式
        function showBatchCourseMode() {
            document.getElementById('singleCourseInfo').style.display = 'none';
            document.getElementById('batchUnifiedSection').style.display = 'block';
            document.getElementById('batchCourseList').style.display = 'block';
            
            // 更新表单标题和说明
            document.getElementById('formSectionTitle').textContent = '统一订阅条件设置';
            document.getElementById('formSectionDescription').style.display = 'block';
        }
        
        // 关闭订阅模态框
        function closeSubscribeModal() {
            document.getElementById('subscribeModal').style.display = 'none';
            // 清理批量模式的动态内容
            document.getElementById('courseItems').innerHTML = '';
            // 清除模态框头部的产品课程样式
            document.querySelector('#subscribeModal .modal-header').classList.remove('product-course');
            // 清理单门课程订阅的状态
            window.currentSubscribeButton = null;
        }
        
        // 获取选中的课程
        function getSelectedCourses() {
            const selectedCourses = [];
            const checkboxes = document.querySelectorAll('.course-checkbox:checked');
            
            checkboxes.forEach(checkbox => {
                const row = checkbox.closest('tr');
                
                // 获取学生姓名（处理合并单元格）
                let studentName = '';
                const studentNameCell = row.querySelector('.student-name');
                if (studentNameCell) {
                    studentName = studentNameCell.textContent.trim();
                } else {
                    // 查找前面行的学生姓名
                    const allRows = Array.from(row.parentElement.children);
                    const currentRowIndex = allRows.indexOf(row);
                    for (let i = currentRowIndex - 1; i >= 0; i--) {
                        const prevRow = allRows[i];
                        const prevStudentNameCell = prevRow.querySelector('.student-name');
                        if (prevStudentNameCell) {
                            studentName = prevStudentNameCell.textContent.trim();
                            break;
                        }
                    }
                }
                
                // 通过类名查找课程信息，避免rowspan导致的列索引问题
                const courseCell = row.querySelector('.course-cell'); // 直接查找包含课程信息的单元格
                const buttonElement = row.querySelector('.course-subscribe-btn'); // 在整行中查找订阅按钮
                
                // 提取课程代码和课程名称，格式化为"课程代码(课程名称)"
                let courseCode = '';
                let courseName = '';
                
                if (courseCell) {
                    const courseLink = courseCell.querySelector('.course-link');
                    courseCode = courseLink ? courseLink.textContent.trim() : '';
                    
                    const fullCellText = courseCell.textContent.trim();
                    const courseNameMatch = fullCellText.match(/\(([^)]+)\)/);
                    courseName = courseNameMatch ? courseNameMatch[1] : '';
                }
                
                // 只保留课程代码和课程名称
                const formattedCourse = courseCode && courseName ? `${courseCode}(${courseName})` : courseCode || '未知课程';
                
                selectedCourses.push({
                    student: studentName,
                    course: formattedCourse,
                    buttonElement: buttonElement
                });
            });
            
            return selectedCourses;
        }
        
        // 填充模态框数据（单门课程）
        function fillModalData(selectedCourses, type) {
            // 填充学生姓名（取第一个学生）
            document.getElementById('studentNameField').textContent = selectedCourses[0].student;
            
            // 填充选中的课程
            const courseList = selectedCourses.map(item => `${item.course}`).join(', ');
            document.getElementById('selectedCoursesField').textContent = courseList;
        }
        
        // 填充批量模态框数据
        function fillBatchModalData(selectedCourses, type, options = {}) {
            // 填充批量模式的学生姓名和课程信息
            const studentNameField = document.getElementById('batchStudentNameField');
            studentNameField.textContent = selectedCourses[0].student;
            
            // 🎯 根据选项设置学生姓名是否可编辑
            if (options.readonlyStudentName) {
                studentNameField.style.backgroundColor = '#f8f9fa';
                studentNameField.style.color = '#6c757d';
                studentNameField.style.cursor = 'default';
                studentNameField.contentEditable = false;
                studentNameField.title = '系统自动获取，不可编辑';
            } else {
                studentNameField.style.backgroundColor = '';
                studentNameField.style.color = '';
                studentNameField.style.cursor = '';
                studentNameField.contentEditable = true;
                studentNameField.title = '';
            }
            
            // 填充选中的课程（垂直列表显示）
            const courseCount = selectedCourses.length;
            const courseNames = [...new Set(selectedCourses.map(item => item.course))];
            
            // 生成垂直课程列表HTML
            let courseListHTML = `
                <div class="course-count-title">已选课程 (${courseNames.length}门)</div>
                <div class="course-list-scroll">
            `;
            
            courseNames.forEach(courseName => {
                courseListHTML += `<div class="course-item-row">${courseName}</div>`;
            });
            
            courseListHTML += `</div>`;
            document.getElementById('batchSelectedCoursesField').innerHTML = courseListHTML;
            
            // 生成课程列表
            const courseItemsContainer = document.getElementById('courseItems');
            courseItemsContainer.innerHTML = '';
            
            selectedCourses.forEach((course, index) => {
                const courseItem = createCourseItem(course, index);
                courseItemsContainer.appendChild(courseItem);
            });
        }
        
        // 创建课程项目元素
        function createCourseItem(course, index) {
            const courseItem = document.createElement('div');
            courseItem.className = 'course-item';
            courseItem.setAttribute('data-course-index', index);
            
            courseItem.innerHTML = `
                <div class="course-header">
                    <div class="course-name">${course.course}</div>
                    <div class="course-status">
                        <span class="status-label" id="status-${index}">默认使用统一设置</span>
                        <button class="toggle-btn" id="toggle-${index}" onclick="toggleIndividualSetting(${index})">
                            单独设置
                        </button>
                    </div>
                </div>
                <div class="individual-form" id="form-${index}">
                    <!-- 独立设置表单将通过JavaScript克隆生成 -->
                </div>
            `;
            
            return courseItem;
        }
        
        // 切换独立设置
        function toggleIndividualSetting(courseIndex) {
            const statusLabel = document.getElementById(`status-${courseIndex}`);
            const toggleBtn = document.getElementById(`toggle-${courseIndex}`);
            const individualForm = document.getElementById(`form-${courseIndex}`);
            
            if (individualForm.classList.contains('show')) {
                // 收起独立设置
                individualForm.classList.remove('show');
                statusLabel.textContent = '默认使用统一设置';
                statusLabel.classList.remove('active');
                toggleBtn.textContent = '单独设置';
                toggleBtn.classList.remove('secondary');
                
                // 清空独立表单
                individualForm.innerHTML = '';
            } else {
                // 展开独立设置
                const clonedForm = cloneUnifiedForm();
                fillClonedFormWithUnifiedData(clonedForm);
                individualForm.appendChild(clonedForm);
                
                individualForm.classList.add('show');
                statusLabel.textContent = '使用单独设置';
                statusLabel.classList.add('active');
                toggleBtn.textContent = '收起并使用统一设置';
                toggleBtn.classList.add('secondary');
            }
        }
        
        // 克隆统一设置表单
        function cloneUnifiedForm() {
            const originalForm = document.querySelector('#subscribeForm .form-section');
            const clonedForm = originalForm.cloneNode(true);
            
            // 修改克隆表单的标题
            const title = clonedForm.querySelector('.section-title');
            title.textContent = '单独设置';
            
            // 修改说明文字
            const description = clonedForm.querySelector('.section-description');
            if (description) {
                description.textContent = '您正在为本课程进行个性化设置。此处的条件将优先于统一设置，并仅应用于该门课程。';
                description.style.display = 'block';
            }
            
            // 为克隆表单的控件添加唯一标识符
            const inputs = clonedForm.querySelectorAll('input, select');
            inputs.forEach((input, index) => {
                if (input.name) {
                    input.name = input.name + '_individual';
                }
                if (input.id) {
                    input.id = input.id + '_individual';
                }
            });
            
            return clonedForm;
        }
        
        // 填充克隆表单的数据
        function fillClonedFormWithUnifiedData(clonedForm) {
            const unifiedForm = document.querySelector('#subscribeForm');
            
            // 复制统一设置的表单数据到克隆表单
            const unifiedInputs = unifiedForm.querySelectorAll('input, select');
            const clonedInputs = clonedForm.querySelectorAll('input, select');
            
            unifiedInputs.forEach((unifiedInput, index) => {
                const clonedInput = clonedInputs[index];
                if (clonedInput) {
                    if (unifiedInput.type === 'checkbox') {
                        clonedInput.checked = unifiedInput.checked;
                    } else {
                        clonedInput.value = unifiedInput.value;
                    }
                }
            });
        }
        
        // 提交订阅
        function submitSubscribe() {
            // 检查是否是单门课程订阅模式
            if (window.currentSubscribeButton) {
                console.log('检测到单门课程订阅模式');
                // 单门课程提交
                submitSingleCourse();
            } else {
                console.log('检测到批量课程订阅模式');
                // 批量课程提交
                const selectedCourses = getSelectedCourses();
                console.log('选中的课程数量:', selectedCourses.length);
                submitBatchCourses(selectedCourses);
            }
        }
        
        // 提交单门课程
        function submitSingleCourse() {
            // 更新按钮状态为已订阅
            if (window.currentSubscribeButton) {
                window.currentSubscribeButton.classList.add('subscribed');
                window.currentSubscribeButton.textContent = '已订阅';
                window.currentSubscribeButton.title = window.currentSubscribeButton.title.replace('订阅', '取消订阅');
                console.log('单门课程订阅成功，按钮状态已更新');
            } else {
                console.error('错误：未找到currentSubscribeButton');
            }
            
            alert('订阅成功！系统将根据设置的条件监控课程状态。');
            closeSubscribeModal();
        }
        
        // 提交批量课程
        function submitBatchCourses(selectedCourses) {
            const coursesData = [];
            
            selectedCourses.forEach((course, index) => {
                const individualForm = document.getElementById(`form-${index}`);
                const useIndividual = individualForm.classList.contains('show');
                
                let formData;
                if (useIndividual) {
                    // 收集单独设置的数据
                    formData = collectFormData(individualForm);
                } else {
                    // 收集统一设置的数据
                    formData = collectFormData(document.querySelector('#subscribeForm'));
                }
                
                coursesData.push({
                    courseIndex: index,
                    courseName: course.course,
                    student: course.student,
                    settings: formData,
                    useIndividual: useIndividual
                });
            });
            
            // 更新所有选中课程的按钮状态
            selectedCourses.forEach(course => {
                if (course.buttonElement) {
                    course.buttonElement.classList.add('subscribed');
                    course.buttonElement.textContent = '已订阅';
                    course.buttonElement.title = course.buttonElement.title.replace('订阅', '取消订阅');
                }
            });
            
            console.log('批量订阅数据:', coursesData);
            alert(`成功订阅 ${selectedCourses.length} 门课程！系统将根据设置的条件监控课程状态。`);
            
            // 🎯 批量订阅完成后，调用相应页面的清理函数
            if (window.currentBatchContext && window.currentBatchContext.clearFunction) {
                window.currentBatchContext.clearFunction();
                window.currentBatchContext = null; // 清理上下文
            }
            
            closeSubscribeModal();
        }
        
        // 收集表单数据
        function collectFormData(formContainer) {
            const data = {};
            const inputs = formContainer.querySelectorAll('input, select');
            
            inputs.forEach(input => {
                if (input.type === 'checkbox') {
                    data[input.name] = input.checked;
                } else {
                    data[input.name] = input.value;
                }
            });
            
            return data;
        }
        
        // 点击模态框外部关闭
        document.getElementById('subscribeModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeSubscribeModal();
            }
        });
        
        // 学生跟进相关功能函数
        function toggleAllStudents(checkbox) {
            const checkboxes = document.querySelectorAll('.student-checkbox');
            checkboxes.forEach(cb => cb.checked = checkbox.checked);
        }
        
        function addStudent() {
            alert('新增学生功能开发中...');
        }
        
        function exportStudents() {
            alert('导出数据功能开发中...');
        }
        
        function refreshStudents() {
            renderStudentFollowTable();
            alert('学生列表已刷新');
        }
        
        function searchStudents() {
            const searchValue = document.getElementById('studentSearch').value.toLowerCase();
            const rows = document.querySelectorAll('.student-row');
            
            rows.forEach(row => {
                const studentName = row.querySelector('.student-name').textContent.toLowerCase();
                const schoolName = row.querySelector('.school-name').textContent.toLowerCase();
                const wechatName = row.querySelector('.wechat-name').textContent.toLowerCase();
                
                if (studentName.includes(searchValue) || 
                    schoolName.includes(searchValue) || 
                    wechatName.includes(searchValue)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        
        function editStudent(studentId) {
            alert(`编辑学生 ID: ${studentId} 功能开发中...`);
        }
        
        function addFollowRecord(studentId) {
            alert(`添加跟进记录 - 学生 ID: ${studentId} 功能开发中...`);
        }
        
        function deleteStudent(studentId) {
            if (confirm('确定要删除该学生信息吗？')) {
                alert(`删除学生 ID: ${studentId} 功能开发中...`);
            }
        }
        
        // 搜索框回车事件
        document.getElementById('studentSearch').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchStudents();
            }
        });
        
        // 返回学生跟进页面
        function backToStudentFollow() {
            StudentAnalysisController.setCurrentStudent(null);
            document.getElementById('student-analysis-page').style.display = 'none';
            document.querySelector('.main-layout').style.display = 'block';
        }
        
        // 单独订阅课程功能
        function subscribeSingleCourse(buttonElement, courseType) {
            // 阻止事件冒泡，防止触发其他点击事件
            event.stopPropagation();
            
            // 检查当前订阅状态
            const isSubscribed = buttonElement.classList.contains('subscribed');
            
            if (isSubscribed) {
                // 如果已订阅，仅作展示，不执行任何操作
                return;
            }
            
            // 获取课程信息
            const courseCell = buttonElement.closest('.course-cell');
            const courseLink = courseCell.querySelector('.course-link');
            const courseCode = courseLink ? courseLink.textContent.trim() : '';
            
            // 获取完整的课程信息（课程代码和课程名称）
            const fullCellText = courseCell.textContent.trim();
            const courseNameMatch = fullCellText.match(/\(([^)]+)\)/);
            const courseName = courseNameMatch ? courseNameMatch[1] : '';
            
            // 格式化为"课程代码(课程名称)"
            const formattedCourse = courseCode && courseName ? `${courseCode}(${courseName})` : fullCellText;
            
            // 获取学生信息
            const row = courseCell.closest('tr');
            let studentName = '';
            
            // 查找学生姓名 - 可能在当前行或者在前面的行（合并单元格情况）
            const studentNameCell = row.querySelector('.student-name');
            if (studentNameCell) {
                studentName = studentNameCell.textContent.trim();
            } else {
                // 如果当前行没有学生姓名，查找前面的行（处理rowspan情况）
                const allRows = Array.from(row.parentElement.children);
                const currentRowIndex = allRows.indexOf(row);
                
                for (let i = currentRowIndex - 1; i >= 0; i--) {
                    const prevRow = allRows[i];
                    const prevStudentNameCell = prevRow.querySelector('.student-name');
                    if (prevStudentNameCell) {
                        studentName = prevStudentNameCell.textContent.trim();
                        break;
                    }
                }
            }
            
            // 创建单门课程的选中数据
            const selectedCourse = [{
                student: studentName,
                course: formattedCourse,
                type: courseType
            }];
            
            // 确定模态框标题
            let modalTitle = '';
            if (courseType === 'home') {
                modalTitle = '本校课程订阅';
            } else if (courseType === 'product') {
                modalTitle = '产品课程订阅';
            }
            
            // 打开单门课程订阅方式选择模态框
            openSingleCourseSelectionModal(selectedCourse, modalTitle, buttonElement);
        }
        
        // 打开单门课程订阅方式选择模态框
        function openSingleCourseSelectionModal(selectedCourse, modalTitle, buttonElement) {
            // 存储当前订阅信息，供后续使用
            window.currentSingleCourseData = {
                selectedCourse: selectedCourse,
                modalTitle: modalTitle,
                buttonElement: buttonElement
            };
            
            // 设置模态框标题
            const courseType = window.currentSingleCourseData.selectedCourse[0].type;
            let courseTypeText = '';
            if (courseType === 'home') {
                courseTypeText = '本校课程';
            } else if (courseType === 'product') {
                courseTypeText = '产品课程';
            }
            document.getElementById('singleCourseModalTitle').textContent = `请选择${courseTypeText}订阅方式`;
            
            // 确保模态框头部始终有绿色背景
            const modalHeader = document.querySelector('#singleCourseModal .modal-header');
            modalHeader.classList.add('product-course');
            
            // 设置课程信息显示（使用原有的学生课程信息格式）
            const courseInfoDisplay = document.getElementById('courseInfoDisplay');
            courseInfoDisplay.innerHTML = `
                <div class="info-row-horizontal">
                    <div class="info-item">
                        <label class="info-label">学生姓名</label>
                        <div class="info-value readonly-field">${selectedCourse[0].student}</div>
                    </div>
                    <div class="info-item">
                        <label class="info-label">订阅课程</label>
                        <div class="info-value readonly-field">${selectedCourse[0].course}</div>
                    </div>
                </div>
            `;
            
            // 更新确认按钮事件
            const confirmBtn = document.getElementById('confirmSelectionBtn');
            confirmBtn.onclick = function() {
                const selectedOption = document.querySelector('input[name="subscribeOption"]:checked');
                if (!selectedOption) {
                    alert('请选择订阅方式');
                    return;
                }
                
                const data = window.currentSingleCourseData;
                if (!data) return;
                
                if (selectedOption.value === 'direct') {
                    // 直接订阅
                    data.buttonElement.classList.add('subscribed');
                    data.buttonElement.textContent = '已订阅';
                    data.buttonElement.title = data.buttonElement.title.replace('订阅', '取消订阅');
                    alert('订阅成功！');
                    closeSingleCourseModal();
                } else {
                    // 个性化订阅，打开条件设置页面
                    closeSingleCourseModal();
                    openSingleCourseSubscribeModal(data.selectedCourse, data.modalTitle, data.buttonElement);
                }
            };
            
            // 重置单选框状态
            document.querySelectorAll('input[name="subscribeOption"]').forEach(radio => {
                radio.checked = false;
            });
            // 默认选中第一个选项
            document.getElementById('directSubscription').checked = true;
            
            // 显示模态框
            document.getElementById('singleCourseModal').style.display = 'flex';
        }
        
        // 关闭单门课程订阅方式选择模态框
        function closeSingleCourseModal() {
            document.getElementById('singleCourseModal').style.display = 'none';
            window.currentSingleCourseData = null;
        }
        

        
        // 为单门课程打开订阅模态框
        function openSingleCourseSubscribeModal(selectedCourses, modalTitle, buttonElement) {
            // 设置模态框标题
            document.getElementById('modalTitle').textContent = modalTitle + '条件设置';
            
            // 设置模态框头部样式（本校课程和产品课程都使用绿色样式）
            const modalHeader = document.querySelector('#subscribeModal .modal-header');
            modalHeader.classList.add('product-course');
            
            // 填充单门课程数据
            fillModalData(selectedCourses, modalTitle);
            
            // 显示单门课程模式
            showSingleCourseMode();
            
            // 存储按钮元素用于后续更新状态
            window.currentSubscribeButton = buttonElement;
            
            // 显示模态框
            document.getElementById('subscribeModal').style.display = 'flex';
        }
        
        // 学生选课分析页面Tab切换功能
        document.addEventListener('DOMContentLoaded', function() {
            renderStudentFollowTable();
            renderStudentServiceTable();
            updateBatchSubscribeButton();

            const analysisTabBtns = document.querySelectorAll('.analysis-tab-btn');
            analysisTabBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const target = this.getAttribute('data-target');
                    activateAnalysisTab(target);

                    switch (target) {
                        case 'student-profile':
                            renderStudentProfileSection();
                            break;
                        case 'autonomous-selection':
                            renderAutonomousSelectionSection();
                            break;
                        case 'selected-courses':
                            renderSelectedCoursesSection();
                            break;
                        case 'report-management':
                            renderReportSection();
                            break;
                        case 'subscription-info':
                            renderSubscriptionSection();
                            break;
                        default:
                            break;
                    }
                });
            });

            initFileUpload();
            initStudentProfileForm();
            renderStudentProfileSection();
        });
        
        const StudentRuntimeStore = (() => {
            const profileOverrides = new Map();

            return {
                setProfile(studentId, profile) {
                    if (!studentId || !profile) {
                        return;
                    }
                    const key = String(studentId);
                    profileOverrides.set(key, {
                        creditTransfer: profile.creditTransfer || 'yes',
                        coursePurpose: Array.isArray(profile.coursePurpose) ? [...profile.coursePurpose] : []
                    });
                },
                getMergedProfile(studentId, baseProfile = {}) {
                    if (!studentId) {
                        return { ...baseProfile };
                    }
                    const key = String(studentId);
                    const override = profileOverrides.get(key);
                    if (!override) {
                        return { ...baseProfile };
                    }
                    const merged = { ...baseProfile };
                    if (override.creditTransfer) {
                        merged.creditTransfer = override.creditTransfer;
                    }
                    if (override.coursePurpose && override.coursePurpose.length > 0) {
                        merged.coursePurpose = [...override.coursePurpose];
                    }
                    return merged;
                }
            };
        })();

        function activateAnalysisTab(targetId) {
            const tabButtons = document.querySelectorAll('.analysis-tab-btn');
            const tabContents = document.querySelectorAll('.analysis-tab-content');

            tabButtons.forEach(btn => {
                const isActive = btn.getAttribute('data-target') === targetId;
                if (isActive) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });

            tabContents.forEach(content => {
                if (content.id === targetId) {
                    content.classList.add('active');
                } else {
                    content.classList.remove('active');
                }
            });
        }

        function resetAnalysisTabs(defaultTabId = 'student-profile') {
            activateAnalysisTab(defaultTabId);
        }

        function clearUploadedFileState() {
            uploadedFiles = [];
            updateUploadedFilesList();
            const fileInput = document.getElementById('graduationReqFile');
            if (fileInput) {
                fileInput.value = '';
            }
        }

        function resetModalState() {
            if (typeof closeSingleCourseModal === 'function') {
                closeSingleCourseModal();
            }
            if (typeof closeSubscribeModal === 'function') {
                closeSubscribeModal();
            }
            window.currentBatchContext = null;
            window.currentSubscribeButton = null;
            window.currentSingleCourseData = null;
        }

        function resetIndependentForms() {
            const subscribeForm = document.getElementById('subscribeForm');
            if (subscribeForm) {
                subscribeForm.reset();
            }
            const courseItems = document.getElementById('courseItems');
            if (courseItems) {
                courseItems.innerHTML = '';
            }
        }

        const StudentAnalysisController = (() => {
            let currentStudent = null;
            let refreshPending = false;

            function updateTitle() {
                const titleEl = document.getElementById('student-analysis-title');
                if (!titleEl) {
                    return;
                }
                if (currentStudent) {
                    titleEl.textContent = `${currentStudent.name} - 学生选课分析`;
                } else {
                    titleEl.textContent = '学生选课分析';
                }
            }

            function refreshCurrentStudent() {
                if (!currentStudent) {
                    return;
                }
                renderStudentProfileSection();
                renderAutonomousSelectionSection();
                renderSelectedCoursesSection();
                renderSubscriptionSection();
                renderReportSection();
            }

            function scheduleRefresh() {
                if (refreshPending) {
                    return;
                }
                refreshPending = true;
                requestAnimationFrame(() => {
                    refreshPending = false;
                    refreshCurrentStudent();
                });
            }

            return {
                setCurrentStudent(student, options = {}) {
                    currentStudent = student
                        ? {
                            id: student.id,
                            name: student.name,
                            school: student.school
                        }
                        : null;

                    window.currentStudentInfo = currentStudent ? { ...currentStudent } : null;
                    resetAnalysisTabs(options.activeTab || 'student-profile');
                    clearUploadedFileState();
                    resetModalState();
                    resetIndependentForms();
                    updateTitle();

                    if (currentStudent) {
                        refreshCurrentStudent();
                    }
                },
                refreshCurrentStudent,
                scheduleRefresh,
                notifyDataChanged() {
                    scheduleRefresh();
                },
                getCurrentStudent() {
                    return currentStudent ? { ...currentStudent } : null;
                }
            };
        })();

        function renderStudentProfileSection() {
            const profileForm = document.getElementById('studentProfileForm');
            if (!profileForm) {
                return;
            }

            const nameInput = document.getElementById('studentName');
            const schoolInput = document.getElementById('studentSchool');
            const creditYes = document.getElementById('creditTransferYes');
            const creditNo = document.getElementById('creditTransferNo');
            const purposeInputs = profileForm.querySelectorAll('input[name="coursePurpose"]');

            const student = StudentAnalysisController.getCurrentStudent();
            if (!student) {
                if (nameInput) nameInput.value = '';
                if (schoolInput) schoolInput.value = '';
                if (creditYes) creditYes.checked = true;
                if (creditNo) creditNo.checked = false;
                purposeInputs.forEach(input => {
                    input.checked = false;
                });
                return;
            }

            if (nameInput) nameInput.value = student.name || '';
            if (schoolInput) schoolInput.value = student.school || '';

            const repository = window.StudentRepository;
            if (!repository || typeof repository.getStudentProfile !== 'function') {
                return;
            }

            const profileRecord = repository.getStudentProfile(student.id);
            const baseProfile = profileRecord && profileRecord.profile ? profileRecord.profile : {};
            const mergedProfile = StudentRuntimeStore.getMergedProfile(student.id, baseProfile);

            const creditTransfer = mergedProfile.creditTransfer === 'no' ? 'no' : 'yes';
            if (creditYes) {
                creditYes.checked = creditTransfer === 'yes';
            }
            if (creditNo) {
                creditNo.checked = creditTransfer === 'no';
            }

            const purposes = Array.isArray(mergedProfile.coursePurpose) ? mergedProfile.coursePurpose : [];
            purposeInputs.forEach(input => {
                input.checked = purposes.includes(input.value);
            });
        }

        function getCourseCorrespondenceSummary(schoolName, courseCode) {
            const emptyResult = { matched: 0, unmatched: 0, total: 0 };
            if (!schoolName || !courseCode) {
                return emptyResult;
            }

            const mappingTable = document.querySelector('#product-course-mapping table');
            if (!mappingTable) {
                return emptyResult;
            }

            const rows = mappingTable.querySelectorAll('tbody tr');
            let currentSchool = '';
            let currentCourse = '';
            let matched = 0;
            let unmatched = 0;

            rows.forEach(row => {
                const cells = Array.from(row.cells);
                if (!cells.length) {
                    return;
                }

                if (cells.length >= 9) {
                    const schoolText = cells[0].textContent.trim();
                    const courseText = cells[1] ? cells[1].textContent.trim() : '';

                    if (schoolText) {
                        currentSchool = schoolText;
                    }
                    if (courseText) {
                        currentCourse = courseText;
                    }
                }

                if (!currentSchool || !currentCourse) {
                    return;
                }

                if (currentSchool !== schoolName || currentCourse !== courseCode) {
                    return;
                }

                const statusText = cells
                    .map(cell => cell.textContent.trim())
                    .find(text => text === '对应' || text === '不对应');

                if (statusText === '对应') {
                    matched += 1;
                } else if (statusText === '不对应') {
                    unmatched += 1;
                }
            });

            return {
                matched,
                unmatched,
                total: matched + unmatched
            };
        }

        function getAlignedProductCourseCodes(schoolName, courseCode) {
            const result = new Set();
            if (!schoolName || !courseCode) {
                return result;
            }

            const mappingTable = document.querySelector('#product-course-mapping table');
            if (!mappingTable) {
                return result;
            }

            const rows = mappingTable.querySelectorAll('tbody tr');
            let currentSchool = '';
            let currentCourse = '';

            rows.forEach(row => {
                const cells = Array.from(row.cells);
                if (!cells.length) {
                    return;
                }

                if (cells.length >= 9) {
                    const schoolText = cells[0].textContent.trim();
                    const courseText = cells[1] ? cells[1].textContent.trim() : '';

                    if (schoolText) {
                        currentSchool = schoolText;
                    }
                    if (courseText) {
                        currentCourse = courseText;
                    }
                }

                if (!currentSchool || !currentCourse || currentSchool !== schoolName || currentCourse !== courseCode) {
                    return;
                }

                const alignmentStatus = cells[7]
                    ? cells[7].textContent.trim()
                    : (cells.map(cell => cell.textContent.trim()).find(text => text === '对应' || text === '不对应') || '');
                const productCourseCode = cells[5] ? cells[5].textContent.trim() : '';

                if (alignmentStatus === '对应' && productCourseCode) {
                    result.add(productCourseCode);
                }
            });

            return result;
        }

        function getOnSaleUnitSummary(schoolName, courseCode) {
            const alignedCodes = getAlignedProductCourseCodes(schoolName, courseCode);
            const summary = {
                hasAlignedProducts: alignedCodes.size > 0,
                onSaleCount: 0
            };

            if (!summary.hasAlignedProducts) {
                return summary;
            }

            const unitTable = document.querySelector('#product-unit-management table');
            if (!unitTable) {
                return summary;
            }

            const rows = unitTable.querySelectorAll('tbody tr');
            rows.forEach(row => {
                const cells = Array.from(row.cells);
                if (cells.length < 3) {
                    return;
                }

                const productCode = cells[2] ? cells[2].textContent.trim() : '';
                if (!productCode || !alignedCodes.has(productCode)) {
                    return;
                }

                const seatsText = cells[8] ? cells[8].textContent.trim() : cells.map(cell => cell.textContent.trim())[8] || '';
                const seats = parseInt(seatsText, 10);
                if (!Number.isNaN(seats) && seats > 0) {
                    summary.onSaleCount += 1;
                }
            });

            return summary;
        }

        function renderAutonomousSelectionSection() {
            const tbody = document.getElementById('autonomousCourseTableBody');
            if (!tbody) {
                return;
            }

            tbody.innerHTML = '';
            const student = StudentAnalysisController.getCurrentStudent();
            if (!student) {
                return;
            }

            const repository = window.StudentRepository;
            if (!repository || typeof repository.getAutonomousPlan !== 'function') {
                return;
            }

            const plan = repository.getAutonomousPlan(student.id) || [];
            if (!plan.length) {
                const emptyRow = document.createElement('tr');
                const emptyCell = document.createElement('td');
                emptyCell.colSpan = 6;
                emptyCell.className = 'empty-state-cell';
                emptyCell.textContent = '暂未添加自主选课意向';
                emptyRow.appendChild(emptyCell);
                tbody.appendChild(emptyRow);
                return;
            }

            const selectedSnapshot = repository.getSelectedCourses(student.id) || [];
            const selectedByCode = new Map();
            selectedSnapshot.forEach(selectedCourse => {
                if (!selectedCourse) {
                    return;
                }
                const key = typeof selectedCourse.homeCourse === 'string'
                    ? selectedCourse.homeCourse.trim()
                    : '';
                if (key) {
                    selectedByCode.set(key, selectedCourse);
                }
            });

            plan.forEach((item, index) => {
                const row = document.createElement('tr');

                const selectCell = document.createElement('td');
                selectCell.className = 'checkbox-cell';
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.className = 'course-checkbox';
                checkbox.setAttribute('data-course-code', item.code || '');
                checkbox.setAttribute('data-course-name', item.name || '');
                selectCell.appendChild(checkbox);
                row.appendChild(selectCell);

                const codeCell = document.createElement('td');
                codeCell.className = 'course-code-cell';
                codeCell.textContent = item.code || `COURSE-${index + 1}`;
                row.appendChild(codeCell);

                const nameCell = document.createElement('td');
                nameCell.className = 'course-name-cell';
                nameCell.textContent = item.name || '待定课程';
                row.appendChild(nameCell);

                const categoryCell = document.createElement('td');
                categoryCell.className = 'general-category-cell';
                categoryCell.textContent = item.category || '未分类';
                row.appendChild(categoryCell);

                const correspondenceCell = document.createElement('td');
                correspondenceCell.className = 'correspondence-cell';
                const correspondenceSummary = getCourseCorrespondenceSummary(student.school, item.code || '');

                if (correspondenceSummary.total > 0) {
                    correspondenceCell.textContent = `对应(${correspondenceSummary.matched})不对应(${correspondenceSummary.unmatched})`;
                } else if (Object.prototype.hasOwnProperty.call(item, 'correspondences')) {
                    const value = item.correspondences;
                    if (value === null || value === undefined || value === '') {
                        correspondenceCell.textContent = '暂无对应记录';
                    } else {
                        correspondenceCell.textContent = value;
                    }
                } else {
                    correspondenceCell.textContent = '-';
                }
                row.appendChild(correspondenceCell);

                const unitCell = document.createElement('td');
                unitCell.className = 'available-units-cell';
                const courseKey = typeof item.code === 'string' ? item.code.trim() : '';
                const runtimeCourse = courseKey ? selectedByCode.get(courseKey) : null;
                const runtimeProducts = Array.isArray(runtimeCourse?.productCourses)
                    ? runtimeCourse.productCourses.filter(Boolean)
                    : [];

                if (runtimeProducts.length) {
                    const onSaleCount = runtimeProducts.filter(product => product.isOnSale).length;
                    unitCell.textContent = onSaleCount > 0
                        ? `在售(${onSaleCount})`
                        : '暂无在售课程单元';
                } else {
                    const unitSummary = getOnSaleUnitSummary(student.school, courseKey);
                    if (unitSummary.hasAlignedProducts) {
                        if (unitSummary.onSaleCount > 0) {
                            unitCell.textContent = `在售(${unitSummary.onSaleCount})`;
                        } else {
                            unitCell.textContent = '暂无在售课程单元';
                        }
                    } else if (Object.prototype.hasOwnProperty.call(item, 'availableUnits')) {
                    const units = item.availableUnits;
                    unitCell.textContent = typeof units === 'number' ? units : (units || '');
                    } else {
                        unitCell.textContent = '-';
                    }
                }
                row.appendChild(unitCell);

                tbody.appendChild(row);
            });

            initAutonomousSelectionSubscription();
        }

        function renderSelectedCoursesSection() {
            const tbody = document.getElementById('selectedCoursesTableBody');
            if (!tbody) {
                return;
            }

            tbody.innerHTML = '';
            const student = StudentAnalysisController.getCurrentStudent();
            if (!student) {
                return;
            }

            const repository = window.StudentRepository;
            if (!repository || typeof repository.getSelectedCourses !== 'function') {
                return;
            }

            const selected = repository.getSelectedCourses(student.id) || [];
            if (!selected.length) {
                const emptyRow = document.createElement('tr');
                const emptyCell = document.createElement('td');
                emptyCell.colSpan = 11;
                emptyCell.className = 'empty-state-cell';
                emptyCell.textContent = '暂未记录选课数据';
                emptyRow.appendChild(emptyCell);
                tbody.appendChild(emptyRow);
                return;
            }

            const statusMap = {
                serving: { text: '服务中', className: 'status-serving' },
                potential: { text: '潜在价值', className: 'status-potential' },
                completed: { text: '已完成', className: 'status-completed' }
            };

            const auditMap = {
                aiPassed: { text: 'AI审核通过', className: 'audit-ai-passed' },
                notSubmitted: { text: '未提交审核', className: 'audit-not-submitted' },
                aiRejected: { text: 'AI审核驳回', className: 'audit-ai-rejected' }
            };

            const categoryClassMap = {
                '专业必修课': 'category-required',
                '专业选修课': 'category-elective',
                '通识课': 'category-general',
                '自由选修课': 'category-free'
            };

            selected.forEach(course => {
                const productCourses = Array.isArray(course.productCourses) ? course.productCourses : [];
                const rowSpan = Math.max(productCourses.length, 1);

                const statusInfo = statusMap[course.status] || { text: '未知状态', className: '' };
                const auditInfo = auditMap[course.audit] || { text: '未设置', className: '' };
                const categoryBadgeClass = categoryClassMap[course.category] || 'category-general';

                const ensureRow = (index) => {
                    if (productCourses.length === 0) {
                        return document.createElement('tr');
                    }
                    return index < productCourses.length ? document.createElement('tr') : null;
                };

                if (!productCourses.length) {
                    const row = document.createElement('tr');
                    appendSelectedCourseRowCells(row, {
                        isFirst: true,
                        rowSpan,
                        course,
                        categoryBadgeClass,
                        statusInfo,
                        auditInfo,
                        product: null
                    });
                    tbody.appendChild(row);
                    return;
                }

                productCourses.forEach((product, index) => {
                    const row = ensureRow(index);
                    appendSelectedCourseRowCells(row, {
                        isFirst: index === 0,
                        rowSpan,
                        course,
                        categoryBadgeClass,
                        statusInfo,
                        auditInfo,
                        product
                    });
                    tbody.appendChild(row);
                });
            });
        }

        function appendSelectedCourseRowCells(row, context) {
            if (!row || !context) {
                return;
            }

            const {
                isFirst,
                rowSpan,
                course,
                categoryBadgeClass,
                statusInfo,
                auditInfo,
                product
            } = context;

            const checkboxCell = document.createElement('td');
            checkboxCell.className = 'checkbox-cell';
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.className = 'course-checkbox';
            checkboxCell.appendChild(checkbox);
            row.appendChild(checkboxCell);

            if (isFirst) {
                const homeCourseCell = document.createElement('td');
                homeCourseCell.className = rowSpan > 1 ? 'home-course-cell merged-cell' : 'home-course-cell';
                homeCourseCell.rowSpan = rowSpan;
                const homeCourseCode = document.createElement('div');
                homeCourseCode.className = 'home-course-code';
                homeCourseCode.textContent = course.homeCourse || '未知课程';
                homeCourseCell.appendChild(homeCourseCode);

                if (course.homeCourseName) {
                    const homeCourseName = document.createElement('div');
                    homeCourseName.className = 'home-course-name';
                    homeCourseName.textContent = course.homeCourseName;
                    homeCourseCell.appendChild(homeCourseName);
                }

                row.appendChild(homeCourseCell);

                const categoryCell = document.createElement('td');
                categoryCell.className = rowSpan > 1 ? 'merged-cell' : '';
                const categoryBadge = document.createElement('span');
                categoryBadge.className = `course-category-badge ${categoryBadgeClass}`;
                categoryBadge.textContent = course.category || '未分类';
                categoryCell.appendChild(categoryBadge);
                categoryCell.rowSpan = rowSpan;
                row.appendChild(categoryCell);

                const statusCell = document.createElement('td');
                statusCell.className = `${rowSpan > 1 ? 'merged-cell ' : ''}${statusInfo.className}`.trim();
                statusCell.rowSpan = rowSpan;
                statusCell.textContent = statusInfo.text;
                row.appendChild(statusCell);

                const auditCell = document.createElement('td');
                auditCell.className = rowSpan > 1 ? 'merged-cell' : '';
                const auditBadge = document.createElement('span');
                auditBadge.className = `audit-status-text ${auditInfo.className}`.trim();
                auditBadge.textContent = auditInfo.text;
                auditCell.appendChild(auditBadge);
                auditCell.rowSpan = rowSpan;
                row.appendChild(auditCell);
            }

            const productCell = document.createElement('td');
            productCell.className = 'product-course-cell';
            if (product) {
                const codeSpan = document.createElement('span');
                codeSpan.className = 'product-course-code';
                codeSpan.textContent = product.code || '';
                const nameSpan = document.createElement('span');
                nameSpan.className = 'product-course-name';
                nameSpan.textContent = product.name || '';
                productCell.appendChild(codeSpan);
                productCell.appendChild(nameSpan);

                if (product.alignmentStatus || product.verificationOutcome) {
                    const metaSpan = document.createElement('span');
                    metaSpan.className = 'product-course-meta';
                    const metaParts = [];
                    if (product.alignmentStatus) {
                        metaParts.push(product.alignmentStatus);
                    }
                    if (product.verificationOutcome) {
                        metaParts.push(product.verificationOutcome);
                    }
                    metaSpan.textContent = metaParts.join(' · ');
                    productCell.appendChild(metaSpan);
                }
            } else {
                productCell.textContent = '暂未匹配产品课程';
            }
            row.appendChild(productCell);

            const schoolCell = document.createElement('td');
            const schoolClasses = ['product-school-cell'];
            if (product) {
                schoolClasses.push(product.isOnSale ? 'product-school-onsale' : 'product-school-soldout');
            }
            schoolCell.className = schoolClasses.join(' ');
            schoolCell.textContent = product && product.school ? product.school : '-';
            row.appendChild(schoolCell);

            const dateCell = document.createElement('td');
            dateCell.className = 'date-cell';
            if (product && product.startDate && product.endDate) {
                dateCell.textContent = `${product.startDate}~${product.endDate}`;
            } else {
                dateCell.textContent = '-';
            }
            row.appendChild(dateCell);

            const priceCell = document.createElement('td');
            priceCell.className = 'price-cell';
            priceCell.textContent = product && product.price ? product.price : '-';
            row.appendChild(priceCell);

            const codeCell = document.createElement('td');
            codeCell.className = 'code-cell';
            codeCell.textContent = product && product.classCode ? product.classCode : '-';
            row.appendChild(codeCell);

            const durationCell = document.createElement('td');
            durationCell.className = 'duration-cell';
            durationCell.textContent = product && product.duration ? product.duration : '-';
            row.appendChild(durationCell);
        }

        function renderReportSection() {
            const listContainer = document.getElementById('reportListContainer');
            if (!listContainer) {
                return;
            }

            listContainer.innerHTML = '';
            const student = StudentAnalysisController.getCurrentStudent();
            if (!student) {
                return;
            }

            const repository = window.StudentRepository;
            if (!repository || typeof repository.getReports !== 'function') {
                return;
            }

            const reports = repository.getReports(student.id) || [];
            if (!reports.length) {
                const empty = document.createElement('div');
                empty.className = 'report-empty-state';
                empty.textContent = '暂无选课报告，可在服务中生成新的分析报告。';
                listContainer.appendChild(empty);
                return;
            }

            const statusConfig = {
                completed: { text: '已完成', className: 'report-status-completed' },
                inProgress: { text: '进行中', className: 'report-status-progress' }
            };

            reports.forEach(report => {
                const card = document.createElement('div');
                card.className = 'report-card';

                const header = document.createElement('div');
                header.className = 'report-card-header';

                const title = document.createElement('h4');
                title.className = 'report-title';
                title.textContent = report.title || '未命名报告';

                const statusBadge = document.createElement('span');
                const statusInfo = statusConfig[report.status] || { text: '未开始', className: 'report-status-pending' };
                statusBadge.className = `report-status-badge ${statusInfo.className}`.trim();
                statusBadge.textContent = statusInfo.text;

                header.appendChild(title);
                header.appendChild(statusBadge);

                const body = document.createElement('div');
                body.className = 'report-card-body';

                const description = document.createElement('p');
                description.className = 'report-description';
                description.textContent = report.description || '暂无报告描述';

                const footer = document.createElement('div');
                footer.className = 'report-card-footer';

                const createdAt = document.createElement('span');
                createdAt.className = 'report-date';
                createdAt.textContent = `创建时间：${report.createdAt || '-'}`;

                const actionBtn = document.createElement('button');
                actionBtn.type = 'button';
                actionBtn.className = 'report-action-btn';
                actionBtn.textContent = '查看报告';
                actionBtn.onclick = () => {
                    alert(`报告「${report.title}」暂未接入查看功能`);
                };

                body.appendChild(description);
                footer.appendChild(createdAt);
                footer.appendChild(actionBtn);

                card.appendChild(header);
                card.appendChild(body);
                card.appendChild(footer);

                listContainer.appendChild(card);
            });
        }

        function renderSubscriptionSection() {
            const container = document.getElementById('subscriptionCardsContainer');
            if (!container) {
                return;
            }

            container.innerHTML = '';
            const student = StudentAnalysisController.getCurrentStudent();
            if (!student) {
                return;
            }

            const repository = window.StudentRepository;
            if (!repository || typeof repository.getSubscriptions !== 'function') {
                return;
            }

            const subscriptions = repository.getSubscriptions(student.id) || [];
            if (!subscriptions.length) {
                const emptyState = document.createElement('div');
                emptyState.className = 'subscription-empty-state';
                emptyState.textContent = '暂未创建订阅，请在课程表中设置订阅条件。';
                container.appendChild(emptyState);
                return;
            }

            const statusConfig = {
                waiting: { text: '等待上架', className: 'status-waiting', icon: '⏳' },
                matched: { text: '已匹配', className: 'status-matched', icon: '✅' },
                notified: { text: '已通知', className: 'status-notified', icon: '📧' },
                viewed: { text: '已查看', className: 'status-viewed', icon: '👁️' },
                converted: { text: '已转化', className: 'status-converted', icon: '🎉' },
                expired: { text: '已过期', className: 'status-expired', icon: '⏰' }
            };

            const typeConfig = {
                product: { text: '产品课程', className: 'type-product' },
                home: { text: '本校课程', className: 'type-home' }
            };

            subscriptions.forEach((sub, index) => {
                const statusInfo = statusConfig[sub.status] || { text: '未知状态', className: '', icon: 'ℹ️' };
                const typeInfo = typeConfig[sub.type] || { text: '未分类', className: '' };

                const card = document.createElement('div');
                card.className = 'subscription-card';
                card.dataset.status = sub.status || '';
                card.dataset.type = sub.type || '';
                card.dataset.deadline = sub.deadline || '';
                card.dataset.index = String(index);

                const header = document.createElement('div');
                header.className = 'card-header';

                const info = document.createElement('div');
                info.className = 'course-main-info';

                const title = document.createElement('h3');
                title.className = 'course-title';
                title.textContent = sub.course?.code || '未命名课程';

                const subtitle = document.createElement('p');
                subtitle.className = 'course-subtitle';
                subtitle.textContent = sub.course?.name || '-';

                const school = document.createElement('p');
                school.className = 'university-name';
                school.textContent = sub.course?.school || '-';

                info.appendChild(title);
                info.appendChild(subtitle);
                info.appendChild(school);

                const typeBadge = document.createElement('div');
                typeBadge.className = `subscription-type-badge ${typeInfo.className}`.trim();
                typeBadge.textContent = typeInfo.text;

                header.appendChild(info);
                header.appendChild(typeBadge);

                const body = document.createElement('div');
                body.className = 'card-body';

                const statusSection = document.createElement('div');
                statusSection.className = 'status-section';

                const statusBadge = document.createElement('div');
                statusBadge.className = `status-badge ${statusInfo.className}`.trim();
                const statusIcon = document.createElement('span');
                statusIcon.className = 'status-icon';
                statusIcon.textContent = statusInfo.icon;
                const statusText = document.createElement('span');
                statusText.className = 'status-text';
                statusText.textContent = statusInfo.text;
                statusBadge.appendChild(statusIcon);
                statusBadge.appendChild(statusText);

                const deadlineInfo = document.createElement('div');
                deadlineInfo.className = `deadline-info ${sub.status === 'expired' ? 'expired' : ''}`.trim();
                const deadlineLabel = document.createElement('span');
                deadlineLabel.className = 'deadline-label';
                deadlineLabel.textContent = '截止时间';
                const deadlineDate = document.createElement('span');
                deadlineDate.className = 'deadline-date';
                deadlineDate.textContent = sub.deadline || '-';
                deadlineInfo.appendChild(deadlineLabel);
                deadlineInfo.appendChild(deadlineDate);

                if (sub.warning) {
                    const warning = document.createElement('span');
                    warning.className = 'deadline-warning';
                    warning.textContent = `⚠️ ${sub.warning}`;
                    deadlineInfo.appendChild(warning);
                }

                statusSection.appendChild(statusBadge);
                statusSection.appendChild(deadlineInfo);

                const summary = document.createElement('div');
                summary.className = 'subscription-summary';
                const summaryText = document.createElement('span');
                summaryText.className = 'summary-text';
                summaryText.textContent = sub.summary || '尚未设置摘要';
                const detailButton = document.createElement('button');
                detailButton.className = 'details-toggle';
                detailButton.type = 'button';
                detailButton.textContent = '查看详情';
                detailButton.onclick = function() {
                    toggleDetails(this);
                };
                summary.appendChild(summaryText);
                summary.appendChild(detailButton);

                const details = document.createElement('div');
                details.className = 'subscription-details';
                details.style.display = 'none';

                const detailMap = [
                    { label: '学期：', value: sub.term || '-' },
                    { label: '上课形式：', value: sub.modality || '-' },
                    { label: '时长：', value: sub.duration || '-' },
                    { label: '价格：', value: sub.price || '-' },
                    { label: '创建日期：', value: sub.createdAt || '-' }
                ];

                detailMap.forEach(item => {
                    const detailItem = document.createElement('div');
                    detailItem.className = 'detail-item';
                    const label = document.createElement('span');
                    label.className = 'detail-label';
                    label.textContent = item.label;
                    const value = document.createElement('span');
                    value.className = 'detail-value';
                    value.textContent = item.value;
                    detailItem.appendChild(label);
                    detailItem.appendChild(value);
                    details.appendChild(detailItem);
                });

                body.appendChild(statusSection);
                body.appendChild(summary);
                body.appendChild(details);

                const actions = document.createElement('div');
                actions.className = 'card-actions';

                if (sub.status === 'converted') {
                    const completion = document.createElement('div');
                    completion.className = 'completion-note';
                    const icon = document.createElement('span');
                    icon.className = 'completion-icon';
                    icon.textContent = '✅';
                    const text = document.createElement('span');
                    text.className = 'completion-text';
                    text.textContent = '订阅已完成';
                    completion.appendChild(icon);
                    completion.appendChild(text);
                    actions.appendChild(completion);
                } else {
                    const primaryBtn = document.createElement('button');
                    primaryBtn.className = 'btn-primary-action';
                    primaryBtn.type = 'button';
                    primaryBtn.textContent = '跳转选课';
                    primaryBtn.onclick = () => handleAction('jump', sub.id);
                    actions.appendChild(primaryBtn);

                    const viewBtn = document.createElement('button');
                    viewBtn.className = 'btn-view';
                    viewBtn.type = 'button';
                    viewBtn.textContent = '查看匹配课程';
                    viewBtn.onclick = () => handleAction('view', sub.id);
                    actions.appendChild(viewBtn);

                    if (sub.status === 'notified') {
                        const notifyBtn = document.createElement('button');
                        notifyBtn.className = 'btn-view';
                        notifyBtn.type = 'button';
                        notifyBtn.textContent = '查看通知详情';
                        notifyBtn.onclick = () => handleAction('notifyDetail', sub.id);
                        actions.appendChild(notifyBtn);
                    }

                    if (sub.status === 'waiting') {
                        const editBtn = document.createElement('button');
                        editBtn.className = 'btn-edit';
                        editBtn.type = 'button';
                        editBtn.textContent = '编辑条件';
                        editBtn.onclick = () => handleAction('edit', sub.id);
                        actions.appendChild(editBtn);

                        const renewBtn = document.createElement('button');
                        renewBtn.className = 'btn-renew';
                        renewBtn.type = 'button';
                        renewBtn.textContent = '续期';
                        renewBtn.onclick = () => handleAction('renew', sub.id);
                        actions.appendChild(renewBtn);

                        const cancelBtn = document.createElement('button');
                        cancelBtn.className = 'btn-destructive';
                        cancelBtn.type = 'button';
                        cancelBtn.textContent = '取消订阅';
                        cancelBtn.onclick = () => handleAction('cancel', sub.id);
                        actions.appendChild(cancelBtn);
                    }

                    if (sub.status === 'expired') {
                        const renewBtn = document.createElement('button');
                        renewBtn.className = 'btn-renew';
                        renewBtn.type = 'button';
                        renewBtn.textContent = '续期';
                        renewBtn.onclick = () => handleAction('renew', sub.id);
                        actions.appendChild(renewBtn);
                    }
                }

                card.appendChild(header);
                card.appendChild(body);
                card.appendChild(actions);

                container.appendChild(card);
            });

            // 重新应用现有筛选与排序配置
            filterCards();
            const sortValue = document.getElementById('deadline-sort');
            if (sortValue && sortValue.value) {
                sortCardsByDeadline();
            }
        }

        function formatUploadedFileSize(bytes) {
            if (!Number.isFinite(bytes) || bytes <= 0) {
                return '0 Bytes';
            }
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.min(Math.floor(Math.log(bytes) / Math.log(k)), sizes.length - 1);
            const converted = bytes / Math.pow(k, i);
            return `${converted.toFixed(converted >= 100 || converted % 1 === 0 ? 0 : 2)} ${sizes[i]}`;
        }

        function updateUploadedFilesList() {
            const uploadedFilesContainer = document.getElementById('uploadedFiles');
            if (!uploadedFilesContainer) {
                return;
            }

            if (!uploadedFiles || uploadedFiles.length === 0) {
                uploadedFilesContainer.innerHTML = '';
                uploadedFilesContainer.style.display = 'none';
                return;
            }

            uploadedFilesContainer.style.display = 'block';
            uploadedFilesContainer.innerHTML = uploadedFiles.map((file, index) => `
                <div class="uploaded-file-item">
                    <span class="uploaded-file-name">${file.name} (${formatUploadedFileSize(file.size)})</span>
                    <button type="button" class="uploaded-file-remove" onclick="removeUploadedFile(${index})" title="删除文件">✖</button>
                </div>
            `).join('');
        }

        function handleUploadedFiles(files) {
            if (!files || files.length === 0) {
                return;
            }

            const allowedTypes = ['.pdf', '.doc', '.docx', '.jpg', '.jpeg', '.png', '.gif'];
            Array.from(files).forEach(file => {
                const extension = '.' + file.name.split('.').pop().toLowerCase();
                if (!allowedTypes.includes(extension)) {
                    alert(`文件 "${file.name}" 格式不支持`);
                    return;
                }

                if (file.size > 10 * 1024 * 1024) {
                    alert(`文件 "${file.name}" 超过10MB限制`);
                    return;
                }

                if (uploadedFiles.some(item => item.name === file.name && item.size === file.size)) {
                    alert(`文件 "${file.name}" 已存在`);
                    return;
                }

                uploadedFiles.push(file);
            });

            updateUploadedFilesList();
        }

        function initFileUpload() {
            const dropArea = document.querySelector('.file-upload-area');
            const fileInput = document.getElementById('graduationReqFile');

            if (!dropArea || !fileInput) {
                return;
            }

            dropArea.addEventListener('click', () => fileInput.click());

            fileInput.addEventListener('change', event => {
                handleUploadedFiles(event.target.files);
            });

            ['dragenter', 'dragover'].forEach(eventName => {
                dropArea.addEventListener(eventName, event => {
                    event.preventDefault();
                    dropArea.classList.add('drag-over');
                });
            });

            ['dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, event => {
                    event.preventDefault();
                    dropArea.classList.remove('drag-over');
                });
            });

            dropArea.addEventListener('drop', event => {
                if (event.dataTransfer && event.dataTransfer.files) {
                    handleUploadedFiles(event.dataTransfer.files);
                }
            });
        }

        window.removeUploadedFile = function(index) {
            if (!Array.isArray(uploadedFiles)) {
                uploadedFiles = [];
            }
            uploadedFiles.splice(index, 1);
            updateUploadedFilesList();
        };

        // 初始化自主选课页面的订阅功能
        function initAutonomousSelectionSubscription() {
            // 仅使用自定义插入逻辑，精确控制订阅按钮只在课程代码列出现
            document.querySelectorAll('#autonomous-selection .course-table-excel tbody tr').forEach((row, index) => {
                const codeCell = row.querySelector('.course-code-cell');
                const nameCell = row.querySelector('.course-name-cell');
                const codeText = codeCell ? codeCell.textContent.trim() : '';
                
                // 仅在课程代码列添加订阅按钮，不区分任何状态
                if (codeCell && !codeCell.querySelector('.course-subscribe-btn')) {
                    const courseName = nameCell ? nameCell.textContent.trim() : `课程${index + 1}`;
                    const courseCode = codeText || `CODE${index + 1}`;
                    
                    // 生成订阅按钮HTML，确保包含正确的数据属性
                    const buttonElement = document.createElement('button');
                    buttonElement.className = 'course-subscribe-btn home-course';
                    buttonElement.textContent = '订阅';
                    buttonElement.title = '订阅本校意向课程';
                    
                    // 设置数据属性
                    buttonElement.setAttribute('data-course-id', `autonomous_${courseCode}_${index}`);
                    buttonElement.setAttribute('data-course-code', courseCode);
                    buttonElement.setAttribute('data-course-name', courseName);
                    buttonElement.setAttribute('data-course-type', 'home');
                    buttonElement.setAttribute('data-student-name', window.currentStudentInfo ? window.currentStudentInfo.name : '当前学生');
                    
                    // 绑定点击事件
                    buttonElement.onclick = function(event) {
                        SubscriptionModule.handleSingleSubscribe(this);
                    };
                    
                    // 只插入到课程代码单元格，绝不添加到其他列
                    codeCell.appendChild(buttonElement);
                }
            });
            
            // 清理函数：移除任何可能错误添加到其他列的订阅按钮
            document.querySelectorAll('#autonomous-selection .available-units-cell .course-subscribe-btn').forEach(btn => btn.remove());
            document.querySelectorAll('#autonomous-selection .general-category-cell .course-subscribe-btn').forEach(btn => btn.remove());
            document.querySelectorAll('#autonomous-selection .correspondence-cell .course-subscribe-btn').forEach(btn => btn.remove());
            document.querySelectorAll('#autonomous-selection .course-name-cell .course-subscribe-btn').forEach(btn => btn.remove());
            
            const buttonCount = document.querySelectorAll('#autonomous-selection .course-code-cell .course-subscribe-btn').length;
            console.log(`自主选课页面：已为所有 ${buttonCount} 个课程代码列添加本校课程订阅功能（不区分状态）`);
            
            // 🎯 初始化批量订阅功能，连接到现有模态框系统
            initAutonomousBatchSubscription();
        }
        
        // 初始化自主选课页面的批量订阅功能（连接现有系统）
        function initAutonomousBatchSubscription() {
            const batchBtn = document.getElementById('batchSubscribeHomeBtn');
            const checkboxes = document.querySelectorAll('#autonomous-selection .course-checkbox');
            
            if (!batchBtn || checkboxes.length === 0) {
                console.warn('自主选课批量订阅：未找到必需的元素');
                return;
            }
            
            // 🎯 更新批量订阅按钮状态（>=2门课程才可点击）
            function updateBatchButton() {
                const selectedCount = document.querySelectorAll('#autonomous-selection .course-checkbox:checked').length;
                
                // 只有选择>=2门课程时才启用按钮，无说明文字
                if (selectedCount >= 2) {
                    batchBtn.disabled = false;
                    batchBtn.querySelector('.btn-text').textContent = '批量订阅';
                } else {
                    batchBtn.disabled = true;
                    batchBtn.querySelector('.btn-text').textContent = '批量订阅';
                }
            }
            
            // 为所有复选框添加事件监听器
            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', updateBatchButton);
            });
            
            // 🎯 批量订阅按钮点击事件 - 连接到现有的模态框系统
            if (batchBtn.dataset.batchInitialized !== 'true') {
                batchBtn.addEventListener('click', function() {
                    const selectedCount = document.querySelectorAll('#autonomous-selection .course-checkbox:checked').length;
                    
                    if (selectedCount < 2) {
                        alert('请至少选择2门课程进行批量订阅');
                        return;
                    }
                    
                    // 构建符合现有系统格式的课程数据
                    const selectedCourses = getAutonomousSelectedCourses();
                    
                    if (selectedCourses.length === 0) {
                        alert('未找到有效的课程信息');
                        return;
                    }
                    
                    // 🚀 直接调用现有的批量订阅模态框
                    openAutonomousBatchModal(selectedCourses);
                });
                batchBtn.dataset.batchInitialized = 'true';
            }
            
            console.log('✅ 自主选课页面：批量订阅功能已初始化并连接到现有模态框系统');
            updateBatchButton();
        }
        
        // 获取自主选课页面选中的课程（格式化为现有系统格式）
        function getAutonomousSelectedCourses() {
            const selectedCourses = [];
            const checkedBoxes = document.querySelectorAll('#autonomous-selection .course-checkbox:checked');
            
            checkedBoxes.forEach(checkbox => {
                const row = checkbox.closest('tr');
                const codeCell = row.querySelector('.course-code-cell');
                const nameCell = row.querySelector('.course-name-cell');
                
                if (codeCell && nameCell) {
                    // 🎯 优化：精确提取课程代码，排除按钮文本
                    let courseCode = '';
                    const codeTextNodes = [];
                    for (let node of codeCell.childNodes) {
                        if (node.nodeType === Node.TEXT_NODE) {
                            codeTextNodes.push(node.textContent.trim());
                        }
                    }
                    courseCode = codeTextNodes.join('').trim() || codeCell.textContent.replace(/订阅/g, '').trim();
                    
                    // 🎯 优化：精确提取课程名称，过滤按钮文本
                    const courseName = nameCell.textContent.replace(/订阅/g, '').trim();
                    
                    // 确保数据有效
                    if (courseCode && courseName) {
                        // 🎯 获取系统中的学生信息
                        const studentName = getSystemStudentName();
                        
                        selectedCourses.push({
                            student: studentName,
                            course: `${courseCode}(${courseName})`,
                            type: 'home'
                        });
                    }
                }
            });
            
            return selectedCourses;
        }
        
        // 🎯 获取系统中的学生姓名
        function getSystemStudentName() {
            try {
                // 方式1: 从全局变量获取当前学生信息
                if (window.currentStudentInfo && window.currentStudentInfo.name) {
                    return window.currentStudentInfo.name;
                }
                
                // 方式2: 从页面标题或用户信息区域获取
                const userInfo = document.querySelector('.user-info, .student-name, .current-user');
                if (userInfo && userInfo.textContent.trim()) {
                    return userInfo.textContent.trim();
                }
                
                // 方式3: 从导航栏或头部信息获取
                const navUser = document.querySelector('.nav-user, .header-user, .username');
                if (navUser && navUser.textContent.trim()) {
                    return navUser.textContent.trim();
                }
                
                // 方式4: 从页面URL或参数中提取
                const urlParams = new URLSearchParams(window.location.search);
                const studentParam = urlParams.get('student') || urlParams.get('name') || urlParams.get('user');
                if (studentParam) {
                    return decodeURIComponent(studentParam);
                }
                
                // 方式5: 从本地存储获取
                const storedName = localStorage.getItem('studentName') || sessionStorage.getItem('studentName');
                if (storedName) {
                    return storedName;
                }
                
                // 方式6: 从现有订阅按钮中获取学生信息
                const existingBtn = document.querySelector('#autonomous-selection .course-subscribe-btn[data-student-name]');
                if (existingBtn) {
                    const studentName = existingBtn.getAttribute('data-student-name');
                    if (studentName && studentName !== '当前学生') {
                        return studentName;
                    }
                }
                
                // 兜底返回默认值
                return '当前学生';
            } catch (error) {
                console.warn('获取学生姓名失败，使用默认值:', error);
                return '当前学生';
            }
        }
        
        // 打开自主选课批量订阅模态框（使用现有系统）
        function openAutonomousBatchModal(selectedCourses) {
            // 设置模态框标题
            document.getElementById('modalTitle').textContent = '本校课程批量设置';
            
            // 设置模态框头部样式
            const modalHeader = document.querySelector('#subscribeModal .modal-header');
            modalHeader.classList.add('product-course');
            
            // 🎯 使用现有的数据填充函数，学生姓名不可编辑
            fillBatchModalData(selectedCourses, '本校课程', { readonlyStudentName: true });
            
            // 显示批量模式
            showBatchCourseMode();
            
            // 显示模态框
            document.getElementById('subscribeModal').style.display = 'flex';
            
            console.log('✅ 自主选课批量订阅模态框已打开，课程数量:', selectedCourses.length);
            
            // 🎯 保存当前批量订阅的上下文，用于完成后的清理
            window.currentBatchContext = {
                pageType: 'autonomous-selection',
                clearFunction: clearAutonomousBatchSelection
            };
        }
        
        // 清理自主选课页面的批量选择状态
        function clearAutonomousBatchSelection() {
            // 取消所有复选框的选中状态
            document.querySelectorAll('#autonomous-selection .course-checkbox:checked').forEach(checkbox => {
                checkbox.checked = false;
            });
            
            // 更新批量订阅按钮状态
            const batchBtn = document.getElementById('batchSubscribeHomeBtn');
            if (batchBtn) {
                batchBtn.disabled = true;
                batchBtn.querySelector('.btn-text').textContent = '批量订阅';
            }
            
            console.log('✅ 自主选课批量选择状态已清理');
        }
        
        // 🧪 测试自主选课批量订阅功能
        function testAutonomousBatchSubscription() {
            console.log('🧪 开始测试自主选课批量订阅功能...');
            
            // 测试学生姓名获取
            const studentName = getSystemStudentName();
            console.log('📝 获取到的学生姓名:', studentName);
            
            // 测试课程数据获取
            const selectedCourses = getAutonomousSelectedCourses();
            console.log('📚 当前选中的课程:', selectedCourses);
            
            // 测试按钮状态
            const batchBtn = document.getElementById('batchSubscribeHomeBtn');
            if (batchBtn) {
                const isEnabled = !batchBtn.disabled;
                const buttonText = batchBtn.querySelector('.btn-text').textContent;
                console.log('🔘 批量订阅按钮状态:', { isEnabled, buttonText });
            }
            
            console.log('✅ 自主选课批量订阅功能测试完成');
            return {
                studentName,
                selectedCourses,
                buttonStatus: batchBtn ? { enabled: !batchBtn.disabled, text: batchBtn.querySelector('.btn-text').textContent } : null
            };
        }
        
        function getStudentRepository() {
            if (!window.StudentRepository) {
                console.warn('StudentRepository 未初始化');
                return null;
            }
            return window.StudentRepository;
        }

        function getFollowUpStudents() {
            const repository = getStudentRepository();
            if (!repository) {
                return [];
            }
            return repository.getAllFollowUps();
        }

        function getFollowUpStudentById(studentId) {
            const repository = getStudentRepository();
            if (!repository) {
                return null;
            }
            return repository.getFollowUpById(studentId);
        }

        function renderStudentFollowTable() {
            const tbody = document.getElementById('studentFollowTableBody');
            if (!tbody) {
                return;
            }

            const students = getFollowUpStudents();

            if (students.length === 0) {
                tbody.innerHTML = `<tr class="student-row empty"><td colspan="10">暂无学生数据</td></tr>`;
                return;
            }

            const rowsHtml = students.map(student => {
                const statusBadgeClass = student.status && student.status.badgeClass ? student.status.badgeClass : '';
                const statusLabel = student.status && student.status.label ? student.status.label : '未知状态';
                const reportButton = student.report && student.report.available
                    ? `<button class="btn-link" onclick="viewReport('${student.id}')">查看报告</button>`
                    : '<span class="text-muted">暂无</span>';

                return `
                    <tr class="student-row" data-student-id="${student.id}">
                        <td><input type="checkbox" class="student-checkbox" value="${student.id}"></td>
                        <td class="student-name">${student.name}</td>
                        <td class="school-name">${student.school}</td>
                        <td class="entry-time">${student.entryTime || ''}</td>
                        <td class="next-follow">${student.nextFollow || ''}</td>
                        <td class="status"><span class="status-badge ${statusBadgeClass}">${statusLabel}</span></td>
                        <td class="wechat-name">${student.wechatName || ''}</td>
                        <td class="report-status">${reportButton}</td>
                        <td class="subscription-info">
                            <button class="btn-link" onclick="viewSubscriptionInfo('${student.id}')">查看订阅信息</button>
                        </td>
                        <td class="actions">
                            <button class="btn-edit" onclick="editStudent('${student.id}')" title="编辑">✏️</button>
                            <button class="btn-follow" onclick="addFollowRecord('${student.id}')" title="跟进">📝</button>
                            <button class="btn-delete" onclick="deleteStudent('${student.id}')" title="删除">🗑️</button>
                        </td>
                    </tr>
                `;
            }).join('');

            tbody.innerHTML = rowsHtml;
        }

        function updateStudentProfileData() {
            renderStudentProfileSection();
        }

        function viewReport(studentId) {
            const studentRecord = getFollowUpStudentById(studentId);
            if (!studentRecord) {
                alert('未找到学生信息');
                return;
            }

            StudentAnalysisController.setCurrentStudent(studentRecord, {
                activeTab: 'report-management'
            });

            document.querySelector('.main-layout').style.display = 'none';
            document.getElementById('student-analysis-page').style.display = 'block';
        }

        function viewSubscriptionInfo(studentId) {
            const studentRecord = getFollowUpStudentById(studentId);
            if (!studentRecord) {
                alert('未找到学生信息');
                return;
            }

            StudentAnalysisController.setCurrentStudent(studentRecord, {
                activeTab: 'subscription-info'
            });

            document.querySelector('.main-layout').style.display = 'none';
            document.getElementById('student-analysis-page').style.display = 'block';
        }
        
        // 初始化学生档案表单
        function initStudentProfileForm() {
            const form = document.getElementById('studentProfileForm');
            
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // 收集表单数据
                const formData = new FormData();
                
                // 基本信息
                formData.append('studentName', document.getElementById('studentName').value);
                formData.append('studentSchool', document.getElementById('studentSchool').value);
                
                // 转学分需求
                const creditTransfer = document.querySelector('input[name="creditTransfer"]:checked');
                formData.append('creditTransfer', creditTransfer ? creditTransfer.value : '');
                
                // 上课目的
                const coursePurposes = [];
                document.querySelectorAll('input[name="coursePurpose"]:checked').forEach(checkbox => {
                    coursePurposes.push(checkbox.value);
                });
                formData.append('coursePurpose', coursePurposes.join(','));
                
                // 毕业要求文件
                const fileInput = document.getElementById('graduationReqFile');
                if (fileInput.files.length > 0) {
                    Array.from(fileInput.files).forEach(file => {
                        formData.append('graduationReqFiles', file);
                    });
                }
                
                // 提交表单
                submitStudentProfile(formData);
            });
        }
        
        // 提交学生档案
        function submitStudentProfile(formData) {
            const runtimeProfile = {
                creditTransfer: formData.get('creditTransfer') || 'yes',
                coursePurpose: (formData.get('coursePurpose') || '')
                    .split(',')
                    .map(item => item.trim())
                    .filter(Boolean)
            };

            const currentStudent = StudentAnalysisController.getCurrentStudent();
            if (currentStudent) {
                StudentRuntimeStore.setProfile(currentStudent.id, runtimeProfile);
                StudentAnalysisController.scheduleRefresh();
            }

            // 显示提交成功消息
            const studentName = formData.get('studentName');
            const creditTransfer = runtimeProfile.creditTransfer === 'yes' ? '需要' : '不需要';
            const purposes = (runtimeProfile.coursePurpose.length ? runtimeProfile.coursePurpose : ['未选择']).map(p => {
                const purposeMap = {
                    'graduation': '毕业',
                    'transfer': '转学',
                    'gradschool': '申研',
                    'studyabroad': '游学'
                };
                return purposeMap[p] || p;
            }).join('、');
            
            const fileCount = document.getElementById('graduationReqFile').files.length;
            
            let message = `档案搜集提交成功！\n\n`;
            message += `学生: ${studentName}\n`;
            message += `学校: ${formData.get('studentSchool')}\n`;
            message += `转学分需求: ${creditTransfer}\n`;
            message += `上课目的: ${purposes}\n`;
            if (fileCount > 0) {
                message += `已上传 ${fileCount} 个毕业要求文件`;
            }
            
            alert(message);
            
            console.log('学生档案数据:', {
                studentName: formData.get('studentName'),
                studentSchool: formData.get('studentSchool'),
                creditTransfer: runtimeProfile.creditTransfer,
                coursePurpose: runtimeProfile.coursePurpose,
                fileCount: fileCount
            });
        }
        
        // 订阅中心筛选功能
        function initSubscriptionFilters() {
            const typeFilter = document.getElementById('subscription-type-filter');
            const statusFilter = document.getElementById('status-filter');
            
            if (typeFilter && statusFilter) {
                typeFilter.addEventListener('change', filterSubscriptions);
                statusFilter.addEventListener('change', filterSubscriptions);
            }
        }
        
        function filterSubscriptions() {
            const typeFilter = document.getElementById('subscription-type-filter').value;
            const statusFilter = document.getElementById('status-filter').value;
            const tableRows = document.querySelectorAll('.subscription-center-table tbody tr');
            
            tableRows.forEach(row => {
                let showRow = true;
                
                // 筛选订阅类型
                if (typeFilter) {
                    const typeBadge = row.querySelector('.subscription-type-badge');
                    const typeClass = typeBadge ? typeBadge.className : '';
                    
                    if (typeFilter === 'product' && !typeClass.includes('type-product')) {
                        showRow = false;
                    } else if (typeFilter === 'home' && !typeClass.includes('type-home')) {
                        showRow = false;
                    }
                }
                
                // 筛选状态
                if (statusFilter && showRow) {
                    const statusCell = row.querySelector('td:nth-child(4)');
                    const statusClass = statusCell ? statusCell.className : '';
                    
                    if (statusFilter === 'waiting' && !statusClass.includes('status-waiting')) {
                        showRow = false;
                    } else if (statusFilter === 'matched' && !statusClass.includes('status-matched')) {
                        showRow = false;
                    } else if (statusFilter === 'notified' && !statusClass.includes('status-notified')) {
                        showRow = false;
                    } else if (statusFilter === 'viewed' && !statusClass.includes('status-viewed')) {
                        showRow = false;
                    } else if (statusFilter === 'converted' && !statusClass.includes('status-converted')) {
                        showRow = false;
                    } else if (statusFilter === 'expired' && !statusClass.includes('status-expired')) {
                        showRow = false;
                    }
                }
                
                row.style.display = showRow ? '' : 'none';
            });
        }
        
        function resetSubscriptionFilters() {
            document.getElementById('subscription-type-filter').value = '';
            document.getElementById('status-filter').value = '';
            document.getElementById('deadline-sort').value = '';
            filterCards();
            resetCardOrder();
        }
        
        // 🎯 按截止日期排序功能
        function sortCardsByDeadline() {
            const sortValue = document.getElementById('deadline-sort').value;
            const container = document.querySelector('.subscription-cards-container');
            if (!container) {
                return;
            }
            const cards = Array.from(container.querySelectorAll('.subscription-card'));
            
            if (sortValue === '') {
                resetCardOrder();
                return;
            }
            
            // 提取并解析截止日期
            cards.forEach(card => {
                const deadlineText = card.dataset.deadline || '';
                card.deadlineDate = deadlineText ? new Date(deadlineText) : new Date('9999-12-31');
            });
            
            // 根据选择的排序方式排序
            cards.sort((a, b) => {
                if (sortValue === 'asc') {
                    return a.deadlineDate - b.deadlineDate; // 升序：最近的在前
                } else if (sortValue === 'desc') {
                    return b.deadlineDate - a.deadlineDate; // 降序：最远的在前
                }
                return 0;
            });
            
            // 重新排列DOM元素
            cards.forEach(card => {
                container.appendChild(card);
            });
        }
        
        // 重置卡片顺序为原始顺序
        function resetCardOrder() {
            const container = document.querySelector('.subscription-cards-container');
            if (!container) {
                return;
            }
            const cards = Array.from(container.querySelectorAll('.subscription-card'));
            
            cards.sort((a, b) => {
                const aIndex = Number(a.dataset.index || 0);
                const bIndex = Number(b.dataset.index || 0);
                return aIndex - bIndex;
            });
            
            cards.forEach(card => {
                container.appendChild(card);
            });
        }
        
        // 初始化订阅筛选功能（已改为卡片筛选，不再需要表格筛选初始化）
        // document.addEventListener('DOMContentLoaded', function() {
        //     initSubscriptionFilters();
        // });
        
        // 卡片布局相关函数
        function filterCards() {
            const statusFilter = document.getElementById('status-filter').value;
            const typeFilter = document.getElementById('subscription-type-filter').value;
            const cards = document.querySelectorAll('.subscription-card');
            
            cards.forEach(card => {
                let showCard = true;
                
                if (statusFilter !== '' && card.dataset.status !== statusFilter) {
                    showCard = false;
                }
                
                if (typeFilter !== '' && card.dataset.type !== typeFilter) {
                    showCard = false;
                }
                
                // Show or hide the card
                card.style.display = showCard ? '' : 'none';
            });
            
            // 🎯 筛选后重新应用排序
            const currentSort = document.getElementById('deadline-sort').value;
            if (currentSort !== '') {
                sortCardsByDeadline();
            }
        }
        
        // 🧪 测试排序功能
        function testDeadlineSorting() {
            console.log('🧪 测试截止日期排序功能...');
            
            const cards = document.querySelectorAll('.subscription-card');
            console.log(`📋 找到 ${cards.length} 张卡片`);
            
            cards.forEach((card, index) => {
                const deadlineElement = card.querySelector('.deadline-date');
                const title = card.querySelector('.course-title')?.textContent || `卡片${index + 1}`;
                if (deadlineElement) {
                    const deadline = deadlineElement.textContent.trim();
                    console.log(`📅 ${title}: ${deadline}`);
                } else {
                    console.log(`❓ ${title}: 未找到截止日期`);
                }
            });
            
            console.log('✅ 排序功能测试完成');
        }
        
        function toggleDetails(button) {
            // Find the parent card
            const card = button.closest('.subscription-card');
            if (!card) return;
            
            // Find the subscription details within this card
            const details = card.querySelector('.subscription-details');
            if (!details) return;
            
            // Toggle the details visibility
            if (details.style.display === 'none' || details.style.display === '') {
                details.style.display = 'block';
                button.textContent = '收起详情';
            } else {
                details.style.display = 'none';
                button.textContent = '查看详情';
            }
        }
        
        function handleAction(action, subscriptionId) {
            // 模拟处理操作
            alert(`执行操作: ${action} (订阅ID: ${subscriptionId})`);
        }
        
        // ===== 灵活订阅功能模块 =====
        // 为实现跨页面、多场景订阅功能设计的通用组件系统
        
        window.SubscriptionModule = (function() {
            
            // 私有配置对象
            const config = {
                buttonClass: 'course-subscribe-btn',
                subscribedClass: 'subscribed',
                homeClass: 'home-course',
                productClass: 'product-course'
            };
            
            // 订阅组件配置预设
            const componentPresets = {
                // 单个课程订阅 - 本校课程
                'single-home': {
                    type: 'single',
                    courseType: 'home',
                    buttonText: '订阅',
                    allowedTypes: ['home']
                },
                
                // 单个课程订阅 - 产品课程
                'single-product': {
                    type: 'single',
                    courseType: 'product', 
                    buttonText: '订阅',
                    allowedTypes: ['product']
                },
                
                // 单个课程订阅 - 支持两种类型
                'single-mixed': {
                    type: 'single',
                    courseType: 'auto', // 自动识别
                    buttonText: '订阅',
                    allowedTypes: ['home', 'product']
                },
                
                // 批量订阅 - 仅本校课程
                'batch-home': {
                    type: 'batch',
                    courseType: 'home',
                    buttonText: '批量订阅',
                    allowedTypes: ['home'],
                    requireSelection: true
                },
                
                // 批量订阅 - 仅产品课程
                'batch-product': {
                    type: 'batch',
                    courseType: 'product',
                    buttonText: '批量订阅产品课程', 
                    allowedTypes: ['product'],
                    requireSelection: true
                },
                
                // 批量订阅 - 混合类型
                'batch-mixed': {
                    type: 'batch',
                    courseType: 'mixed',
                    buttonText: '批量订阅',
                    allowedTypes: ['home', 'product'],
                    requireSelection: true
                }
            };
            
            // 生成单个订阅按钮
            function generateSingleButton(options = {}) {
                const {
                    courseId = '',
                    courseName = '',
                    courseType = 'product',
                    studentName = '',
                    buttonText = '订阅',
                    position = 'absolute',
                    size = 'normal',
                    style = 'minimal',
                    preset = null
                } = options;
                
                // 应用预设配置
                const config = preset ? { ...componentPresets[preset], ...options } : options;
                
                // 构建CSS类名
                let cssClasses = ['course-subscribe-btn'];
                if (config.courseType === 'home') cssClasses.push('home-course');
                if (position !== 'absolute') cssClasses.push(`subscribe-${position}`);
                if (size !== 'normal') cssClasses.push(`subscribe-${size}`);
                if (style !== 'minimal') cssClasses.push(`subscribe-${style}`);
                
                // 构建数据属性
                const dataAttrs = [
                    `data-course-id="${courseId}"`,
                    `data-course-name="${courseName}"`,
                    `data-course-type="${config.courseType}"`,
                    `data-student-name="${studentName}"`
                ].join(' ');
                
                return `<button class="${cssClasses.join(' ')}" 
                        onclick="SubscriptionModule.handleSingleSubscribe(this)" 
                        ${dataAttrs}
                        title="订阅${config.courseType === 'home' ? '本校' : '产品'}课程">${config.buttonText}</button>`;
            }
            
            // 生成批量订阅按钮
            function generateBatchButton(options = {}) {
                const {
                    targetSelector = 'input[type="checkbox"]',
                    preset = 'batch-mixed',
                    position = 'toolbar',
                    size = 'normal'
                } = options;
                
                const config = { ...componentPresets[preset], ...options };
                
                let cssClasses = ['batch-subscribe-btn'];
                if (size !== 'normal') cssClasses.push(`batch-${size}`);
                
                // 根据课程类型确定样式
                if (config.courseType === 'home') {
                    cssClasses.push('home-subscribe-btn');
                } else if (config.courseType === 'product') {
                    cssClasses.push('product-subscribe-btn');
                }
                
                const dataAttrs = [
                    `data-target-selector="${targetSelector}"`,
                    `data-course-type="${config.courseType}"`,
                    `data-allowed-types="${config.allowedTypes.join(',')}"`
                ].join(' ');
                
                return `<button class="${cssClasses.join(' ')}" 
                        onclick="SubscriptionModule.handleBatchSubscribe(this)" 
                        ${dataAttrs}
                        ${config.requireSelection ? 'disabled' : ''}
                        title="${config.buttonText}">${config.buttonText}</button>`;
            }
            
            // 核心部署函数 - 添加单个订阅按钮
            function deploySingleButtons(selector, options = {}) {
                const elements = document.querySelectorAll(selector);
                let addedCount = 0;
                
                elements.forEach((element, index) => {
                    // 检查是否已有订阅按钮
                    if (element.querySelector('.course-subscribe-btn')) {
                        return;
                    }
                    
                    // 自动提取课程信息
                    const courseInfo = extractCourseInfo(element, options);
                    
                    // 应用课程类型过滤
                    if (options.allowedTypes && !options.allowedTypes.includes(courseInfo.courseType)) {
                        return; // 跳过不允许的课程类型
                    }
                    
                    // 生成按钮HTML
                    const buttonHtml = generateSingleButton({
                        ...options,
                        ...courseInfo,
                        courseId: courseInfo.courseId || `course_${index}`
                    });
                    
                    // 插入按钮
                    insertButton(element, buttonHtml, options.insertMethod);
                    addedCount++;
                });
                
                return addedCount;
            }
            
            // 部署批量订阅按钮
            function deployBatchButton(containerSelector, options = {}) {
                const container = document.querySelector(containerSelector);
                if (!container) {
                    console.warn('SubscriptionModule: 未找到批量订阅按钮容器:', containerSelector);
                    return false;
                }
                
                // 检查是否已存在批量订阅按钮
                if (container.querySelector('.batch-subscribe-btn')) {
                    return false;
                }
                
                // 生成批量订阅按钮
                const buttonHtml = generateBatchButton(options);
                
                // 插入按钮
                container.insertAdjacentHTML('beforeend', buttonHtml);
                
                // 如果需要选择检测，启用选择监听
                if (options.requireSelection) {
                    setupBatchSelectionListener(options.targetSelector || 'input[type="checkbox"]');
                }
                
                return true;
            }
            
            // 按钮插入辅助函数
            function insertButton(element, buttonHtml, insertMethod) {
                if (insertMethod === 'append') {
                    element.insertAdjacentHTML('beforeend', buttonHtml);
                } else if (insertMethod === 'prepend') {
                    element.insertAdjacentHTML('afterbegin', buttonHtml);
                } else if (insertMethod === 'after') {
                    element.insertAdjacentHTML('afterend', buttonHtml);
                } else {
                    // 默认插入到右上角
                    element.style.position = 'relative';
                    element.insertAdjacentHTML('beforeend', buttonHtml);
                }
            }
            
            // 从元素中提取课程信息
            function extractCourseInfo(element, options = {}) {
                const info = {};
                
                // 提取课程名称
                if (options.courseNameSelector) {
                    const nameEl = element.querySelector(options.courseNameSelector);
                    info.courseName = nameEl ? nameEl.textContent.trim() : '';
                } else {
                    // 尝试常见的课程名称选择器
                    const nameSelectors = ['.course-name', '.course-title', 'h3', 'h4', '.title'];
                    for (const sel of nameSelectors) {
                        const nameEl = element.querySelector(sel);
                        if (nameEl) {
                            info.courseName = nameEl.textContent.trim();
                            break;
                        }
                    }
                    
                    // 如果没有找到，尝试从课程单元格中提取完整信息
                    if (!info.courseName) {
                        const courseCell = element.querySelector('.course-cell');
                        if (courseCell) {
                            const courseLink = courseCell.querySelector('.course-link');
                            const courseCode = courseLink ? courseLink.textContent.trim() : '';
                            const fullText = courseCell.textContent.trim();
                            const courseNameMatch = fullText.match(/\(([^)]+)\)/);
                            const courseName = courseNameMatch ? courseNameMatch[1] : '';
                            
                            // 格式化为"课程代码(课程名称)"
                            info.courseName = courseCode && courseName ? `${courseCode}(${courseName})` : fullText;
                        }
                    }
                }
                
                // 提取学生信息
                if (options.studentNameSelector) {
                    const studentEl = element.querySelector(options.studentNameSelector);
                    info.studentName = studentEl ? studentEl.textContent.trim() : '';
                } else {
                    // 尝试从上下文中找学生信息
                    const studentSelectors = ['.student-name', '.user-name', '.name'];
                    for (const sel of studentSelectors) {
                        const studentEl = element.querySelector(sel) || element.closest('tr')?.querySelector(sel);
                        if (studentEl) {
                            info.studentName = studentEl.textContent.trim();
                            break;
                        }
                    }
                }
                
                // 提取课程ID
                info.courseId = element.dataset.courseId || element.id || '';
                
                // 智能判断课程类型
                if (options.courseType === 'auto') {
                    info.courseType = detectCourseType(element);
                } else {
                    info.courseType = options.courseType || 'product';
                }
                
                return info;
            }
            
            // 智能检测课程类型
            function detectCourseType(element) {
                // 检查是否有类型标识
                const typeBadge = element.querySelector('.subscription-type-badge, .type-badge');
                if (typeBadge) {
                    const text = typeBadge.textContent.trim();
                    if (text.includes('本校') || text.includes('home')) return 'home';
                    if (text.includes('产品') || text.includes('product')) return 'product';
                }
                
                // 检查CSS类名
                if (element.classList.contains('home-course') || element.querySelector('.home-course')) {
                    return 'home';
                }
                if (element.classList.contains('product-course') || element.querySelector('.product-course')) {
                    return 'product';
                }
                
                // 默认为产品课程
                return 'product';
            }
            
            // 处理单个课程订阅
            function handleSingleSubscribe(button) {
                if (button.classList.contains(config.subscribedClass)) {
                    return; // 已订阅，不执行操作
                }
                
                // 阻止事件冒泡
                if (event) event.stopPropagation();
                
                // 获取课程信息
                const courseData = {
                    courseId: button.dataset.courseId,
                    courseCode: button.dataset.courseCode,
                    courseName: button.dataset.courseName,
                    courseType: button.dataset.courseType,
                    studentName: button.dataset.studentName
                };
                
                // 格式化课程信息为"课程代码(课程名称)"
                const formattedCourse = courseData.courseCode && courseData.courseName 
                    ? `${courseData.courseCode}(${courseData.courseName})`
                    : courseData.courseName;
                
                // 创建与原有系统兼容的数据格式
                const selectedCourse = [{
                    student: courseData.studentName || '当前用户',
                    course: formattedCourse,
                    type: courseData.courseType
                }];
                
                // 确定模态框标题
                const modalTitle = courseData.courseType === 'home' ? '本校课程订阅' : '产品课程订阅';
                
                // 调用原有的单课程订阅模态框
                openSingleCourseSelectionModal(selectedCourse, modalTitle, button);
            }
            
            // 处理批量订阅
            function handleBatchSubscribe(button) {
                const targetSelector = button.dataset.targetSelector;
                const courseType = button.dataset.courseType;
                const allowedTypes = button.dataset.allowedTypes.split(',');
                
                // 获取选中的项目
                const selectedItems = document.querySelectorAll(`${targetSelector}:checked`);
                
                if (selectedItems.length === 0) {
                    alert('请先选择要订阅的课程');
                    return;
                }
                
                // 提取选中课程的信息
                const selectedCourses = [];
                selectedItems.forEach(checkbox => {
                    const row = checkbox.closest('tr, .course-item, .subscription-card');
                    if (row) {
                        const courseInfo = extractCourseInfo(row);
                        
                        // 检查课程类型是否被允许
                        if (allowedTypes.includes(courseInfo.courseType)) {
                            selectedCourses.push({
                                student: courseInfo.studentName || '当前用户',
                                course: courseInfo.courseName,
                                type: courseInfo.courseType
                            });
                        }
                    }
                });
                
                if (selectedCourses.length === 0) {
                    alert('没有找到符合条件的课程');
                    return;
                }
                
                // 根据课程类型确定标题
                let modalTitle = '批量订阅';
                if (courseType === 'home') {
                    modalTitle = '批量本校课程订阅';
                } else if (courseType === 'product') {
                    modalTitle = '批量产品课程订阅';
                }
                
                // 调用原有的批量订阅逻辑
                if (typeof openBatchSubscribeModal === 'function') {
                    // 存储选中的课程数据供模态框使用
                    window.batchSelectedCourses = selectedCourses;
                    openBatchSubscribeModal(modalTitle);
                } else {
                    // fallback: 调用单课程流程处理每个课程
                    selectedCourses.forEach((course, index) => {
                        setTimeout(() => {
                            const mockButton = document.createElement('button');
                            openSingleCourseSelectionModal([course], modalTitle, mockButton);
                        }, index * 500); // 延迟处理避免模态框冲突
                    });
                }
            }
            
            // 批量选择监听器设置
            function setupBatchSelectionListener(checkboxSelector) {
                const checkboxes = document.querySelectorAll(checkboxSelector);
                const batchButton = document.querySelector('.batch-subscribe-btn[disabled]');
                
                if (!batchButton) return;
                
                function updateBatchButton() {
                    const selectedCount = document.querySelectorAll(`${checkboxSelector}:checked`).length;
                    batchButton.disabled = selectedCount === 0;
                    
                    if (selectedCount > 0) {
                        batchButton.textContent = batchButton.textContent.replace(/\(\d+\)/, '') + `(${selectedCount})`;
                    } else {
                        batchButton.textContent = batchButton.textContent.replace(/\(\d+\)/, '');
                    }
                }
                
                checkboxes.forEach(checkbox => {
                    checkbox.addEventListener('change', updateBatchButton);
                });
                
                // 全选按钮监听
                const selectAllCheckbox = document.querySelector('input[type="checkbox"][id*="selectAll"]');
                if (selectAllCheckbox) {
                    selectAllCheckbox.addEventListener('change', () => {
                        setTimeout(updateBatchButton, 50);
                    });
                }
            }
            
            // 快速场景化部署函数
            function quickDeploy(scenario, customOptions = {}) {
                const scenarios = {
                    // 场景1: 仅单个本校课程订阅
                    'single-home-only': {
                        type: 'single',
                        preset: 'single-home',
                        selector: '.course-item, .subscription-card, tr',
                        allowedTypes: ['home'],
                        position: 'absolute',
                        size: 'small'
                    },
                    
                    // 场景2: 仅单个产品课程订阅  
                    'single-product-only': {
                        type: 'single',
                        preset: 'single-product',
                        selector: '.course-item, .subscription-card, tr',
                        allowedTypes: ['product'],
                        position: 'absolute',
                        size: 'small'
                    },
                    
                    // 场景3: 混合单个课程订阅
                    'single-mixed': {
                        type: 'single',
                        preset: 'single-mixed',
                        selector: '.course-item, .subscription-card, tr',
                        allowedTypes: ['home', 'product'],
                        courseType: 'auto',
                        position: 'absolute',
                        size: 'small'
                    },
                    
                    // 场景4: 仅本校课程批量订阅
                    'batch-home-only': {
                        type: 'batch',
                        preset: 'batch-home',
                        containerSelector: '.function-bar, .toolbar',
                        targetSelector: 'input[type="checkbox"]',
                        allowedTypes: ['home']
                    },
                    
                    // 场景5: 仅产品课程批量订阅
                    'batch-product-only': {
                        type: 'batch',
                        preset: 'batch-product', 
                        containerSelector: '.function-bar, .toolbar',
                        targetSelector: 'input[type="checkbox"]',
                        allowedTypes: ['product']
                    },
                    
                    // 场景6: 混合批量订阅
                    'batch-mixed': {
                        type: 'batch',
                        preset: 'batch-mixed',
                        containerSelector: '.function-bar, .toolbar', 
                        targetSelector: 'input[type="checkbox"]',
                        allowedTypes: ['home', 'product']
                    },
                    
                    // 场景7: 单个 + 批量组合 (仅本校)
                    'combo-home': {
                        type: 'combo',
                        single: { preset: 'single-home', allowedTypes: ['home'] },
                        batch: { preset: 'batch-home', allowedTypes: ['home'] }
                    },
                    
                    // 场景8: 单个 + 批量组合 (仅产品)
                    'combo-product': {
                        type: 'combo', 
                        single: { preset: 'single-product', allowedTypes: ['product'] },
                        batch: { preset: 'batch-product', allowedTypes: ['product'] }
                    },
                    
                    // 场景9: 完整功能 (当前页面的完整实现)
                    'full-featured': {
                        type: 'combo',
                        single: { preset: 'single-mixed', allowedTypes: ['home', 'product'], courseType: 'auto' },
                        batch: { preset: 'batch-mixed', allowedTypes: ['home', 'product'] }
                    }
                };
                
                const config = scenarios[scenario];
                if (!config) {
                    console.warn('SubscriptionModule: 未知的部署场景:', scenario);
                    return { single: 0, batch: false };
                }
                
                const options = { ...config, ...customOptions };
                const result = { single: 0, batch: false };
                
                // 部署单个订阅按钮
                if (options.type === 'single' || options.type === 'combo') {
                    const singleConfig = options.type === 'combo' ? options.single : options;
                    const selector = customOptions.selector || singleConfig.selector || '.course-item, .subscription-card';
                    
                    result.single = deploySingleButtons(selector, {
                        ...singleConfig,
                        ...customOptions
                    });
                }
                
                // 部署批量订阅按钮
                if (options.type === 'batch' || options.type === 'combo') {
                    const batchConfig = options.type === 'combo' ? options.batch : options;
                    const containerSelector = customOptions.containerSelector || batchConfig.containerSelector || '.function-bar';
                    
                    result.batch = deployBatchButton(containerSelector, {
                        ...batchConfig,
                        ...customOptions
                    });
                }
                
                return result;
            }
            
            // 添加必要的CSS样式
            function injectStyles() {
                if (document.getElementById('subscription-module-styles')) {
                    return; // 样式已存在
                }
                
                const styles = `
                    <style id="subscription-module-styles">
                    /* 通用订阅按钮样式扩展 */
                    .subscribe-inline {
                        position: static !important;
                        display: inline-block !important;
                        margin-left: 10px;
                    }
                    
                    .subscribe-block {
                        position: static !important;
                        display: block !important;
                        margin: 10px 0;
                        width: auto;
                    }
                    
                    .subscribe-small {
                        font-size: 10px !important;
                        padding: 1px 2px !important;
                    }
                    
                    .subscribe-large {
                        font-size: 14px !important;
                        padding: 8px 16px !important;
                    }
                    
                    .subscribe-button {
                        background: #007bff !important;
                        color: white !important;
                        border: 1px solid #007bff !important;
                        border-radius: 4px !important;
                        padding: 6px 12px !important;
                        transition: all 0.3s ease !important;
                    }
                    
                    .subscribe-button:hover {
                        background: #0056b3 !important;
                        transform: none !important;
                        text-decoration: none !important;
                    }
                    
                    .subscribe-badge {
                        background: #f8f9fa !important;
                        color: #495057 !important;
                        border: 1px solid #dee2e6 !important;
                        border-radius: 12px !important;
                        padding: 2px 8px !important;
                        font-size: 11px !important;
                    }
                    </style>
                `;
                
                document.head.insertAdjacentHTML('beforeend', styles);
            }
            
            // 公开API
            return {
                // 🎯 核心部署功能
                deploy: quickDeploy,                    // 场景化快速部署
                deploySingle: deploySingleButtons,      // 部署单个订阅按钮
                deployBatch: deployBatchButton,         // 部署批量订阅按钮
                
                // 🔧 底层构建功能  
                generateSingle: generateSingleButton,   // 生成单个按钮HTML
                generateBatch: generateBatchButton,     // 生成批量按钮HTML
                
                // 📋 事件处理函数
                handleSingleSubscribe: handleSingleSubscribe,  // 单个订阅处理
                handleBatchSubscribe: handleBatchSubscribe,    // 批量订阅处理
                
                // 🎯 按类别分离的批量订阅组件
                BatchHomeSubscription: {
                    // ✅ 本校课程专用批量订阅组件
                    deploy: function(containerSelector, config = {}) {
                        const container = document.querySelector(containerSelector);
                        if (!container) {
                            console.warn('BatchHomeSubscription: 未找到容器:', containerSelector);
                            return { success: false, message: '容器不存在' };
                        }
                        
                        const buttonConfig = {
                            preset: 'batch-home',
                            targetSelector: config.checkboxSelector || 'input[type="checkbox"]',
                            allowedTypes: ['home'],
                            buttonText: config.buttonText || '批量订阅',
                            requireSelection: true,
                            ...config
                        };
                        
                        const result = deployBatchButton(containerSelector, buttonConfig);
                        return { success: result, type: 'home', buttonText: buttonConfig.buttonText };
                    },
                    
                    getSelected: function(config = {}) {
                        // 统一使用核心数据抓取功能
                        const pageConfig = config.pageType ? createBatchConfig(config.pageType, config) : config;
                        return getSelectedCoursesWithType('home', pageConfig);
                    },
                    
                    execute: function(config = {}) {
                        // 统一使用核心执行功能
                        const selectedCourses = this.getSelected(config);
                        if (selectedCourses.length === 0) {
                            alert('请选择要订阅的本校课程');
                            return { success: false, courses: [] };
                        }
                        
                        // 调用统一的执行逻辑
                        return executeBatchSubscribeWithType('home', '本校课程', config);
                    }
                },
                
                BatchProductSubscription: {
                    // ✅ 产品课程专用批量订阅组件
                    deploy: function(containerSelector, config = {}) {
                        const container = document.querySelector(containerSelector);
                        if (!container) {
                            console.warn('BatchProductSubscription: 未找到容器:', containerSelector);
                            return { success: false, message: '容器不存在' };
                        }
                        
                        const buttonConfig = {
                            preset: 'batch-product',
                            targetSelector: config.checkboxSelector || 'input[type="checkbox"]',
                            allowedTypes: ['product'],
                            buttonText: config.buttonText || '批量订阅产品课程',
                            requireSelection: true,
                            ...config
                        };
                        
                        const result = deployBatchButton(containerSelector, buttonConfig);
                        return { success: result, type: 'product', buttonText: buttonConfig.buttonText };
                    },
                    
                    getSelected: function(config = {}) {
                        // 统一使用核心数据抓取功能
                        const pageConfig = config.pageType ? createBatchConfig(config.pageType, config) : config;
                        return getSelectedCoursesWithType('product', pageConfig);
                    },
                    
                    execute: function(config = {}) {
                        // 统一使用核心执行功能
                        const selectedCourses = this.getSelected(config);
                        if (selectedCourses.length === 0) {
                            alert('请选择要订阅的产品课程');
                            return { success: false, courses: [] };
                        }
                        
                        // 调用统一的执行逻辑
                        return executeBatchSubscribeWithType('product', '产品课程', config);
                    }
                },
                
                BatchMixedSubscription: {
                    // ✅ 混合类型批量订阅组件
                    deploy: function(containerSelector, config = {}) {
                        const container = document.querySelector(containerSelector);
                        if (!container) {
                            console.warn('BatchMixedSubscription: 未找到容器:', containerSelector);
                            return { success: false, message: '容器不存在' };
                        }
                        
                        const buttonConfig = {
                            preset: 'batch-mixed',
                            targetSelector: config.checkboxSelector || 'input[type="checkbox"]',
                            allowedTypes: ['home', 'product'],
                            buttonText: config.buttonText || '批量订阅',
                            requireSelection: true,
                            ...config
                        };
                        
                        const result = deployBatchButton(containerSelector, buttonConfig);
                        return { success: result, type: 'mixed', buttonText: buttonConfig.buttonText };
                    },
                    
                    deployBoth: function(containerSelector, config = {}) {
                        // � 同时部署本校和产品课程批量订阅按钮
                        const homeResult = this.parent.BatchHomeSubscription.deploy(containerSelector, {
                            ...config,
                            buttonText: config.homeButtonText || '批量订阅'
                        });
                        
                        const productResult = this.parent.BatchProductSubscription.deploy(containerSelector, {
                            ...config,
                            buttonText: config.productButtonText || '批量订阅产品课程'
                        });
                        
                        return {
                            home: homeResult,
                            product: productResult,
                            total: (homeResult.success ? 1 : 0) + (productResult.success ? 1 : 0)
                        };
                    },
                    
                    getSelected: function(targetType, config = {}) {
                        // 统一使用核心数据抓取功能
                        const pageConfig = config.pageType ? createBatchConfig(config.pageType, config) : config;
                        return getSelectedCoursesWithType(targetType, pageConfig);
                    },
                    
                    execute: function(targetType, config = {}) {
                        // 统一使用核心执行功能
                        const courseTypeText = targetType === 'home' ? '本校课程' : '产品课程';
                        const selectedCourses = this.getSelected(targetType, config);
                        
                        if (selectedCourses.length === 0) {
                            alert(`请选择要订阅的${courseTypeText}`);
                            return { success: false, courses: [] };
                        }
                        
                        // 调用统一的执行逻辑
                        return executeBatchSubscribeWithType(targetType, courseTypeText, config);
                    }
                },
                
                // 🚀 便捷部署接口
                quickDeployBatch: function(batchType, containerSelector, config = {}) {
                    switch(batchType) {
                        case 'home-only':
                            return this.BatchHomeSubscription.deploy(containerSelector, config);
                        case 'product-only':
                            return this.BatchProductSubscription.deploy(containerSelector, config);
                        case 'both-separate':
                            return this.BatchMixedSubscription.deployBoth(containerSelector, config);
                        case 'mixed':
                            return this.BatchMixedSubscription.deploy(containerSelector, config);
                        default:
                            console.warn('quickDeployBatch: 未知的批量类型:', batchType);
                            return this.BatchMixedSubscription.deploy(containerSelector, config);
                    }
                },
                
                // 🎛️ 高级配置接口
                createBatchConfig: function(pageType, customConfig = {}) {
                    const defaultConfigs = {
                        // 学生服务场景配置（自主选课页面）
                        'autonomous-selection': {
                            checkboxSelector: '.course-checkbox:checked',
                            studentNameSelector: '.student-name',
                            courseCellSelector: '.course-cell',
                            courseLinkSelector: '.course-link',
                            subscribeButtonSelector: '.course-subscribe-btn',
                            modalTitleSelector: '#modalTitle',
                            modalSelector: '#subscribeModal',
                            modalHeaderSelector: '#subscribeModal .modal-header',
                            minCourses: 2,
                            showSuccessAlert: true,
                            // 🎯 学生服务场景预定义列信息
                            columnMapping: {
                                home: {
                                    columnIndex: 3,          // "本校意向课程"列 = 本校课程信息
                                    cellSelector: 'td:nth-child(4).course-cell',
                                    courseType: 'home',
                                    description: '本校意向课程'
                                },
                                product: {
                                    columnIndex: 4,          // "已选课程"列 = 产品课程信息
                                    cellSelector: 'td:nth-child(5).course-cell',
                                    courseType: 'product',
                                    description: '已选课程（产品课程）'
                                }
                            }
                        },
                        
                        // 通用配置
                        'generic': {
                            checkboxSelector: 'input[type="checkbox"]:checked',
                            studentNameSelector: '.student, .user-name',
                            courseCellSelector: '.course, .item',
                            courseLinkSelector: '.title, .name',
                            subscribeButtonSelector: '.btn, .button',
                            modalTitleSelector: '#title, .title',
                            modalSelector: '#modal, .modal',
                            modalHeaderSelector: '.header, .top',
                            minCourses: 1,
                            showSuccessAlert: true
                        }
                    };
                    
                    const baseConfig = defaultConfigs[pageType] || defaultConfigs['generic'];
                    return { ...baseConfig, ...customConfig };
                },
                
                // 📊 核心数据抓取功能
                getSelectedCoursesWithType: function(targetType, config = {}) {
                    const checkboxes = document.querySelectorAll(config.checkboxSelector || '.course-checkbox:checked');
                    const selectedCourses = [];
                    
                    checkboxes.forEach(checkbox => {
                        const row = checkbox.closest('tr');
                        if (!row) return;
                        
                        const courseCells = row.querySelectorAll(config.courseCellSelector || '.course-cell');
                        const subscribeButtonSelector = config.subscribeButtonSelector || '.course-subscribe-btn';
                        
                        let chosenCell = null;
                        let buttonElement = null;
                        let courseType = '';
                        
                        if (targetType) {
                            // 🎯 优先使用预定义列信息进行精确查找
                            if (config.columnMapping && config.columnMapping[targetType]) {
                                const columnInfo = config.columnMapping[targetType];
                                
                                if (typeof columnInfo.columnIndex === 'number') {
                                    const targetCell = row.cells[columnInfo.columnIndex];
                                    if (targetCell && targetCell.classList.contains('course-cell')) {
                                        chosenCell = targetCell;
                                        buttonElement = targetCell.querySelector(subscribeButtonSelector);
                                        courseType = columnInfo.courseType;
                                        
                                        console.log(`✅ 精确定位${columnInfo.description}: 列${columnInfo.columnIndex + 1}`, {
                                            courseElement: targetCell.querySelector('.course-link'),
                                            courseText: targetCell.querySelector('.course-link')?.textContent,
                                            courseType: courseType
                                        });
                                    }
                                }
                            }
                        }
                        
                        if (chosenCell && buttonElement) {
                            const courseInfo = extractCourseInfo(chosenCell, config);
                            courseInfo.courseType = courseType;
                            selectedCourses.push(courseInfo);
                        }
                    });
                    
                    return selectedCourses;
                },
                
                // ⚡ 核心执行功能
                executeBatchSubscribeWithType: function(targetType, courseTypeText, config = {}) {
                    const selectedCourses = this.getSelectedCoursesWithType(targetType, config);
                    
                    if (selectedCourses.length === 0) {
                        alert(`请选择要订阅的${courseTypeText}`);
                        return { success: false, courses: [], message: '未选择课程' };
                    }
                    
                    // 执行批量订阅逻辑
                    console.log(`🚀 执行${courseTypeText}批量订阅:`, selectedCourses);
                    
                    // 模拟订阅成功
                    const successMessage = `成功批量订阅 ${selectedCourses.length} 门${courseTypeText}！`;
                    
                    if (config.showSuccessAlert !== false) {
                        alert(successMessage);
                    }
                    
                    return {
                        success: true,
                        courses: selectedCourses,
                        message: successMessage,
                        count: selectedCourses.length
                    };
                },
                
                // �🛠️ 工具函数
                extractCourseInfo: extractCourseInfo,   // 提取课程信息
                detectCourseType: detectCourseType,     // 检测课程类型
                injectStyles: injectStyles,             // 注入样式
                
                // 📖 预设配置
                presets: componentPresets,              // 所有预设配置
                
                // 📋 使用示例和说明
                examples: {
                    // 示例1: 只需要本校课程批量订阅的页面
                    deployHomeOnly: function(containerSelector) {
                        return window.SubscriptionModule.BatchHomeSubscription.deploy(containerSelector);
                    },
                    
                    // 示例2: 只需要产品课程批量订阅的页面  
                    deployProductOnly: function(containerSelector) {
                        return window.SubscriptionModule.BatchProductSubscription.deploy(containerSelector);
                    },
                    
                    // 示例3: 需要两种独立按钮的页面
                    deployBothSeparate: function(containerSelector) {
                        return window.SubscriptionModule.BatchMixedSubscription.deployBoth(containerSelector);
                    },
                    
                    // 示例4: 需要混合批量订阅的页面
                    deployMixed: function(containerSelector) {
                        return window.SubscriptionModule.BatchMixedSubscription.deploy(containerSelector);
                    },
                    
                    // 示例5: 自定义配置的页面
                    deployCustom: function(containerSelector, pageType) {
                        return window.SubscriptionModule.quickDeployBatch('both-separate', containerSelector, {
                            pageType: pageType,
                            minCourses: 3,
                            homeButtonText: '订阅本校课程',
                            productButtonText: '订阅产品课程'
                        });
                    }
                },
                
                // ℹ️ 版本信息
                version: '2.1.0'
            };
        })();
        
        // 🧪 完整的自主选课批量订阅测试函数
        window.testAutonomousBatchFlow = function() {
            console.log('=== 自主选课批量订阅完整流程测试 ===');
            
            // 检查页面状态
            const autonomousPage = document.getElementById('autonomous-selection');
            if (!autonomousPage || autonomousPage.style.display === 'none') {
                console.warn('⚠️ 请先切换到"自主选课"页面');
                return { success: false, message: '页面未激活' };
            }
            
            // 检查核心组件
            const batchBtn = document.getElementById('batchSubscribeHomeBtn');
            const checkboxes = document.querySelectorAll('#autonomous-selection .course-checkbox');
            const modal = document.getElementById('subscribeModal');
            
            console.log('🔍 核心组件检查:');
            console.log('  批量订阅按钮:', batchBtn ? '✅' : '❌');
            console.log('  课程复选框:', checkboxes.length > 0 ? `✅ ${checkboxes.length}个` : '❌');
            console.log('  订阅模态框:', modal ? '✅' : '❌');
            
            // 检查现有系统函数
            const requiredFunctions = [
                'getAutonomousSelectedCourses',
                'openAutonomousBatchModal', 
                'fillBatchModalData',
                'showBatchCourseMode',
                'submitBatchCourses'
            ];
            
            console.log('🔍 系统函数检查:');
            requiredFunctions.forEach(funcName => {
                const exists = typeof window[funcName] === 'function';
                console.log(`  ${funcName}:`, exists ? '✅' : '❌');
            });
            
            // 测试数据流
            if (checkboxes.length > 0) {
                console.log('\n🧪 测试数据流:');
                
                // 1. 选择几个课程
                const testCount = Math.min(2, checkboxes.length);
                console.log(`选择前 ${testCount} 个课程...`);
                for (let i = 0; i < testCount; i++) {
                    checkboxes[i].checked = true;
                }
                
                // 2. 测试数据提取
                const selectedCourses = getAutonomousSelectedCourses();
                console.log('提取的课程数据:', selectedCourses);
                
                // 3. 测试按钮状态更新
                checkboxes[0].dispatchEvent(new Event('change'));
                setTimeout(() => {
                    console.log('按钮状态:', batchBtn.disabled ? '禁用' : '启用');
                    console.log('按钮文本:', batchBtn.querySelector('.btn-text').textContent);
                    
                    // 清理测试
                    for (let i = 0; i < testCount; i++) {
                        checkboxes[i].checked = false;
                    }
                    checkboxes[0].dispatchEvent(new Event('change'));
                    
                    console.log('✅ 批量订阅流程测试完成');
                }, 100);
                
                return {
                    success: true,
                    components: {
                        batchButton: !!batchBtn,
                        checkboxes: checkboxes.length,
                        modal: !!modal
                    },
                    dataFlow: {
                        selectedCount: selectedCourses.length,
                        sampleData: selectedCourses[0]
                    }
                };
            }
            
            return { success: false, message: '没有可测试的课程' };
        };

        // 自动注入样式
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                window.SubscriptionModule.injectStyles();
            });
        } else {
            window.SubscriptionModule.injectStyles();
        }
        
    </script>
</body>
</html>
